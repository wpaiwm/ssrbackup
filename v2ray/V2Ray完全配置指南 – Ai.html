<!DOCTYPE html>
<!-- saved from url=(0094)https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#eg -->
<html lang="zh-CN"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><![endif]-->
<link rel="profile" href="https://gmpg.org/xfn/11">
<title>V2Ray完全配置指南 – Ai</title>
<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Ai » Feed" href="https://ailitonia.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Ai » 评论Feed" href="https://ailitonia.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Ai » V2Ray完全配置指南评论Feed" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/feed/">
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/ailitonia.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=f56447c6b3f155ce1094d766c8001431"}};
			/*! This file is auto-generated */
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="./V2Ray完全配置指南 – Ai_files/style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="pure-highlightjs-style-css" href="./V2Ray完全配置指南 – Ai_files/dark.css" type="text/css" media="all">
<link rel="stylesheet" id="pure-highlightjs-css-css" href="./V2Ray完全配置指南 – Ai_files/pure-highlight.css" type="text/css" media="all">
<link rel="stylesheet" id="responsive-lightbox-nivo-css" href="./V2Ray完全配置指南 – Ai_files/nivo-lightbox.min.css" type="text/css" media="all">
<link rel="stylesheet" id="responsive-lightbox-nivo-default-css" href="./V2Ray完全配置指南 – Ai_files/default.css" type="text/css" media="all">
<link rel="stylesheet" id="blackoot-css" href="./V2Ray完全配置指南 – Ai_files/blackoot.min.css" type="text/css" media="all">
<link rel="stylesheet" id="blackoot-style-css" href="./V2Ray完全配置指南 – Ai_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="./V2Ray完全配置指南 – Ai_files/font-awesome.min.css" type="text/css" media="all">
<link rel="stylesheet" id="Open-sans-webfonts-css" href="./V2Ray完全配置指南 – Ai_files/css" type="text/css" media="all">
<link rel="stylesheet" id="Quicksand-webfonts-css" href="./V2Ray完全配置指南 – Ai_files/css(1)" type="text/css" media="all">
<link rel="stylesheet" id="devework-shortcodes-css" href="./V2Ray完全配置指南 – Ai_files/shortcodes.css" type="text/css" media="all">
<link rel="stylesheet" id="devework-shortcodes-fontello-css" href="./V2Ray完全配置指南 – Ai_files/fontello.css" type="text/css" media="all">
<link rel="stylesheet" id="tablepress-default-css" href="./V2Ray完全配置指南 – Ai_files/tablepress-combined.min.css" type="text/css" media="all">
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/jquery.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/nivo-lightbox.min.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/infinite-scroll.pkgd.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var rlArgs = {"script":"nivo","selector":"lightbox","customEvents":"","activeGalleries":"1","effect":"fade","clickOverlayToClose":"1","keyboardNav":"1","errorMessage":"The requested content cannot be loaded. Please try again later.","woocommerce_gallery":"0","ajaxurl":"https:\/\/ailitonia.com\/wp-admin\/admin-ajax.php","nonce":"3b55ff5661"};
/* ]]> */
</script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/front.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/hoverIntent.min.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/blackoot.min.js"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://ailitonia.com/wp-content/themes/Blackoot/js/html5.js?ver=1.1.20_Aili魔改_v1.3.13'></script>
<![endif]-->
<link rel="https://api.w.org/" href="https://ailitonia.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://ailitonia.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://ailitonia.com/wp-includes/wlwmanifest.xml">
<link rel="prev" title="Caddy配置指南" href="https://ailitonia.com/archives/caddy%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/">
<link rel="next" title="CentOS 7 Nginx安装与配置" href="https://ailitonia.com/archives/centos-7-nginx%e5%ae%89%e8%a3%85%e4%b8%8e%e9%85%8d%e7%bd%ae/">
<link rel="canonical" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/">
<link rel="shortlink" href="https://ailitonia.com/?p=1211">
<link rel="alternate" type="application/json+oembed" href="https://ailitonia.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Failitonia.com%2Farchives%2Fv2ray%25e5%25ae%258c%25e5%2585%25a8%25e9%2585%258d%25e7%25bd%25ae%25e6%258c%2587%25e5%258d%2597%2F">
<link rel="alternate" type="text/xml+oembed" href="https://ailitonia.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Failitonia.com%2Farchives%2Fv2ray%25e5%25ae%258c%25e5%2585%25a8%25e9%2585%258d%25e7%25bd%25ae%25e6%258c%2587%25e5%258d%2597%2F&amp;format=xml">
<script type="text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//ailitonia.com/?wordfence_lh=1&hid=6A25FCCDA9D21437720D5D65BB43F7B0');
</script><style type="text/css" id="custom-background-css">
body.custom-background { background-color: #444444; background-image: url("https://ailitonia.com/wp-content/uploads/2018/07/9763bc67b9b0259f2159d98c2d0f2f42f819b21484812-NXXrjk.jpg"); background-position: center center; background-size: cover; background-repeat: no-repeat; background-attachment: fixed; }
</style>
<link rel="icon" href="https://ailitonia.com/wp-content/uploads/2018/02/cropped-Logo-32x32.png" sizes="32x32">
<link rel="icon" href="https://ailitonia.com/wp-content/uploads/2018/02/cropped-Logo-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="https://ailitonia.com/wp-content/uploads/2018/02/cropped-Logo-180x180.png">
<meta name="msapplication-TileImage" content="https://ailitonia.com/wp-content/uploads/2018/02/cropped-Logo-270x270.png">
<script src="./V2Ray完全配置指南 – Ai_files/wp-emoji-release.min.js" type="text/javascript" defer=""></script><script type="text/javascript" async="" src="./V2Ray完全配置指南 – Ai_files/saved_resource"></script></head>
<body class="post-template-default single single-post postid-1211 single-format-standard custom-background su-other-shortcodes-loaded">
<div id="main-wrap">
<div id="header-wrap">
<div id="tophead-wrap">
<div class="container">
<div class="tophead">
<form role="search" method="get" class="search-form" action="https://ailitonia.com/">
<label>
<span class="screen-reader-text">搜索：</span>
<input type="search" class="search-field" placeholder="搜索…" value="" name="s">
</label>
<input type="submit" class="search-submit" value="搜索">
</form> </div>
</div>
</div>
<div id="header">
<div class="container">
<div id="logo">
<a href="https://ailitonia.com/" title="Ai" rel="home">
<h1 class="site-title" style="display:none">Ai</h1>
<img src="./V2Ray完全配置指南 – Ai_files/1.1-id47878234.jpg" alt="Ai">
</a>
</div>
<div id="tagline">你想要的，这儿都没有~</div>
</div>
</div>
<div id="nav-wrap">
<div id="navbar" class="container">
<div class="menu-%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%af%bc%e8%88%aa" class="menu sf-menu sf-js-enabled sf-arrows"><li id="menu-item-1500" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-1500"><a href="https://ailitonia.com/">Home</a></li>
<li id="menu-item-191" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-191"><a href="https://ailitonia.com/news/">News</a></li>
<li id="menu-item-503" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-503"><a href="https://ailitonia.com/live/">Live</a></li>
<li id="menu-item-769" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-769"><a href="https://ailitonia.com/archives/">Archives</a></li>
<li id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-193"><a href="https://ailitonia.com/about/">About</a></li>
</ul></div><select id="dropdown-menu"><option value="">Menu</option><option value="https://ailitonia.com/">Home</option><option value="https://ailitonia.com/news/">News</option><option value="https://ailitonia.com/live/">Live</option><option value="https://ailitonia.com/archives/">Archives</option><option value="https://ailitonia.com/about/">About</option></select> </div>
</div>
</div>
<div id="page-title">
<div class="container">
<div id="breadcrumbs">
<a href="https://ailitonia.com/">Home</a><span class="separator"> / </span><a href="https://ailitonia.com/topics/notebook/" rel="tag">小本本</a><span class="separator"> / </span>V2Ray完全配置指南 </div>

<h1>V2Ray完全配置指南</h1>
</div>
</div>
<style type="text/css">
.autorbox {
box-shadow: 0 0 3px RGBA(0,0,0,.15);
background-color: #444;
<!-- border:1px #b2b2b2 solid; -->
<!-- border-radius: 2px; -->
margin:0 0 0 0;
padding: 10px 10px 10px 10px;
color: #f0f0f0;
min-height:70px;
position: relative;
}
.autorhead {
box-shadow: 0 0 3px RGBA(0,0,0,.15);
background-color: #444;
border:1px #fda82c solid;
width:64px;
height:64px;
border-radius: 2px;
padding: 2px 2px 2px 2px;
color: #f0f0f0;
margin:10px 0 0 10px;
float:left;
}
.autorinfo {
<!-- box-shadow: 0 0 3px RGBA(0,0,0,.15); -->
background-color: #444;
<!-- border:1px #b2b2b2 solid; -->
<!-- border-radius: 2px; -->
font-size: 11pt;
line-height: 12pt;
margin:0 0 0 96px;
letter-spacing: 0;
padding: 10px 5px 5px 15px;
color: #f0f0f0;
position: relative;
 white-space: pre; /* CSS 2.0 */ 
 white-space: pre-wrap; /* CSS 2.1 */ 
 white-space: pre-line; /* CSS 3.0 */ 
 white-space: -pre-wrap; /* Opera 4-6 */ 
 white-space: -o-pre-wrap; /* Opera 7 */ 
 white-space: -moz-pre-wrap; /* Mozilla */ 
 white-space: -hp-pre-wrap; /* HP Printers */ 
 word-wrap: break-word; /* IE 5+, 文本行的任意字内断开 */
}
.copyrightbox {
box-shadow: 0 0 3px RGBA(0,0,0,.15);
background-color: #444;
margin:0 0 0 0;
padding: 10px 10px 10px 10px;
color: #f0f0f0;
position: relative;
}
.copyrightinfo {
<!-- box-shadow: 0 0 3px RGBA(0,0,0,.15); -->
background-color: #444;
font-size: 11pt;
line-height: 16pt;
margin:0 0 0 0;
letter-spacing: 0;
padding: 10px 10px 10px 10px;
color: #f0f0f0;
position: relative;
}
</style>
<div class="container" id="main-content">
<div id="page-container">
<div id="post-1211" class="single-post post-1211 post type-post status-publish format-standard hentry category-notebook tag-v2ray">
<div class="postmetadata">
<span class="entry-title hatom-feed-info">V2Ray完全配置指南</span>
<span class="meta-date post-date updated"><i class="fa fa-calendar"></i><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/" title="V2Ray完全配置指南" rel="bookmark">
2018年3月20日 </a></span>
<span class="meta-author author vcard"><i class="fa fa-user"></i><a class="fn" href="https://ailitonia.com/archives/author/ailitonia/" title="View all posts by Ailitonia" rel="author">Ailitonia</a></span>
<div class="meta-category">
<span class="category-icon" title="Category"><i class="fa fa-tag"></i></span>
<a href="https://ailitonia.com/topics/notebook/">小本本</a> </div>
<span class="meta-comments"><i class="fa fa-comment"></i>
<a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comments">32 Comments</a> </span>
<div class="meta-tags"><span class="tags-icon"><i class="fa fa-tags"></i></span><a href="https://ailitonia.com/tags/v2ray/" rel="tag">V2Ray</a></div> </div>
<div class="post-contents entry-content">
<div class="dw-box dw-box-tip"><i class="dwicon-tip"></i><span style="font-size: 12pt;">本文参考于<a href="https://www.v2ray.com/" target="_blank" rel="noopener noreferrer">V2Ray官网</a>和<a href="https://guide.v2fly.org/" target="_blank" rel="noopener noreferrer">V2Ray 配置指南</a></span></div>
<p><span id="more-1211"></span></p>
<div class="dw-box dw-box-warning"><i class="dwicon-warning"></i><span style="font-size: 14pt;">本文更新于2019年3月27日，对应版本v4.18.0，请注意文章时效性。</span></div>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i>
<h2><span style="color: #eeeeee;">兼容性保证</span></h2>
<ul>
<li><span style="font-size: 12pt; color: #eeeeee;">配置文件向后兼容至少一个大版本，即 V2Ray 4.x 可以正常加载 3.x 的配置文件。</span></li>
<li><span style="font-size: 12pt; color: #eeeeee;">所有基于 Protobuf 的通信协议，如 Api，向后兼容至少一个大版本。</span></li>
<li><span style="font-size: 12pt; color: #eeeeee;">所有基于二进制的通信协议，如 Shadowsocks 和 VMess。当服务器版本不低于客户端版本时，保持永久兼容；当客户端版本超过服务器版本时，保持至少 12 个小版本的兼容性。</span></li>
</ul>
</div>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">下载安装</span></strong></div></h1>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>平台支持</div></h2>
<p><span style="font-size: 12pt;">V2Ray 在以下平台中可用：</span></p>
<ul>
<li><span style="font-size: 12pt;">Windows 7 及之后版本（x86 / amd64）；</span></li>
<li><span style="font-size: 12pt;">Mac OS X 10.10 Yosemite 及之后版本（amd64）；</span></li>
<li><span style="font-size: 12pt;">Linux 2.6.23 及之后版本（x86 / amd64 / arm / arm64 / mips64 / mips）；</span>
<ul>
<li><span style="font-size: 12pt;">包括但不限于 Debian 7 / 8、Ubuntu 12.04 / 14.04 及后续版本、CentOS 6 / 7、Arch Linux；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">FreeBSD (x86 / amd64)；</span></li>
<li><span style="font-size: 12pt;">OpenBSD (x86 / amd64)；</span></li>
<li><span style="font-size: 12pt;">Dragonfly BSD (amd64)；</span></li>
</ul>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>硬件要求</div></h2>
<p><span style="font-size: 12pt;">至少 32MB 空闲内存，推荐 64MB 或更多。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>下载 V2Ray</div></h2>
<p><span style="font-size: 12pt;">预编译的压缩包可以在如下几个站点找到：</span></p>
<ol>
<li><span style="font-size: 12pt;">Github Release:&nbsp;<a href="https://github.com/v2ray/v2ray-core/releases" target="_blank" rel="noopener noreferrer">github.com/v2ray/v2ray-core</a></span></li>
<li><span style="font-size: 12pt;">Github 分流:&nbsp;<a href="https://www.v2ray.com/download/" target="_blank" rel="noopener noreferrer">v2ray.com/download</a></span></li>
<li><span style="font-size: 12pt;">Homebrew:&nbsp;<a href="https://github.com/v2ray/homebrew-v2ray" target="_blank" rel="noopener noreferrer">github.com/v2ray/homebrew-v2ray</a></span></li>
<li><span style="font-size: 12pt;">Arch Linux:&nbsp;<a href="https://www.archlinux.org/packages/community/x86_64/v2ray/" target="_blank" rel="noopener noreferrer">packages/community/x86_64/v2ray/</a></span></li>
<li><span style="font-size: 12pt;">Snapcraft:&nbsp;<a href="https://snapcraft.io/v2ray-core" target="_blank" rel="noopener noreferrer">snapcraft.io/v2ray-core</a></span></li>
</ol>
<p><span style="font-size: 12pt;">压缩包均为 zip 格式，找到对应平台的压缩包，下载解压即可使用。</span></p>
<h2>验证安装包</h2>
<p><span style="font-size: 12pt;">V2Ray 提供两种验证方式：</span></p>
<ol>
<li><span style="font-size: 12pt;">安装包 zip 文件的 SHA1 / SHA256 摘要，在每个安装包对应的.dgst文件中可以找到。</span></li>
<li><span style="font-size: 12pt;">可运行程序（v2ray 或 v2ray.exe）的 gpg 签名，文件位于安装包中的 v2ray.sig 或 v2ray.exe.sig。签名公钥可以<a href="https://raw.githubusercontent.com/v2ray/v2ray-core/master/release/verify/official_release.asc" target="_blank" rel="noopener noreferrer">在代码库中</a>找到。</span></li>
</ol>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>Windows 和 Mac OS 安装方式</div></h2>
<p><span style="font-size: 12pt;">通过上述方式下载的压缩包，解压之后可看到 v2ray 或 v2ray.exe。直接运行即可。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>Linux 安装脚本</div></h2>
<p><span style="font-size: 12pt;">V2Ray 提供了一个在 Linux 中的自动化安装脚本。这个脚本会自动检测有没有安装过 V2Ray，如果没有，则进行完整的安装和配置；如果之前安装过 V2Ray，则只更新 V2Ray 二进制程序而不更新配置。</span></p>
<p><span style="font-size: 12pt;">以下指令假设已在 su 环境下，如果不是，请先运行 sudo su。</span></p>
<p><span style="font-size: 12pt;">运行下面的指令下载并安装 V2Ray。当 yum 或 apt-get 可用的情况下，此脚本会自动安装 unzip 和 daemon。这两个组件是安装 V2Ray 的必要组件。如果你使用的系统不支持 yum 或 apt-get，请自行安装 unzip 和 daemon。</span></p>
<pre class="pure-highlightjs"><code class="null hljs cpp">bash &lt;(curl -L -s https:<span class="hljs-comment">//install.direct/go.sh)</span></code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">此脚本会自动安装以下文件：</span></p>
<pre class="pure-highlightjs"><code class="null hljs dts"><span class="hljs-meta-keyword">/usr/</span>bin<span class="hljs-meta-keyword">/v2ray/</span>v2ray：V2Ray 程序；
<span class="hljs-meta-keyword">/usr/</span>bin<span class="hljs-meta-keyword">/v2ray/</span>v2ctl：V2Ray 工具；
<span class="hljs-meta-keyword">/etc/</span>v2ray/config.json：配置文件；
<span class="hljs-meta-keyword">/usr/</span>bin<span class="hljs-meta-keyword">/v2ray/</span>geoip.dat：IP 数据文件
<span class="hljs-meta-keyword">/usr/</span>bin<span class="hljs-meta-keyword">/v2ray/</span>geosite.dat：域名数据文件</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">此脚本会配置自动运行脚本。自动运行脚本会在系统重启之后，自动运行 V2Ray。目前自动运行脚本只支持带有 Systemd 的系统，以及 Debian / Ubuntu 全系列。</span></p>
<p><span style="font-size: 12pt;">运行脚本位于系统的以下位置：</span></p>
<ul>
<li><span style="font-size: 12pt;">/etc/systemd/system/v2ray.service: Systemd</span></li>
<li><span style="font-size: 12pt;">/etc/init.d/v2ray: SysV</span></li>
</ul>
<p><span style="font-size: 12pt;">脚本运行完成后，你需要：</span></p>
<ol>
<li><span style="font-size: 12pt;">编辑 /etc/v2ray/config.json 文件来配置你需要的代理方式；</span></li>
<li><span style="font-size: 12pt;">运行 service v2ray start 来启动 V2Ray 进程；</span></li>
<li><span style="font-size: 12pt;">之后可以使用 service v2ray start|stop|status|reload|restart|force-reload 控制 V2Ray 的运行。</span></li>
</ol>
<h2>go.sh 参数</h2>
<p><span style="font-size: 12pt;">go.sh 支持如下参数，可在手动安装时根据实际情况调整：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">-p</span>&nbsp;或&nbsp;<span style="color: #ffcc99;">–proxy</span>: 使用代理服务器来下载 V2Ray 的文件，格式与 curl 接受的参数一致，比如&nbsp;“<span style="color: #ffcc99;">socks5://127.0.0.1:1080</span>”&nbsp;或&nbsp;“<span style="color: #ffcc99;">http://127.0.0.1:3128</span>“。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">-f</span>&nbsp;或&nbsp;<span style="color: #ffcc99;">–force</span>: 强制安装。在默认情况下，如果当前系统中已有最新版本的 V2Ray，go.sh 会在检测之后就退出。如果需要强制重装一遍，则需要指定该参数。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">–version</span>: 指定需要安装的版本，比如&nbsp;“<span style="color: #ffcc99;">v1.13</span>“。默认值为最新版本。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">–local</span>: 使用一个本地文件进行安装。如果你已经下载了某个版本的 V2Ray，则可通过这个参数指定一个文件路径来进行安装。</span></li>
</ul>
<p><span style="font-size: 12pt;">示例：</span></p>
<ul>
<li><span style="font-size: 12pt;">使用地址为 127.0.0.1:1080 的 SOCKS 代理下载并安装最新版本：<span style="color: #ffcc99;">./go.sh -p socks5://127.0.0.1:1080</span></span></li>
<li><span style="font-size: 12pt;">安装本地的 v1.13 版本：<span style="color: #ffcc99;">./go.sh –version v1.13 –local /path/to/v2ray.zip</span></span></li>
</ul>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>Docker</div></h2>
<p><span style="font-size: 12pt;">V2Ray 提供了两个预编译的 Docker image：</span></p>
<ul>
<li><span style="font-size: 12pt;"><a href="https://hub.docker.com/r/v2ray/official/" target="_blank" rel="noopener noreferrer">v2ray/official</a>: 包含最新发布的版本，每周跟随新版本更新；</span></li>
<li><span style="font-size: 12pt;"><a href="https://hub.docker.com/r/v2ray/dev/" target="_blank" rel="noopener noreferrer">v2ray/dev</a>: 包含由最新的代码编译而成的程序文件，随代码库更新；</span></li>
</ul>
<p><span style="font-size: 12pt;">两个 image 的文件结构相同：</span></p>
<ul>
<li><span style="font-size: 12pt;">/etc/v2ray/config.json: 配置文件</span></li>
<li><span style="font-size: 12pt;">/usr/bin/v2ray/v2ray: V2Ray 主程序</span></li>
<li><span style="font-size: 12pt;">/usr/bin/v2ray/v2ctl: V2Ray 辅助工具</span></li>
<li><span style="font-size: 12pt;">/usr/bin/v2ray/geoip.dat: IP 数据文件</span></li>
<li><span style="font-size: 12pt;">/usr/bin/v2ray/geosite:dat: 域名数据文件</span></li>
</ul>
<hr>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><span style="color: #ffffff;"><strong>命令行参数</strong></span></div></h1>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ray</div></h2>
<p><span style="font-size: 12pt;">V2Ray 的程序文件的命令行参数如下：</span></p>
<pre class="pure-highlightjs"><code class="null hljs css"><span class="hljs-selector-tag">v2ray</span> <span class="hljs-selector-attr">[-version]</span> <span class="hljs-selector-attr">[-test]</span> <span class="hljs-selector-attr">[-config=config.json]</span> <span class="hljs-selector-attr">[-format=json]</span></code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">-version</span>: 只输出当前版本然后退出，不运行 V2Ray 主程序。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">-test</span>: 测试配置文件有效性，如果有问题则输出错误信息，不运行 V2Ray 主程序。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">-config</span>: 配置文件路径，可选的形式如下:</span>
<ul>
<li><span style="font-size: 12pt;">本地路径，可以是一个绝对路径，或者相对路径。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">stdin:</span>“: 表示将从标准输入读取配置文件内容，调用者必须在输入完毕后关闭标准输入流。</span></li>
<li><span style="font-size: 12pt;">以<span style="color: #ffcc99;">http://</span>或<span style="color: #ffcc99;">https://</span>(均为小写)开头: V2Ray 将尝试从这个远程地址加载配置文件。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">-format</span>: 配置文件格式，可选的值有：</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">json</span>: JSON 格式；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">pb&nbsp;</span>或&nbsp;<span style="color: #ffcc99;">protobuf</span>: Protobuf 格式；</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i>
<p><span style="color: #ffffff;">当<span style="color: #ffcc99;">-config</span>没有指定时，V2Ray 将先后尝试从以下路径加载<span style="color: #ffcc99;">config.json</span>:</span></p>
<ul>
<li><span style="color: #ffffff;">工作目录（Working Directory）</span></li>
<li><span style="color: #ffffff;">环境变量中<span style="color: #ffcc99;">v2ray.location.asset</span>所指定的路径</span></li>
</ul>
</div>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl</div></h2>
<p><span style="font-size: 12pt;">V2Ctl 命令行参数如下：</span></p>
<pre class="pure-highlightjs"><code class="null hljs dts">v2ctl <span class="hljs-params">&lt;command&gt;</span> <span class="hljs-params">&lt;options&gt;</span></code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">Command</span></strong>:&nbsp;子命令，有以下选项:</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">api</span>: 调用 V2Ray 进程的远程控制指令。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">config</span>: 从标准输入读取 JSON 格式的配置，然后从标准输出打印 Protobuf 格式的配置。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">cert</span>: 生成 TLS 证书。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">fetch</span>: 抓取远程文件。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">tlsping</span>: (V2Ray 4.17+) 尝试进行 TLS 握手。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">verify</span>: 验证文件是否由 Project V 官方签名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">uuid</span>: 输出一个随机的 UUID。</span></li>
</ul>
</li>
</ul>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl Api</div></h2>
<pre class="pure-highlightjs"><code class="null hljs css"><span class="hljs-selector-tag">v2ctl</span> <span class="hljs-selector-tag">api</span> <span class="hljs-selector-attr">[--server=127.0.0.1:8080]</span> &lt;<span class="hljs-selector-tag">Service</span><span class="hljs-selector-class">.Method</span>&gt; &lt;<span class="hljs-selector-tag">Request</span>&gt;</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">调用 V2Ray 进程的远程控制指令。示例：</span></p>
<pre class="pure-highlightjs"><code class="null hljs nginx"><span class="hljs-attribute">v2ctl</span> api --server=<span class="hljs-number">127.0.0.1:8080</span> LoggerService.RestartLogger <span class="hljs-string">''</span></code></pre>
<p>&nbsp;</p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl Config</div></h2>
<pre class="pure-highlightjs"><code class="null hljs nginx"><span class="hljs-attribute">v2ctl</span> config</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">此命令没有参数。它从标准输入读取 JSON 格式的配置，然后从标准输出打印 Protobuf 格式的配置。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl Cert</div></h2>
<pre class="pure-highlightjs"><code class="null hljs css"><span class="hljs-selector-tag">v2ctl</span> <span class="hljs-selector-tag">cert</span> <span class="hljs-selector-attr">[--ca]</span> <span class="hljs-selector-attr">[--domain=v2ray.com]</span> <span class="hljs-selector-attr">[--expire=240h]</span> <span class="hljs-selector-attr">[--name="V2Ray Inc"]</span> <span class="hljs-selector-attr">[--org="V2Ray Inc]</span> <span class="hljs-selector-attr">[--json]</span> <span class="hljs-selector-attr">[--file=v2ray]</span></code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">生成一个 TLS 证书。</span></p>
<ul>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–ca</span></strong>
<ul>
<li><span style="font-size: 12pt;">如果指定此选项，将会生成一个 CA 证书。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–domain</span></strong>
<ul>
<li><span style="font-size: 12pt;">证书的 Alternative Name 项。该参数可以多次使用，来指定多个域名。比如–domain=v2ray.com –domain=v2ray.cool。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–expire</span></strong>
<ul>
<li><span style="font-size: 12pt;">证书有效期。格式为 Golang 的时间长度。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–name</span></strong>
<ul>
<li><span style="font-size: 12pt;">证书的 Command Name 项。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–org</span></strong>
<ul>
<li><span style="font-size: 12pt;">证书的 Orgnization 项。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–json</span></strong>
<ul>
<li><span style="font-size: 12pt;">将生成的证书以 V2Ray 支持的 JSON 格式输出到标准输出。默认开启。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–file</span></strong>
<ul>
<li><span style="font-size: 12pt;">将证书以 PEM 格式输出到文件。当指定 –file=a 时，将生成 a_cert.pem 和 a_key.pem 两个文件。</span></li>
</ul>
</li>
</ul>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl Fetch</div></h2>
<pre class="pure-highlightjs"><code class="null hljs dts">v2ctl fetch <span class="hljs-params">&lt;url&gt;</span></code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">抓取指定的 URL 的内容并输出，只支持 HTTP 和 HTTPS。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl TlsPing</div></h2>
<pre class="pure-highlightjs"><code class="null hljs dts">v2ctl tlsping <span class="hljs-params">&lt;domain&gt;</span> --ip=[ip]</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">向指定的域名发起 TLS 握手。</span></p>
<ul>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">domain</span></strong>
<ul>
<li><span style="font-size: 12pt;">目标域名</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt; color: #ffcc99;">–ip</span></strong>
<ul>
<li><span style="font-size: 12pt;">此域名的 IP 地址。如果未指定此参数，V2Ctl 将使用系统的 DNS 进行域名解析。</span></li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>Verify</div></h2>
<pre class="pure-highlightjs"><code class="null hljs dts">v2ctl verify [--sig=<span class="hljs-meta-keyword">/path/</span>to/sigfile] <span class="hljs-params">&lt;filepath&gt;</span></code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">此命令用于验证一个文件是否由 Project V 官方签名。</span></p>
<ul>
<li><strong><span style="font-size: 12pt;"><span style="color: #ffcc99;">-sig</span></span></strong>
<ul>
<li><span style="font-size: 12pt;">签名文件路径，默认值为待验证文件加入’.sig’后缀。</span></li>
</ul>
</li>
<li><strong><span style="font-size: 12pt;"><span style="color: #ffcc99;">filepath</span></span></strong>
<ul>
<li><span style="font-size: 12pt;">待验证文件路径。</span></li>
</ul>
</li>
</ul>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ctl UUID</div></h2>
<pre class="pure-highlightjs"><code class="null hljs nginx"><span class="hljs-attribute">v2ctl</span> uuid</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">此命令没有参数。每次运行都会输出一个新的 UUID。</span></p>
<hr>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">配置文件</span></strong></div></h1>
<p><span style="font-size: 12pt;">V2Ray 本身使用基于 <a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener noreferrer">Protobuf</a> 的配置。由于 Protobuf 的文本格式不方便阅读，V2Ray 同时也支持 JSON 格式的配置。在运行之前，V2Ray 会自动将 JSON 转换为对应的 Protobuf。换言之，V2Ray 将来也可能会支持其它格式的配置。</span></p>
<p><span style="font-size: 12pt;">以下介绍一下基于 JSON 格式的配置。</span></p>
<p><span style="font-size: 12pt;">JSON，全称&nbsp;<a href="https://en.wikipedia.org/wiki/JSON" target="_blank" rel="noopener noreferrer">JavaScript Object Notation</a>，简而言之是 Javascript 中的对象（Object）。一个 JSON 文件包含一个完整的对象，以大括号“{”开头，大括号“}”结束。</span></p>
<p><span style="font-size: 12pt;">一个 JSON 对象包含一系列的键值对（Key-Value Pair），一个键是一个字符串（String），而值有多种类型，常见的有字符串（String）、数字（Number）、布尔（Bool）、数组（Array）和对象（Object）。下面是一个简单的 JSON 对象示例：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">stringValue</span>": <span class="hljs-string">"This is a string."</span>,
  "<span class="hljs-attr">numberValue</span>": <span class="hljs-number">42</span>,
  "<span class="hljs-attr">boolValue</span>": <span class="hljs-literal">true</span>,
  "<span class="hljs-attr">arrayValue</span>": [<span class="hljs-string">"this"</span>, <span class="hljs-string">"is"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-string">"string"</span>, <span class="hljs-string">"array"</span>],
  "<span class="hljs-attr">objectValue</span>": {
    "<span class="hljs-attr">another</span>": <span class="hljs-string">"object"</span>
  }
}</code></pre>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>JSON 数据类型</div></h2>
<p><span style="font-size: 12pt;">这里介绍一下常用的数据类型，在之后其它的配置中会用到。</span></p>
<pre class="pure-highlightjs"><code class="null hljs cpp">boolean: <span class="hljs-literal">true</span> | <span class="hljs-literal">false</span>
<span class="hljs-meta">#布尔值，只有true和false两种取值，不带引号。</span>

number
<span class="hljs-meta">#数字，在 V2Ray 的使用中通常为非负整数，即0、53…… 数字在 JSON 格式中不带引号。</span>

<span class="hljs-built_in">string</span>
<span class="hljs-meta">#字符串，由引号包含的一串字符，如无特殊说明，字符的内容不限。</span>

<span class="hljs-built_in">array</span>: []
<span class="hljs-meta">#数组，由方括号包含的一组元素，如字符串数组表示为[string]。</span>

object: {}
<span class="hljs-meta">#对象，一组键值对。样例见本文上方的示例。</span></code></pre>
<div class="dw-box dw-box-green"><i class="dwicon-green"></i><span style="color: #ffffff;">● 通常一个键值对的后面需要有一个逗号”,”，但如果这个键值对后面紧跟一个大括号”｝”的话，则一定不能有逗号。</span></div>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>V2Ray 常用数据类型</div></h2>
<pre class="pure-highlightjs"><code class="null hljs css"><span class="hljs-selector-tag">map</span>: <span class="hljs-selector-tag">object</span> {<span class="hljs-attribute">string</span>:string}
#一组键值对，其类型在括号内指出。每一个键和值的类型对应相同。

<span class="hljs-selector-tag">address</span>: <span class="hljs-selector-tag">string</span>
#字符串，表示一个 <span class="hljs-selector-tag">IP</span> 地址或域名，形如："8<span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span>" 或 "<span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.v2ray</span><span class="hljs-selector-class">.com</span>"

<span class="hljs-selector-tag">address_port</span>: <span class="hljs-selector-tag">string</span>
#字符串，表示一个地址和端口，常见的形式如："8<span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-pseudo">:53"</span>，或者 "<span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.v2ray</span><span class="hljs-selector-class">.com</span><span class="hljs-selector-pseudo">:80"</span>。在一部分配置中，地址部分可以省略，如"<span class="hljs-selector-pseudo">:443"</span>。</code></pre>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>配置文件格式<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">请先注意：</span></p>
<ul>
<li><span style="font-size: 12pt;">JSON 所有标点符号都要用半角符号（英文符号）</span></li>
<li><span style="font-size: 12pt;">所有字符串都要加双引号 ” “，键是字符串，所以键也要加双引号，数字不用加双引号</span></li>
<li><span style="font-size: 12pt;">布尔类型也不用加双引号，布尔值只有两个就是 true 和 false，意思就是真和假</span></li>
<li><span style="font-size: 12pt;">对象没有顺序，即大括号 {} 括起来的内容顺序是怎么样都没关系</span></li>
</ul>
<p><span style="font-size: 12pt;">V2Ray 的配置文件形式如下，客户端和服务器通用一种形式，只是实际的配置不一样。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">log</span>": {},
  "<span class="hljs-attr">api</span>": {},
  "<span class="hljs-attr">dns</span>": {},
  "<span class="hljs-attr">stats</span>": {},
  "<span class="hljs-attr">routing</span>": {},
  "<span class="hljs-attr">policy</span>": {},
  "<span class="hljs-attr">reverse</span>": {},
  "<span class="hljs-attr">inbounds</span>": [],
  "<span class="hljs-attr">outbounds</span>": [],
  "<span class="hljs-attr">transport</span>": {}
}</code></pre>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">● V2Ray 的 JSON 格式支持注释，可使用“//”或者“/* */”来进行注释。在不支持注释的编辑器中可能被显示为“错误”，但实际上是可以正常使用的。</span></div>
<div class="dw-box dw-box-grey"><i class="dwicon-grey"></i>
<p><a name="index"></a><span style="font-size: 12pt;">在v2ray的配置文件中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">log</span>:&nbsp;LogObject，日志配置。表示 V2Ray 如何输出日志，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#log">日志配置</a>；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">api</span>: ApiObject，内置的远程控置 API，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#api">API 配置</a>；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">dns</span>: DnsObject，内置的 DNS 服务器，若此项不存在，则默认使用本机的 DNS 设置。详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#dns">DNS 配置（dns）</a>；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">routing</span>: RoutingObject，路由配置，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#routing">路由配置（routing）</a>；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">policy</span>：PolicyObject，本地策略可进行一些权限相关的配置，详见</span><a style="font-size: 16px;" href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#policy">本地策略</a>；</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">inbounds</span>: [InboundObject]，传入连接配置，一个数组，每个元素是一个入站连接配置。详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#inbound">入站连接配置（inbound）</a>；</span>
<ul>
<li><span style="font-size: 12pt;">具体配置参见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">outbounds</span>: [OutboundObject]，传出连接配置，一个数组，每个元素是一个出站连接配置。列表中的第一个元素作为主出站协议。当路由匹配不存在或没有匹配成功时，流量由主出站协议发出。详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#outbound">出站连接配置（outbound）</a>；</span>
<ul>
<li><span style="font-size: 12pt;">具体配置参见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">inboundDetour</span>: <span style="color: #ffff99;">【旧版（3.x）配置，在新版（4+）中已被取消】</span>额外的传入连接配置，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#extrin">额外的传入连接配置（inbound detour）</a>；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">outboundDetour</span>: <span style="color: #ffff99;">【旧版（3.x）配置，在新版（4+）中已被取消】</span>额外的传出连接配置，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#extrout">额外的传出连接配置（outbound detour）</a>；</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">transport</span>: TransportObject，底层传输配置，用于配置 V2Ray 如何与其它服务器建立和使用网络连接。详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#transport">底层传输配置（transport）</a>；</span>
<ul>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#TCP">TCP 传输方式</a></span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#mKCP">mKCP 传输方式</a></span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#WebSocket">WebSocket 传输方式</a></span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HTTP2">HTTP/2 传输方式</a></span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#domainsocket">DomainSocket 传输方式</a></span></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#quic"><span style="font-size: 12pt;">QUIC 传输方式</span></a></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">stats</span>: StatsObject，当此项存在时，开启<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#stats">统计信息</a>。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">reverse</span>: ReverseObject，<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#reverse">反向代理配置</a>。</span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#env">环境变量</a>：V2Ray 的一些底层配置。</span></li>
</ul>
<p><span style="word-spacing: normal;"></span></p></div><div class="dw-box dw-box-grey"><i class="dwicon-grey"></i>
<h2>配置实例：</h2>
<ul>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#eg"><span style="font-size: 12pt;">配置实例</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#advanced"><span style="font-size: 12pt;">高级功能</span></a>
<ul>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#balance"><span style="font-size: 12pt;">均衡负载</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#dynport"><span style="font-size: 12pt;">动态端口</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#outboundproxy"><span style="font-size: 12pt;">代理转发</span></a></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#tls">TLS</a></span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#WTW">WebSocket+TLS+Web</a></span></li>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#cdn">CDN</a></span></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#reverse_eg1"><span style="font-size: 12pt;">反向代理</span></a></li>
</ul>
</li>
</ul>
</div>
<hr>
<p><a name="log"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">日志配置</span></strong></div></h1>
<p><span style="font-size: 12pt;">配置如下：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">access</span>": <span class="hljs-string">"文件地址"</span>,
  "<span class="hljs-attr">error</span>": <span class="hljs-string">"文件地址"</span>,
  "<span class="hljs-attr">loglevel</span>": <span class="hljs-string">"warning"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>access</strong></span>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">访问日志的文件地址，其值是一个合法的文件地址，如”/tmp/v2ray/_access.log”（Linux）或者”C:\\Temp\\v2ray\\_access.log”（Windows）。当此项不指定或为空值时，表示将日志输出至 stdout。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>error</strong></span>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">错误日志的文件地址，其值是一个合法的文件地址，如”/tmp/v2ray/_error.log”（Linux）或者”C:\\Temp\\v2ray\\_error.log”（Windows）。当此项不指定或为空值时，表示将日志输出至 stdout。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>loglevel</strong></span>:&nbsp;“debug” | “info” | “warning” | “error” | “none”</span>
<ul>
<li><span style="font-size: 12pt;">错误日志的级别。默认值为”warning”。</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">debug</span>“: 只有开发人员能看懂的信息。同时包含所有”info”内容。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">info</span>“: V2Ray 在运行时的状态，不影响正常使用。同时包含所有”warning”内容。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">warning</span>“: V2Ray 遇到了一些问题，通常是外部问题，不影响 V2Ray 的正常运行，但有可能影响用户的体验。同时包含所有”error”内容。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">error</span>“: V2Ray 遇到了无法正常运行的问题，需要立即解决。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">none</span>“: 不记录任何内容。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="api"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">远程控制</span></strong></div></h1>
<p><span style="font-size: 12pt;">V2Ray 中可以开放一些 API 以便远程调用。这些 API 都基于 <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC</a>。</span></p>
<p><span style="font-size: 12pt;">当远程控制开启时，当远程控制开启时，V2Ray 会自建一个出站代理，以tag配置的值为标识。用户必须手动将所有的 gRPC 入站连接通过<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#routing">路由</a>指向这一出站代理。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>ApiObject</div></h2>
<p><span style="font-size: 12pt;">ApiObject对应配置文件中的api项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"api"</span>,
    "<span class="hljs-attr">services</span>": [
        <span class="hljs-string">"HandlerService"</span>,
        <span class="hljs-string">"LoggerService"</span>,
        <span class="hljs-string">"StatsService"</span>
    ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string </span>
<ul>
<li><span style="font-size: 12pt;">传出代理标识。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">services</span></strong>:&nbsp;[string]</span>
<ul>
<li><span style="font-size: 12pt;">开启的 API 列表，可选的值见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#api-list">API 列表</a>。</span></li>
</ul>
</li>
</ul>
<h2><a id="api-list"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>支持的 API 列表</div></h2>
<h3><span style="color: #ffcc99;">HandlerService</span></h3>
<p><span style="font-size: 12pt;">一些对于传入传出代理进行修改的 API，可用的功能如下：</span></p>
<ul>
<li><span style="font-size: 12pt;">添加一个新的传入代理；</span></li>
<li><span style="font-size: 12pt;">添加一个新的传出代理；</span></li>
<li><span style="font-size: 12pt;">删除一个现有的传入代理；</span></li>
<li><span style="font-size: 12pt;">删除一个现有的传出代理；</span></li>
<li><span style="font-size: 12pt;">在一个传入代理中添加一个用户（仅支持 VMess）；</span></li>
<li><span style="font-size: 12pt;">在一个传入代理中删除一个用户（仅支持 VMess）；</span></li>
</ul>
<h3><span style="color: #ffcc99;">LoggerService</span></h3>
<p><span style="font-size: 12pt;">支持对内置 Logger 的重启，可配合 logrotate 进行一些对日志文件的操作。</span></p>
<h3><span style="color: #ffcc99;">StatsService</span></h3>
<p><span style="font-size: 12pt;">内置的数据统计服务，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#stats">统计信息</a>。</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="dns"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">DNS 服务器</span></strong></div></h1>
<p><span style="font-size: 12pt;">V2Ray 内置了一个 DNS 服务器，可以将 DNS 查询根据路由设置转发到不同的远程服务器中。由此 DNS 服务器所发出的 DNS 查询请求，会自动根据路由配置进行转发，无需额外配置。若此项不存在，则默认使用本机的 DNS 设置。</span></p>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">● </span><span style="color: #ffffff;">由于 DNS 协议的复杂性，V2Ray 只支持最基本的 IP 查询（A 和 AAAA 记录）。推荐使用本机 DNS 配合一个额外的 DNS 服务器来做 DNS 查询，如<span style="color: #ffcc00;"><a style="color: #ffcc00;" href="https://coredns.io/" target="_blank" rel="noopener noreferrer">CoreDNS</a></span>，以使用完整的 DNS 功能。</span></div>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>DnsObject<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">DnsObject对应配置文件中的dns项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">hosts</span>": {
    "<span class="hljs-attr">baidu.com</span>": <span class="hljs-string">"127.0.0.1"</span>
  },
  "<span class="hljs-attr">servers</span>": [
      {
        "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.2.3.4"</span>,
        "<span class="hljs-attr">port</span>": <span class="hljs-number">5353</span>,
        "<span class="hljs-attr">domains</span>": [
          <span class="hljs-string">"domain:v2ray.com"</span>
        ],
      },
      <span class="hljs-string">"8.8.8.8"</span>,
      <span class="hljs-string">"8.8.4.4"</span>,
      <span class="hljs-string">"localhost"</span>
  ],
  "<span class="hljs-attr">clientIp</span>": <span class="hljs-string">"1.2.3.4"</span>,
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"dns_inbound"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">hosts</span></strong>:&nbsp;map{string: address}</span>
<ul>
<li><span style="font-size: 12pt;">静态 IP 列表，其值为一系列的”域名”:”IP”。IP 可以是 IPv4 或者 IPv6。在解析域名时，如果域名匹配这个列表中的某一项，则解析结果为该项的 IP，而不会使用下述的 servers 进行解析。</span></li>
<li><span style="font-size: 12pt;">域名的格式和<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#routing">路由</a>中的域名格式一样。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">servers</span></strong>:&nbsp;[string | <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ServerObject_DnsObject">ServerObject</a> | “localhost” ]</span>
<ul>
<li><span style="font-size: 12pt;">指定一个 DNS 服务器列表，支持的类型有三种：IP 地址（字符串形式），ServerObject，或者”localhost”。</span></li>
<li><span style="font-size: 12pt;">当它的值是一个 IP 地址时，如”8.8.8.8″，V2Ray 会使用此地址的 53 端口进行 DNS 查询。</span></li>
<li><span style="font-size: 12pt;">当值为”localhost”时，表示使用本机预设的 DNS 配置。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">●&nbsp;当使用 localhost 时，本机的 DNS 请求不受 V2Ray 控制，需要额外的配置才可以使 DNS 请求由 V2Ray 转发。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">clientIp</span></strong>: string </span>
<ul>
<li><span style="font-size: 12pt;">当前系统的 IP 地址，用于 DNS 查询时，通知服务器客户端的所在位置。不能是私有地址。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.13+) 由此 DNS 发出的查询流量，除localhost外，都会带有此标识，可在路由使用inboundTag进行匹配。</span></li>
</ul>
</li>
</ul>
<h2><a id="ServerObject_DnsObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>ServerObject</div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.2.3.4"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">5353</span>,
  "<span class="hljs-attr">domains</span>": [
    <span class="hljs-string">"domain:v2ray.com"</span>
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">address</span></strong>: address</span>
<ul>
<li>DNS 服务器地址，如”<span style="color: #ffcc99;">8.8.8.8</span>“。目前只支持 UDP 协议的 DNS 服务器。</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: number</span>
<ul>
<li>DNS 服务器端口，如<span style="color: #ffcc99;">53</span>。</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domains</span></strong>: [string]</span>
<ul>
<li>一个域名列表，此列表包含的域名，将优先使用此服务器进行查询。域名格式和<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#routing">路由配置</a>中相同</li>
</ul>
</li>
</ul>
<p><span style="font-size: 12pt;">若要使 DNS 服务生效，需要配置路由功能中的 <span style="color: #ffcc99;">domainStrategy</span>。</span></p>
<p><span style="font-size: 12pt;">当某个 DNS 服务器指定的域名列表匹配了当前要查询的域名，V2Ray 会优先使用这个 DNS 服务器进行查询，否则按从上往下的顺序进行查询。</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="routing"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">路由功能</span></strong></div></h1>
<p><span style="font-size: 12pt;">V2Ray 内建了一个简单的路由功能，可以将传入数据按需求由不同的传出连接发出，以达到按需代理的目的。这一功能的常见用法是分流国内外流量，V2Ray 可以通过内部机制判断不同地区的流量，然后将它们发送到不同的传出代理。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>RoutingObject</div></h2>
<p><span style="font-size: 12pt;">RoutingObject 对应主配置文件中的routing项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">domainStrategy</span>": <span class="hljs-string">"AsIs"</span>,
  "<span class="hljs-attr">rules</span>": [],
  "<span class="hljs-attr">balancers</span>": []
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domainStrategy: </span></strong>“AsIs” | “IPIfNonMatch” | “IPOnDemand”</span>
<ul>
<li><span style="font-size: 12pt;">域名解析策略，根据不同的设置使用不同的策略。</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">AsIs</span>“: 只使用域名进行路由选择。默认值。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">IPIfNonMatch</span>“: 当域名没有匹配任何规则时，将域名解析成 IP（A 记录或 AAAA 记录）再次进行匹配；</span>
<ul>
<li><span style="font-size: 12pt;">当一个域名有多个 A 记录时，会尝试匹配所有的 A 记录，直到其中一个与某个规则匹配为止；</span></li>
<li><span style="font-size: 12pt;">解析后的 IP 仅在路由选择时起作用，转发的数据包中依然使用原始域名；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">IPOnDemand</span>“: 当匹配时碰到任何基于 IP 的规则，将域名立即解析为 IP 进行匹配；</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">rules</span></strong>: [<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#RuleObject">RuleObject</a>]</span>
<ul>
<li><span style="font-size: 12pt;">对应一个数组，数组中每个元素是一个规则。对于每一个连接，路由将根据这些规则依次进行判断，当一个规则生效时，即将这个连接转发至它所指定的<span style="color: #ffcc99;">outboundTag</span>(或<span style="color: #ffcc99;">balancerTag</span>，V2Ray 4.4+)。当没有匹配到任何规则时，流量默认由主出站协议发出。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">balancers</span></strong>: [ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#BalancerObject">BalancerObject </a>]</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.4+)一个数组，数组中每个元素是一个负载均衡器的配置。当一个规则指向一个负载均衡器时，V2Ray 会通过此负载均衡器选出一个出站协议，然后由它转发流量。</span></li>
</ul>
</li>
</ul>
<div class="su-spoiler su-spoiler-style-default su-spoiler-icon-plus su-spoiler-closed" data-scroll-offset="0"><div class="su-spoiler-title" tabindex="0" role="button"><span class="su-spoiler-icon"></span>旧版（3.x）配置已失效并被折叠，新版（4+）请忽略此内容</div><div class="su-spoiler-content su-u-clearfix su-u-trim">
<p><span style="color: #ffcc99;"><strong><span style="font-size: 12pt;">此项为旧版（3.x）配置，已失效且被折叠，新版（4+）请忽略此部分</span></strong></span></p>
<p><span style="font-size: 12pt;">每一个规则的详细格式如下：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
  "<span class="hljs-attr">domain</span>": [
    <span class="hljs-string">"baidu.com"</span>,
    <span class="hljs-string">"qq.com"</span>,
    <span class="hljs-string">"geosite:cn"</span>
  ],
  "<span class="hljs-attr">ip</span>": [
    <span class="hljs-string">"0.0.0.0/8"</span>,
    <span class="hljs-string">"10.0.0.0/8"</span>,
    <span class="hljs-string">"fc00::/7"</span>,
    <span class="hljs-string">"fe80::/10"</span>,
    <span class="hljs-string">"geoip:cn"</span>
  ],
  "<span class="hljs-attr">port</span>": <span class="hljs-string">"0-100"</span>,
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
  "<span class="hljs-attr">source</span>": [
    <span class="hljs-string">"10.0.0.1"</span>
  ],
  "<span class="hljs-attr">user</span>": [
    <span class="hljs-string">"love@v2ray.com"</span>
  ],
  "<span class="hljs-attr">inboundTag</span>": [
    <span class="hljs-string">"tag-vmess"</span>
  ],
  "<span class="hljs-attr">protocol</span>":[<span class="hljs-string">"http"</span>, <span class="hljs-string">"tls"</span>, <span class="hljs-string">"bittorrent"</span>],
  "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">type</span></strong>: 目前只支持”<span style="color: #ffcc99;">field</span>“。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domain</span></strong>: 一个数组，数组每一项是一个域名的匹配。有四种形式：</span>
<ul>
<li><span style="font-size: 12pt;">纯字符串: 当此字符串匹配目标域名中任意部分，该规则生效。比如”sina.com”可以匹配”sina.com”、”sina.com.cn”和”www.sina.com”，但不匹配”sina.cn”。</span></li>
<li><span style="font-size: 12pt;">正则表达式: 由”<span style="color: #ffcc99;">regexp:</span>“开始，余下部分是一个正则表达式。当此正则表达式匹配目标域名时，该规则生效。例如”regexp:\\.goo.*\\.com$”匹配”www.google.com”、”fonts.googleapis.com”，但不匹配”google.com”。</span></li>
<li><span style="font-size: 12pt;">子域名 (推荐): 由”<span style="color: #ffcc99;">domain:</span>“开始，余下部分是一个域名。当此域名是目标域名或其子域名时，该规则生效。例如”domain:v2ray.com”匹配”www.v2ray.com”、”v2ray.com”，但不匹配”xv2ray.com”。</span></li>
<li><span style="font-size: 12pt;">完整匹配 (V2Ray 3.36+): 由”<span style="color: #ffcc99;">full:</span>“开始，余下部分是一个域名。当此域名完整匹配目标域名时，该规则生效。例如”full:v2ray.com”匹配”v2ray.com”但不匹配”www.v2ray.com”。</span></li>
<li><span style="font-size: 12pt;">特殊值”<span style="color: #ffcc99;">geosite:cn</span>“: 内置了一些<a href="https://github.com/v2ray/ext/blob/master/tools/geosites/cn.go" target="_blank" rel="noopener noreferrer">常见的国内网站域名</a>。</span></li>
<li><span style="font-size: 12pt;">特殊值”<span style="color: #ffcc99;">geosite:speedtest</span>”&nbsp;(V2Ray 3.32+): Speedtest.net 的所有公用服务器列表。</span></li>
<li><span style="font-size: 12pt;">从文件中加载域名: 形如”<span style="color: #ffcc99;">ext:file:tag</span>“，必须以<span style="color: #ffcc99;">ext:</span>（小写）开头，后面跟文件名和标签，文件存放在<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#env_config-location">资源目录</a>中，文件格式与<span style="color: #ffcc99;">geosite.dat</span>相同，标签必须在文件中存在。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">ip</span></strong>: 一个数组，数组内每一个元素代表一个 IP 范围。当某一元素匹配目标 IP 时，此规则生效。有三种形式：</span>
<ul>
<li><span style="font-size: 12pt;">IP: 形如”<span style="color: #ffcc99;">127.0.0.1</span>“。</span></li>
<li><span style="font-size: 12pt;"><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CIDR</a></span></li>
<li><span style="font-size: 12pt;">GeoIP: 形如”<span style="color: #ffcc99;">geoip:cn</span>“，必须以<span style="color: #ffcc99;">geoip:</span>（小写）开头，后面跟双字符国家代码，支持几乎所有可以上网的国家。</span>
<ul>
<li><span style="font-size: 12pt;">特殊值：”<span style="color: #ffcc99;">geoip:private</span>”&nbsp;(V2Ray 3.5+)，包含所有私有地址，如<span style="color: #ffcc99;">127.0.0.1</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">从文件中加载 IP (V2Ray 3.23+): 形如”<span style="color: #ffcc99;">ext:file:tag</span>“，必须以<span style="color: #ffcc99;">ext:</span>（小写）开头，后面跟文件名和标签，文件存放在<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#env_config-location">资源目录</a>中，文件格式与<span style="color: #ffcc99;">geoip.dat</span>相同标签必须在文件中存在。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>：端口范围，有两种形式：</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">a-b</span>“: a 和 b 均为正整数，且小于 65536。这个范围是一个前后闭合区间，当目标端口落在此范围内时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">a</span>: a 为正整数，且小于 65536。当目标端口为 a 时，此规则生效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>: 可选的值有”<span style="color: #ffcc99;">tcp</span>“、”<span style="color: #ffcc99;">udp</span>“或”<span style="color: #ffcc99;">tcp,udp</span>“，当连接方式是指定的方式时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">source</span></strong>: 一个数组，数组内每一个元素是一个 IP 或 CIDR。当某一元素匹配来源 IP 时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">user</span></strong>: 一个数组，数组内每一个元素是一个邮箱地址。当某一元素匹配来源用户时，此规则生效。当前 Shadowsocks 和 VMess 支持此规则。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">inboundTag</span></strong>: 一个数组，数组内每一个元素是一个标识。当某一元素匹配传入协议的标识时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">protocol</span></strong>: 一个数组，数组内每一个元素表示一种协议。当某一个协议匹配当前连接的流量时，此规则生效。</span>
<ul>
<li><span style="font-size: 12pt;">可选的值有”<span style="color: #ffcc99;">http</span>“、”<span style="color: #ffcc99;">tls</span>“、”<span style="color: #ffcc99;">bittorrent</span>“，均为小写。</span></li>
<li><span style="font-size: 12pt;">必须开启传入代理中的<span style="color: #ffcc99;">sniffing</span>选项。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">outboundTag&nbsp;</span></strong>对应一个<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">额外传出连接配置</a>的标识。</span></li>
</ul>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>field</strong></div></span></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
  "<span class="hljs-attr">domain</span>": [
    <span class="hljs-string">"baidu.com"</span>,
    <span class="hljs-string">"qq.com"</span>,
    <span class="hljs-string">"geosite:cn"</span>
  ],
  "<span class="hljs-attr">ip</span>": [
    <span class="hljs-string">"0.0.0.0/8"</span>,
    <span class="hljs-string">"10.0.0.0/8"</span>,
    <span class="hljs-string">"fc00::/7"</span>,
    <span class="hljs-string">"fe80::/10"</span>,
    <span class="hljs-string">"geoip:cn"</span>
  ],
  "<span class="hljs-attr">port</span>": <span class="hljs-string">"0-100"</span>,
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
  "<span class="hljs-attr">source</span>": [
    <span class="hljs-string">"10.0.0.1"</span>,
  ],
  "<span class="hljs-attr">user</span>": [
    <span class="hljs-string">"love@v2ray.com"</span>
  ],
  "<span class="hljs-attr">inboundTag</span>": [
    <span class="hljs-string">"tag-vmess"</span>
  ],
  "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domain</span></strong>: 一个数组，数组每一项是一个域名的匹配。有四种形式：</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">纯字符串</span>: 当此字符串匹配目标域名中任意部分，该规则生效。比如”sina.com”可以匹配”sina.com”、”sina.com.cn”和”www.sina.com”，但不匹配”sina.cn”。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">正则表达式</span>: 由”regexp:”开始，余下部分是一个正则表达式。当此正则表达式匹配目标域名时，该规则生效。例如”regexp:\\.goo.*\\.com$”匹配”www.google.com”、”fonts.googleapis.com”，但不匹配”google.com”。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">子域名</span>: 由”domain:”开始，余下部分是一个域名。当此域名是目标域名或其子域名时，该规则生效。例如”domain:v2ray.com”匹配”www.v2ray.com”、”v2ray.com”，但不匹配”xv2ray.com”。</span></li>
<li><span style="font-size: 12pt;">常用国内域名 (V2Ray 2.46+): 特殊值”geosite:cn”，内置了一些常见的国内网站域名。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">ip</span></strong>: 一个数组，数组内每一个元素代表一个 IP 范围。当某一元素匹配目标 IP 时，此规则生效。有三种形式：</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">IP</span>: 形如”127.0.0.1″。</span></li>
<li><span style="text-decoration: underline;"><span style="font-size: 12pt; color: #ffcc99; text-decoration: underline;"><a style="color: #ffcc99; text-decoration: underline;" href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CIDR</a></span></span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">GeoIP</span> (V2Ray 2.46+): 形如”geoip:cn”，必须以geoip:（小写）开头，后面跟双字符国家代码，支持几乎所有可以上网的国家。</span>
<ul>
<li><span style="font-size: 12pt;">特殊值：”geoip:private” (V2Ray 3.5+)，包含所有私有地址，如127.0.0.1。</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>：端口范围，有两种形式：</span>
<ul>
<li><span style="font-size: 12pt;">“a-b”: a 和 b 均为正整数，且小于 65536。这个范围是一个前后闭合区间，当目标端口落在此范围内时，此规则生效。</span></li>
<li><span style="font-size: 12pt;">a: a 为正整数，且小于 65536。当目标端口为 a 时，此规则生效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>: 可选的值有”tcp”、”udp”或”tcp,udp”，当连接方式是指定的方式时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">source</span></strong>: 一个数组，数组内每一个元素是一个 IP 或 CIDR。当某一元素匹配来源 IP 时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">user</span></strong>: 一个数组，数组内每一个元素是一个邮箱地址。当某一元素匹配来源用户时，此规则生效。当前 Shadowsocks 和 VMess 支持此规则。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">inboundTag</span></strong>: 一个数组，数组内每一个元素是一个标识。当某一元素匹配传入协议的标识时，此规则生效。</span></li>
</ul>
<p><span style="font-size: 12pt;">一些特殊情况：</span></p>
<ul>
<li><span style="font-size: 12pt;">当多个属性同时指定时，这些属性需要同时满足，才可以使当前规则生效；</span>
<ul>
<li><span style="font-size: 12pt;">如果多个规则分别使用了domain或者ip，需要对应添加多条规则；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">当一个网络连接指定了域名，而一个规则中只有 IP 规则，没有域名规则，则这个规则永远不会生效，反之亦然。</span></li>
</ul>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>chinaip</strong></div></span></h2>
<p><span style="font-size: 12pt;">此规则配置如下，没有额外属性。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"chinaip"</span>,
  "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">chinaip 会匹配所有中国境内的 IP，目前只包含 IPv4 数据。IP 段信息由 <a href="https://github.com/shadowsocks/ChinaDNS" target="_blank" rel="noopener noreferrer">ChinaDNS</a> 中给出的脚本生成。</span></p>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>chinasites</strong></div></span></h2>
<p><span style="font-size: 12pt;">此规则配置如下，没有额外属性。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"chinasites"</span>,
  "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">同上述的”geosite:cn”，如果目标域名为这些域名其中之一时，此规则生效。[/bg_collapse]</span></p>
<h2>小贴士</h2>
<ul>
<li><span style="font-size: 12pt;">当多个属性同时指定时，这些属性需要同时满足，才可以使当前规则生效；</span>
<ul>
<li><span style="font-size: 12pt;">如果多个规则分别使用了<span style="color: #ffcc99;">domain</span>或者<span style="color: #ffcc99;">ip</span>，需要对应添加多条规则；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">ext:geoip.dat:cn</span>“等价于”<span style="color: #ffcc99;">geoip:cn</span>“。</span></li>
<li><span style="font-size: 12pt;">域名匹配模式中，推荐使用子域名模式（即以”domain:”开头）。</span></li>
</ul>
</div></div>
<h2><a id="RuleObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>RuleObject</div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
  "<span class="hljs-attr">domain</span>": [
    <span class="hljs-string">"baidu.com"</span>,
    <span class="hljs-string">"qq.com"</span>,
    <span class="hljs-string">"geosite:cn"</span>
  ],
  "<span class="hljs-attr">ip</span>": [
    <span class="hljs-string">"0.0.0.0/8"</span>,
    <span class="hljs-string">"10.0.0.0/8"</span>,
    <span class="hljs-string">"fc00::/7"</span>,
    <span class="hljs-string">"fe80::/10"</span>,
    <span class="hljs-string">"geoip:cn"</span>
  ],
  "<span class="hljs-attr">port</span>": <span class="hljs-string">"0-100"</span>,
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
  "<span class="hljs-attr">source</span>": [
    <span class="hljs-string">"10.0.0.1"</span>
  ],
  "<span class="hljs-attr">user</span>": [
    <span class="hljs-string">"love@v2ray.com"</span>
  ],
  "<span class="hljs-attr">inboundTag</span>": [
    <span class="hljs-string">"tag-vmess"</span>
  ],
  "<span class="hljs-attr">protocol</span>":[<span class="hljs-string">"http"</span>, <span class="hljs-string">"tls"</span>, <span class="hljs-string">"bittorrent"</span>],
  "<span class="hljs-attr">attrs</span>": <span class="hljs-string">"attrs[':method'] == 'GET'"</span>,
  "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>,
  "<span class="hljs-attr">balancerTag</span>": <span class="hljs-string">"balancer"</span>
}</code></pre>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">●<span style="font-size: 12pt;"> 当多个属性同时指定时，这些属性需要同时满足，才可以使当前规则生效。如果多个规则分别使用了<span style="color: #ffcc00;">domain</span>或者<span style="color: #ffcc00;">ip</span>，需要对应添加多条规则。</span></span></div>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">type</span></strong>: “field”</span>
<ul>
<li><span style="font-size: 12pt;">目前只支持”<span style="color: #ffcc99;">field</span>“这一个选项。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domain</span></strong>: [string]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组每一项是一个域名的匹配。有以下几种形式：</span>
<ul>
<li><span style="font-size: 12pt;">纯字符串: 当此字符串匹配目标域名中任意部分，该规则生效。比如”sina.com”可以匹配”sina.com”、”sina.com.cn”和”www.sina.com”，但不匹配”sina.cn”。</span></li>
<li><span style="font-size: 12pt;">正则表达式: 由”<span style="color: #ffcc99;">regexp:</span>“开始，余下部分是一个正则表达式。当此正则表达式匹配目标域名时，该规则生效。例如”regexp:\\.goo.*\\.com$”匹配”www.google.com”、”fonts.googleapis.com”，但不匹配”google.com”。</span></li>
<li><span style="font-size: 12pt;">子域名 (推荐): 由”<span style="color: #ffcc99;">domain:</span>“开始，余下部分是一个域名。当此域名是目标域名或其子域名时，该规则生效。例如”domain:v2ray.com”匹配”www.v2ray.com”、”v2ray.com”，但不匹配”xv2ray.com”。</span></li>
<li><span style="font-size: 12pt;">完整匹配: 由”<span style="color: #ffcc99;">full:</span>“开始，余下部分是一个域名。当此域名完整匹配目标域名时，该规则生效。例如”full:v2ray.com”匹配”v2ray.com”但不匹配”www.v2ray.com”。</span></li>
<li><span style="font-size: 12pt;">预定义域名列表：由”<span style="color: #ffcc99;">geosite:</span>“开头，余下部分是一个名称，如<span style="color: #ffcc99;">geosite:google</span>或者<span style="color: #ffcc99;">geosite:cn</span>。名称及域名列表参考<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#dnsdlc">预定义域名列表</a>。</span></li>
<li><span style="font-size: 12pt;">从文件中加载域名: 形如”<span style="color: #ffcc99;">ext:file:tag</span>“，必须以<span style="color: #ffcc99;">ext:</span>（小写）开头，后面跟文件名和标签，文件存放在<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#env">资源目录</a>中，文件格式与<span style="color: #ffcc99;">geosite.dat</span>相同，标签必须在文件中存在。</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">ip</span></strong>: [string]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组内每一个元素代表一个 IP 范围。当某一元素匹配目标 IP 时，此规则生效。有以下几种形式：</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">IP</span>: 形如”<span style="color: #ffcc99;">127.0.0.1</span>“。</span></li>
<li><span style="font-size: 12pt;"><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CIDR</a>: 形如”<span style="color: #ffcc99;">10.0.0.0/8</span>“.</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">GeoIP</span>: 形如”<span style="color: #ffcc99;">geoip:cn</span>“，必须以<span style="color: #ffcc99;">geoip:</span>（小写）开头，后面跟双字符国家代码，支持几乎所有可以上网的国家。</span>
<ul>
<li><span style="font-size: 12pt;">特殊值：”<span style="color: #ffcc99;">geoip:private</span>” (V2Ray 3.5+)，包含所有私有地址，如127.0.0.1。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">从文件中加载 IP: 形如”<span style="color: #ffcc99;">ext:file:tag</span>“，必须以<span style="color: #ffcc99;">ext:</span>（小写）开头，后面跟文件名和标签，文件存放在资源目录中，文件格式与geoip.dat相同标签必须在文件中存在。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● “<span style="color: #ffcc00;">ext:geoip.dat:cn</span>“等价于”<span style="color: #ffcc00;">geoip:cn</span>“</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: number | string</span>
<ul>
<li><span style="font-size: 12pt;">端口范围，有两种形式：</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">a-b</span>“: a 和 b 均为正整数，且小于 65536。这个范围是一个前后闭合区间，当目标端口落在此范围内时，此规则生效。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">a</span>: a 为正整数，且小于 65536。当目标端口为 a 时，此规则生效。</span></li>
<li><span style="font-size: 12pt;">(V2Ray 4.18+) 以上两种形式的混合，以逗号”,”分隔。形如：”53,443,1000-2000″。</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>: “tcp” | “udp” | “tcp,udp”</span>
<ul>
<li><span style="font-size: 12pt;">可选的值有”<span style="color: #ffcc99;">tcp</span>“、”<span style="color: #ffcc99;">udp</span>“或”<span style="color: #ffcc99;">tcp,udp</span>“，当连接方式是指定的方式时，此规则生效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">source</span></strong>: [string]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组内每一个元素是一个 IP 或 CIDR。当某一元素匹配来源 IP 时，此规则生效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">user</span></strong>: [string]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组内每一个元素是一个邮箱地址。当某一元素匹配来源用户时，此规则生效。当前 Shadowsocks 和 VMess 支持此规则。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">inboundTag</span></strong>: [string]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组内每一个元素是一个标识。当某一元素匹配入站协议的标识时，此规则生效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">protocol</span></strong>: [ “http” | “tls” | “bittorrent” ]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组内每一个元素表示一种协议。当某一个协议匹配当前连接的流量时，此规则生效。必须开启入站代理中的<span style="color: #ffcc99;">sniffing</span>选项。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">attrs</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.18+) 一段脚本，用于检测流量的属性值。当此脚本返回真值时，此规则生效。</span></li>
<li><span style="font-size: 12pt;">脚本语言为 Starlark，它的语法是 Python 的子集。脚本接受一个全局变量attrs，其中包含了流量相关的属性。</span></li>
<li><span style="font-size: 12pt;">目前只有 http 入站代理会设置这一属性。</span></li>
<li><span style="font-size: 12pt;">示例：</span>
<ul>
<li><span style="font-size: 12pt;">检测 HTTP GET: “attrs[‘:method’] == ‘GET'”</span></li>
<li><span style="font-size: 12pt;">检测 HTTP Path: “attrs[‘:path’].startswith(‘/test’)”</span></li>
<li><span style="font-size: 12pt;">检测 Content Type: “attrs[‘accept’].index(‘text/html’) &gt;= 0”</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">outboundTag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">对应一个<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">额外出站连接配置</a>的标识。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">balancerTag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">对应一个负载均衡器的标识。<span style="color: #ffcc99;">balancerTag</span>和<span style="color: #ffcc99;">outboundTag</span>须二选一。当同时指定时，<span style="color: #ffcc99;">outboundTag</span>生效。</span></li>
</ul>
</li>
</ul>
<h2><a id="BalancerObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>BalancerObject<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">负载均衡器配置。当一个负载均衡器生效时，它会从指定的出站协议中，按配置选出一个最合适的出站协议，进行流量转发。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"balancer"</span>,
  "<span class="hljs-attr">selector</span>": []
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">此负载均衡器的标识，用于匹配<span style="color: #ffcc99;">RuleObject</span>中的<span style="color: #ffcc99;">balancerTag</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">selector</span></strong>: [ string ]</span>
<ul>
<li><span style="font-size: 12pt;">一个字符串数组，其中每一个字符串将用于和出站协议标识的前缀匹配。在以下几个出站协议标识中：[ “<span style="color: #ffcc99;">a</span>“, “<span style="color: #ffcc99;">ab</span>“, “<span style="color: #ffcc99;">c</span>“, “<span style="color: #ffcc99;">ba</span>” ]，”<span style="color: #ffcc99;">selector</span>“: [“<span style="color: #ffcc99;">a</span>“]将匹配到[ “<span style="color: #ffcc99;">a</span>“, “<span style="color: #ffcc99;">ab</span>” ]。</span></li>
<li><span style="font-size: 12pt;">如果匹配到多个出站协议，负载均衡器目前会从中随机选出一个作为最终的出站协议。</span></li>
</ul>
</li>
</ul>
<h2><a id="dnsdlc"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>预定义域名列表<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">此列表由<a href="https://github.com/v2ray/domain-list-community" target="_blank" rel="noopener noreferrer">domain-list-community</a>项目维护，预置于每一个 V2Ray 的安装包中，文件名为geosite.dat。</span></p>
<p><span style="font-size: 12pt;">这个文件包含了一些常见的域名，可用于路由和 DNS 筛选。常用的域名有：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">category-ads</span>: 包含了常见的广告域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">category-ads-all</span>: 包含了常见的广告域名，以及广告提供商的域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">cn</span>: 相当于 geolocation-cn 和 tld-cn 的合集。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">google</span>: 包含了 Google 旗下的所有域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">facebook</span>: 包含了 Facebook 旗下的所有域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">geolocation-cn</span>: 包含了常见的国内站点的域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">geolocation-!cn</span>: 包含了常见的非国内站点的域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">speedtest</span>: 包含了所有 Speedtest 所用的域名。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">tld-cn</span>: 包含了所有 .cn 和 .中国 结尾的域名。</span></li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="policy"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">本地策略</span></strong></div></h1>
<p><span style="font-size: 12pt;">本地策略可以配置一些用户相关的权限，比如连接超时设置。V2Ray 处理的每一个连接，都对应到一个用户，按照这个用户的等级（level）应用不同的策略。本地策略可按照等级的不同而变化。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>PolicyObject<span style="word-spacing: normal;"></span></div></h2>
<p>PolicyObject对应配置文件中的policy项。</p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">levels</span>": {
    "<span class="hljs-attr">0</span>": {
      "<span class="hljs-attr">handshake</span>": <span class="hljs-number">4</span>,
      "<span class="hljs-attr">connIdle</span>": <span class="hljs-number">300</span>,
      "<span class="hljs-attr">uplinkOnly</span>": <span class="hljs-number">2</span>,
      "<span class="hljs-attr">downlinkOnly</span>": <span class="hljs-number">5</span>,
      "<span class="hljs-attr">statsUserUplink</span>": <span class="hljs-literal">false</span>,
      "<span class="hljs-attr">statsUserDownlink</span>": <span class="hljs-literal">false</span>,
      "<span class="hljs-attr">bufferSize</span>": <span class="hljs-number">10240</span>
    }
  },
  "<span class="hljs-attr">system</span>": {
    "<span class="hljs-attr">statsInboundUplink</span>": <span class="hljs-literal">false</span>,
    "<span class="hljs-attr">statsInboundDownlink</span>": <span class="hljs-literal">false</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>:&nbsp;map{string: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#LevelPolicyObject">LevelPolicyObject</a>}</span>
<ul>
<li><span style="font-size: 12pt;"> 一组键值对，一组键值对，每个键是一个字符串形式的数字（JSON 的要求），比如 “0”、”1″ 等，双引号不能省略，这个数字对应用户等级。每一个值是一个 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#LevelPolicyObject">LevelPolicyObject</a>。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt;"><span style="color: #ffffff;">●</span> 每个入站出站代理现在都可以设置用户等级，V2Ray 会根据实际的用户等级应用不同的本地策略。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">system</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#SystemPolicyObject">SystemPolicyObject</a></span>
<ul>
<li><span style="font-size: 12pt;">V2Ray 系统的策略</span></li>
</ul>
</li>
</ul>
<h2><a id="LevelPolicyObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>LevelPolicyObject</div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">handshake</span>": <span class="hljs-number">4</span>,
  "<span class="hljs-attr">connIdle</span>": <span class="hljs-number">300</span>,
  "<span class="hljs-attr">uplinkOnly</span>": <span class="hljs-number">2</span>,
  "<span class="hljs-attr">downlinkOnly</span>": <span class="hljs-number">5</span>,
  "<span class="hljs-attr">statsUserUplink</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">statsUserDownlink</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">bufferSize</span>": <span class="hljs-number">10240</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">handshake</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">连接建立时的握手时间限制。单位为秒。默认值为4。在入站代理处理一个新连接时，在握手阶段（比如 VMess 读取头部数据，判断目标服务器地址），如果使用的时间超过这个时间，则中断该连接。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">connIdle</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">连接空闲的时间限制。单位为秒。默认值为300。在入站出站代理处理一个连接时，如果在 connIdle 时间内，没有任何数据被传输（包括上行和下行数据），则中断该连接。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">uplinkOnly</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">当连接下行线路关闭后的时间限制。单位为秒。默认值为2。当服务器（如远端网站）关闭下行连接时，出站代理会在等待 uplinkOnly 时间后中断连接。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">downlinkOnly</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">当连接上行线路关闭后的时间限制。单位为秒。默认值为5。当客户端（如浏览器）关闭上行连接时，入站代理会在等待 downlinkOnly 时间后中断连接。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-green"><i class="dwicon-green"></i>
<span style="font-size: 12pt; color: #ffffff;">● 在 HTTP 浏览的场景中，可以将<span style="color: #ffcc00;">uplinkOnly</span>和<span style="color: #ffcc00;">downlinkOnly</span>设为0，以提高连接关闭的效率。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">statsUserUplink</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">当值为true时，开启当前等级的所有用户的上行流量统计。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">statsUserDownlink</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">当值为true时，开启当前等级的所有用户的下行流量统计。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">bufferSize</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">每个连接的内部缓存大小。单位为 kB。当值为<span style="color: #ffcc99;">0</span>时，内部缓存被禁用。</span></li>
<li><span style="font-size: 12pt;">默认值 (V2Ray 4.4+):</span>
<ul>
<li><span style="font-size: 12pt;">在 ARM、MIPS、MIPSLE 平台上，默认值为<span style="color: #ffcc99;">0</span>。</span></li>
<li><span style="font-size: 12pt;">在 ARM64、MIPS64、MIPS64LE 平台上，默认值为<span style="color: #ffcc99;">4</span>。</span></li>
<li><span style="font-size: 12pt;">在其它平台上，默认值为<span style="color: #ffcc99;">512</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">默认值 (V2Ray 4.3-):</span>
<ul>
<li><span style="font-size: 12pt;">在 ARM、MIPS、MIPSLE、ARM64、MIPS64、MIPS64LE 平台上，默认值为<span style="color: #ffcc99;">16</span>。</span></li>
<li><span style="font-size: 12pt;">在其它平台上，默认值为<span style="color: #ffcc99;">2048</span>。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● <span style="color: #ffcc00;">bufferSize</span> 选项会覆盖环境变量中<span style="color: #ffcc00;">v2ray.ray.buffer.size</span>的设定。</span></div>
<h2><a id="SystemPolicyObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>SystemPolicyObject</div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">statsInboundUplink</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">statsInboundDownlink</span>": <span class="hljs-literal">false</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>statsInboundUplink</strong></span>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">当值为true时，开启所有入站代理的上行流量统计。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">statsInboundDownlink</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">当值为true时，开启所有入站代理的下行流量统计。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="inbound"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">入站连接配置</span></strong></div></h1>
<p><span style="font-size: 12pt;">入站连接用于接收从客户端（浏览器或上一级代理服务器）发来的数据，可用的协议请见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>InboundObject</div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">port</span>": <span class="hljs-number">1080</span>,
  "<span class="hljs-attr">listen</span>": <span class="hljs-string">"127.0.0.1"</span>,
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"协议名称"</span>,
  "<span class="hljs-attr">settings</span>": {},
  "<span class="hljs-attr">streamSettings</span>": {},
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"标识"</span>,
  "<span class="hljs-attr">sniffing</span>": {
    "<span class="hljs-attr">enabled</span>": <span class="hljs-literal">false</span>,
    "<span class="hljs-attr">destOverride</span>": [<span class="hljs-string">"http"</span>, <span class="hljs-string">"tls"</span>]
  },
  "<span class="hljs-attr">allocate</span>": {
    "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"always"</span>,
    "<span class="hljs-attr">refresh</span>": <span class="hljs-number">5</span>,
    "<span class="hljs-attr">concurrency</span>": <span class="hljs-number">3</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>:&nbsp;number | “env:variable” | string</span>
<ul>
<li><span style="font-size: 12pt;">端口。接受的格式如下:</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">整型数值</span>: 实际的端口号。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">环境变量</span>: 以”<span style="color: #ffcc99;">env:</span>“开头，后面是一个环境变量的名称，如”<span style="color: #ffcc99;">env:PORT</span>“。V2Ray 会以字符串形式解析这个环境变量。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">字符串</span>: 可以是一个数值类型的字符串，如”<span style="color: #ffcc99;">1234</span>“；或者一个数值范围，如”<span style="color: #ffcc99;">5-10</span>“表示端口 5 到端口 10 这 6 个端口。</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">listen</span></strong>:&nbsp;address</span>
<ul>
<li><span style="font-size: 12pt;">监听地址，只允许 IP 地址，默认值为”<span style="color: #ffcc99;">0.0.0.0</span>“，表示接收所有网卡上的连接。除此之外，必须指定一个现有网卡的地址。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">protocol</span></strong>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">连接协议名称，可选的值见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">settings</span></strong>:InboundConfigurationObject </span>
<ul>
<li><span style="font-size: 12pt;">具体的配置内容，视协议不同而不同。详见每个<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议</a>中的<span style="color: #ffcc99;">InboundConfigurationObject</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">streamSettings</span></strong>:&nbsp;StreamSettingsObject</span>
<ul>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#transport">底层传输配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string </span>
<ul>
<li><span style="font-size: 12pt;">此此入站连接的标识，用于在其它的配置中定位此连接。当其不为空时，其值必须在所有<span style="color: #ffcc99;">tag</span>中唯一。</span></li>
</ul>
</li>
</ul>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">sniffing</span></strong>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#SniffingObject">SniffingObject</a></span>
<ul>
<li><span style="font-size: 12pt;">尝试探测流量类型。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">allocate</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#AllocateObject">AllocateObject</a></span>
<ul>
<li><span style="font-size: 12pt;">端口分配设置</span></li>
</ul>
</li>
</ul>
<h2><a id="SniffingObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>SniffingObject</div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">enabled</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">destOverride</span>": [<span class="hljs-string">"http"</span>, <span class="hljs-string">"tls"</span>]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">enabled</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否开启流量探测。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">destOverride</span></strong>: [“http” | “tls”]</span>
<ul>
<li><span style="font-size: 12pt;">当流量为指定类型时，按其中包括的目标地址重置当前连接的目标。</span></li>
</ul>
</li>
</ul>
<h2><a id="AllocateObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>AllocateObject<span style="word-spacing: normal;"></span></div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"always"</span>,
  "<span class="hljs-attr">refresh</span>": <span class="hljs-number">5</span>,
  "<span class="hljs-attr">concurrency</span>": <span class="hljs-number">3</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">strategy</span></strong>: “always” | “random”</span>
<ul>
<li><span style="font-size: 12pt;">端口分配策略。”<span style="color: #ffcc99;">always</span>“表示总是分配所有已指定的端口，port中指定了多少个端口，V2Ray 就会监听这些端口。”<span style="color: #ffcc99;">random</span>“表示随机开放端口，每隔refresh分钟在port范围中随机选取concurrency个端口来监听。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">refresh</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">随机端口刷新间隔，单位为分钟。最小值为<span style="color: #ffcc99;">2</span>，建议值为<span style="color: #ffcc99;">5</span>。这个属性仅当<span style="color: #ffcc99;">strategy</span> = <span style="color: #ffcc99;">random</span>时有效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">concurrency</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">随机端口数量。最小值为<span style="color: #ffcc99;">1</span>，最大值为port范围的三分之一。建议值为<span style="color: #ffcc99;">3</span>。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="outbound"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">出站连接配置</span></strong></div></h1>
<p><span style="font-size: 12pt;">出站连接用于向远程网站或下一级代理服务器发送数据，可用的协议请见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>OutboundObject<span style="word-spacing: normal;"></span></div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">sendThrough</span>": <span class="hljs-string">"0.0.0.0"</span>,
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"协议名称"</span>,
  "<span class="hljs-attr">settings</span>": {},
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"标识"</span>,
  "<span class="hljs-attr">streamSettings</span>": {},
  "<span class="hljs-attr">proxySettings</span>": {
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"another-outbound-tag"</span>
  },
  "<span class="hljs-attr">mux</span>": {}
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">sendThrough</span></strong>:&nbsp;address</span>
<ul>
<li><span style="font-size: 12pt;">用于发送数据的 IP 地址，当主机有多个 IP 地址时有效，默认值为”<span style="color: #ffcc99;">0.0.0.0</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">protocol</span></strong>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">连接协议名称，可选的值见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">settings</span></strong>:&nbsp;OutboundConfigurationObject</span>
<ul>
<li><span style="font-size: 12pt;">具体的配置内容，视协议不同而不同。详见每个<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议</a>中的<span style="color: #ffcc99;">OutboundConfigurationObject</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">此出站连接的标识，用于在其它的配置中定位此连接。当其值不为空时，必须在所有 tag 中唯一。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">streamSettings</span></strong>:&nbsp;StreamSettingsObject</span>
<ul>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#transport">底层传输配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">proxySettings</span></strong>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ProxySettingsObject">ProxySettingsObject</a></span>
<ul>
<li><span style="font-size: 12pt;">传出代理配置。出站代理配置。当出站代理生效时，此出站协议的<span style="color: #ffcc99;">streamSettings</span>将不起作用。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>mux</strong></span>:&nbsp;MuxObject</span>
<ul>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#mux">Mux 配置</a>。</span></li>
</ul>
</li>
</ul>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i><a id="ProxySettingsObject"></a>ProxySettingsObject<span style="word-spacing: normal;"></span></div></h2>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"another-outbound-tag"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">当指定另一个出站协议的标识时，此出站协议发出的数据，将被转发至所指定的出站协议发出。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="protocols"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">协议列表</span></strong></div></h1>
<p><span style="font-size: 12pt;">V2Ray 支持以下协议：</span></p>
<ul>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#Blackhole"><span style="font-size: 12pt;">Blackhole</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#Dokodemo-door"><span style="font-size: 12pt;">Dokodemo-door</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#Freedom"><span style="font-size: 12pt;">Freedom</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#dns_protocol"><span style="font-size: 12pt;">DNS</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HTTP"><span style="font-size: 12pt;">HTTP</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#MTProto"><span style="font-size: 12pt;">MTProto</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#Shadowsocks"><span style="font-size: 12pt;">Shadowsocks</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#Socks"><span style="font-size: 12pt;">Socks</span></a></li>
<li><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#VMess"><span style="font-size: 12pt;">VMess</span></a></li>
</ul>
<h2><a name="Blackhole"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>Blackhole</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">blackhole</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Outbound / 出站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 16px;">Blackhole（黑洞）是一个</span><strong style="font-size: 16px;">出站</strong><span style="font-size: 16px;">数据协议，它会阻碍所有数据的传出，配合</span><a style="font-size: 16px;" href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#routing">路由（Routing）</a><span style="font-size: 16px;">一起使用，可以达到禁止访问某些网站的效果。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">response</span>": {
    "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">response</span></strong>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ResponseObject">ResponseObject</a></span>
<ul>
<li><span style="font-size: 12pt;">配置黑洞的响应数据。Blackhole 会在收到待转发数据之后，发送指定的响应数据，然后关闭连接。待转发的数据将被丢弃。如不指定此项，Blackhole 将直接关闭连接。</span></li>
</ul>
</li>
</ul>
<p><a id="ResponseObject"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">ResponseObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">type</span></strong>: “http” | “none”</span>
<ul>
<li><span style="font-size: 12pt;">当<span style="color: #ffcc99;">type</span>为”<span style="color: #ffcc99;">none</span>“（默认值）时，Blackhole将直接关闭连接。当<span style="color: #ffcc99;">type</span>为”<span style="color: #ffcc99;">http</span>“时，Blackhole会发回一个简单的 HTTP 403 数据包，然后关闭连接。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="Dokodemo-door"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>Dokodemo-door</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">dokodemo-door</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Inbound / 入站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 12pt;">Dokodemo door（任意门）是一个<strong>入站</strong>数据协议，它可以监听一个本地端口，并把所有进入此端口的数据发送至指定服务器的一个端口，从而达到端口映射的效果。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">InboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">address</span>": <span class="hljs-string">"8.8.8.8"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">53</span>,
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
  "<span class="hljs-attr">timeout</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">followRedirect</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">userLevel</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">address</span></strong>:&nbsp;address</span>
<ul>
<li><span style="font-size: 12pt;">将流量转发到此地址。可以是一个 IP 地址，形如”<span style="color: #ffcc99;">1.2.3.4</span>“，或者一个域名，形如”<span style="color: #ffcc99;">v2ray.com</span>“。字符串类型。</span></li>
<li><span style="font-size: 12pt;">当 <span style="color: #ffcc99;">followRedirect</span>（见下文）为 <span style="color: #ffcc99;">true</span> 时，<span style="color: #ffcc99;">address</span> 可为空。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">将流量转发到目标地址的指定端口，范围[1, 65535]，数值类型。必填参数。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>:&nbsp;“tcp” | “udp” | “tcp,udp”</span>
<ul>
<li><span style="font-size: 12pt;">可接收的网络协议类型。比如当指定为”<span style="color: #ffcc99;">tcp</span>“时，任意门仅会接收 TCP 流量。默认值为”<span style="color: #ffcc99;">tcp</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">timeout</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">入站数据的时间限制（秒），默认值为 300。</span></li>
<li><span style="font-size: 12pt;">V2Ray 3.1 后等价于对应用户等级的 <span style="color: #ffcc99;">connIdle</span> 策略</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">followRedirect</span></strong>: true | false </span>
<ul>
<li><span style="font-size: 12pt;">当值为 <span style="color: #ffcc99;">true</span> 时，dokodemo-door 会识别出由 iptables 转发而来的数据，并转发到相应的目标地址。详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#transport">传输配置</a>中的 <span style="color: #ffcc99;">tproxy</span> 设置。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">userLevel</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，所有连接都会使用这个用户等级。</span></li>
</ul>
</li>
</ul>
<p><span style="font-size: 12pt;"></span></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i>透明代理配置样例<span style="font-size: 16px; word-spacing: normal;"></span></div><p></p>
<p><span style="font-size: 12pt;">V2Ray 中增加一个 dokodemo-door 的传入协议：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp,udp"</span>,
  "<span class="hljs-attr">timeout</span>": <span class="hljs-number">30</span>,
  "<span class="hljs-attr">followRedirect</span>": <span class="hljs-literal">true</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">配置 iptables：</span></p>
<pre class="pure-highlightjs"><code class="null hljs sql"># <span class="hljs-keyword">Create</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">chain</span>
iptables -<span class="hljs-keyword">t</span> nat -<span class="hljs-keyword">N</span> V2RAY
iptables -<span class="hljs-keyword">t</span> mangle -<span class="hljs-keyword">N</span> V2RAY
iptables -<span class="hljs-keyword">t</span> mangle -<span class="hljs-keyword">N</span> V2RAY_MARK

# <span class="hljs-keyword">Ignore</span> your V2Ray <span class="hljs-keyword">server</span><span class="hljs-string">'s addresses
# It'</span>s very IMPORTANT, just be careful.
iptables -<span class="hljs-keyword">t</span> nat -A V2RAY -<span class="hljs-keyword">d</span> <span class="hljs-number">123.123</span><span class="hljs-number">.123</span><span class="hljs-number">.123</span> -j <span class="hljs-keyword">RETURN</span>

# <span class="hljs-keyword">Ignore</span> LANs <span class="hljs-keyword">and</span> <span class="hljs-keyword">any</span> other addresses you<span class="hljs-string">'d like to bypass the proxy
# See Wikipedia and RFC5735 for full list of reserved networks.
iptables -t nat -A V2RAY -d 0.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -d 10.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -d 127.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -d 169.254.0.0/16 -j RETURN
iptables -t nat -A V2RAY -d 172.16.0.0/12 -j RETURN
iptables -t nat -A V2RAY -d 192.168.0.0/16 -j RETURN
iptables -t nat -A V2RAY -d 224.0.0.0/4 -j RETURN
iptables -t nat -A V2RAY -d 240.0.0.0/4 -j RETURN

# Anything else should be redirected to Dokodemo-door'</span>s <span class="hljs-keyword">local</span> port
iptables -<span class="hljs-keyword">t</span> nat -A V2RAY -<span class="hljs-keyword">p</span> tcp -j REDIRECT <span class="hljs-comment">--to-ports 12345</span>

# <span class="hljs-keyword">Add</span> <span class="hljs-keyword">any</span> UDP <span class="hljs-keyword">rules</span>
ip route <span class="hljs-keyword">add</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">default</span> dev lo <span class="hljs-keyword">table</span> <span class="hljs-number">100</span>
ip rule <span class="hljs-keyword">add</span> fwmark <span class="hljs-number">1</span> lookup <span class="hljs-number">100</span>
iptables -<span class="hljs-keyword">t</span> mangle -A V2RAY -<span class="hljs-keyword">p</span> udp <span class="hljs-comment">--dport 53 -j TPROXY --on-port 12345 --tproxy-mark 0x01/0x01</span>
iptables -<span class="hljs-keyword">t</span> mangle -A V2RAY_MARK -<span class="hljs-keyword">p</span> udp <span class="hljs-comment">--dport 53 -j MARK --set-mark 1</span>

# <span class="hljs-keyword">Apply</span> the <span class="hljs-keyword">rules</span>
iptables -<span class="hljs-keyword">t</span> nat -A <span class="hljs-keyword">OUTPUT</span> -<span class="hljs-keyword">p</span> tcp -j V2RAY
iptables -<span class="hljs-keyword">t</span> mangle -A PREROUTING -j V2RAY
iptables -<span class="hljs-keyword">t</span> mangle -A <span class="hljs-keyword">OUTPUT</span> -j V2RAY_MARK</code></pre>
<p>&nbsp;</p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="Freedom"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>Freedom</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">freedom</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Outbound / 出站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 16px;">Freedom 是一个<strong>出站</strong>协议，可以用来向任意网络发送（正常的） TCP 或 UDP 数据。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">domainStrategy</span>": <span class="hljs-string">"AsIs"</span>,
  "<span class="hljs-attr">redirect</span>": <span class="hljs-string">"127.0.0.1:3366"</span>,
  "<span class="hljs-attr">userLevel</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domainStrategy</span></strong>:&nbsp;“AsIs” | “UseIP” | “UseIPv4” | “UseIPv6”</span>
<ul>
<li><span style="font-size: 12pt;">域名解析策略，在目标地址为域名时，Freedom 可以直接向此域名发出连接（”<span style="color: #ffcc99;">AsIs</span>“），或者将域名解析为 IP 之后再建立连接（”<span style="color: #ffcc99;">UseIP</span>“、”<span style="color: #ffcc99;">UseIPv4</span>“、”<span style="color: #ffcc99;">UseIPv6</span>“）。解析 IP 的步骤会使用 V2Ray 内建的 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#dns">DNS</a>。默认值为”<span style="color: #ffcc99;">AsIs</span>“。</span></li>
<li><span style="font-size: 12pt;">(V2Ray 4.6+) 当使用”<span style="color: #ffcc99;">UseIP</span>“模式，并且<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#outbound">出站连接配置</a>中指定了<span style="color: #ffcc99;">sendThrough</span>时，Freedom 会根据<span style="color: #ffcc99;">sendThrough</span>的值自动判断所需的IP类型，IPv4 或 IPv6。</span></li>
<li><span style="font-size: 12pt;">(V2Ray 4.7+) 当使用”<span style="color: #ffcc99;">UseIPv4</span>“或”<span style="color: #ffcc99;">UseIPv6</span>“模式时，Freedom 会只使用对应的 IPv4 或 IPv6 地址。当<span style="color: #ffcc99;">sendThrough</span>指定了不匹配的本地地址时，将导致连接失败。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">redirect</span></strong>:&nbsp;address_port</span>
<ul>
<li><span style="font-size: 12pt;">Freedom 会强制将所有数据发送到指定地址（而不是入站协议指定的地址）。其值为一个字符串，样例：”<span style="color: #ffcc99;">127.0.0.1:80</span>“, “<span style="color: #ffcc99;">:1234</span>“。当地址不指定时，如”<span style="color: #ffcc99;">:443</span>“，Freedom 不会修改原先的目标地址。当端口为<span style="color: #ffcc99;">0</span>时，如”<span style="color: #ffcc99;">v2ray.com:0</span>“，Freedom 不会修改原先的端口。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">userLevel</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，所有连接都使用这一等级。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a id="dns_protocol"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>DNS</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">dns</span></span></li>
<li><span style="font-size: 12pt;">类型：<span style="color: #ffcc99;"><strong>Outbound</strong> / <strong>出站协议</strong></span></span></li>
</ul>
<p><span style="font-size: 12pt;">DNS 是一个出站协议，主要用于拦截和转发 DNS 查询。此出站协议只能接收 DNS 流量（包含基于 UDP 和 TCP 协议的查询），其它类型的流量会导致错误。</span></p>
<p><span style="font-size: 12pt;">在处理 DNS 查询时，此出站协议会将 IP 查询（即 A 和 AAAA）转发给内置的 DNS 服务器。其它类询的流量将被转发至它们原本的目标地址。</span></p>
<p><span style="font-size: 12pt;">DNS 出站协议在 V2Ray 4.15 中引入。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
    "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
    "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.1.1.1"</span>,
    "<span class="hljs-attr">port</span>": <span class="hljs-number">53</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>: “tcp” | “udp”</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.16+) 修改 DNS 流量的传输层协议，可选的值有”tcp”和”udp”。当不指定时，保持来源的传输方式不变。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>address</strong></span>: address</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.16+) 修改 DNS 服务器地址。当不指定时，保持来源中指定的地址不变。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.16+) 修改 DNS 服务器端口。当不指定时，保持来源中指定的端口不变。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="HTTP"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>HTTP</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">http</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Inbound / 入站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 16px;">HTTP 是一个</span><strong style="font-size: 16px;">入站</strong><span style="font-size: 16px;">数据协议，兼容 HTTP 1.x 代理。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">InboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">timeout</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">accounts</span>": [
    {
      "<span class="hljs-attr">user</span>": <span class="hljs-string">"my-username"</span>,
      "<span class="hljs-attr">pass</span>": <span class="hljs-string">"my-password"</span>
    }
  ],
  "<span class="hljs-attr">allowTransparent</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">userLevel</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">timeout</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">从客户端读取数据的超时设置（秒），<span style="color: #ffcc99;">0</span> 表示不限时。默认值为 <span style="color: #ffcc99;">300</span>。 V2Ray 3.1 后等价于对应用户等级的 <span style="color: #ffcc99;">connIdle</span> 策略。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">accounts</span></strong>:&nbsp;[<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#AccountObject">AccountObject</a>]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组中每个元素为一个用户帐号。默认值为空。</span></li>
<li><span style="font-size: 12pt;">当&nbsp;<span style="color: #ffcc99;">accounts</span> 非空时，HTTP 代理将对入站连接进行 Basic Authentication 验证。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">allowTransparent</span></strong>:&nbsp;true | false</span>
<ul>
<li><span style="font-size: 12pt;">当为<span style="color: #ffcc99;">true</span>时，会转发所有 HTTP 请求，而非只是代理请求。若配置不当，开启此选项会导致死循环。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">userLevel</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，所有连接使用这一等级。</span></li>
</ul>
</li>
</ul>
<p><a id="AccountObject"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">AccountObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">user</span>": <span class="hljs-string">"my-username"</span>,
  "<span class="hljs-attr">pass</span>": <span class="hljs-string">"my-password"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">user</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">用户名，字符串类型。必填。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">pass</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">密码，字符串类型。必填。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt;">● 在 Linux 中使用以下环境变量即可在当前 session 使用全局 HTTP 代理（很多软件都支持这一设置，也有不支持的）。</span><p></p>
<ul>
<li style="list-style-type: none;">
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">export http_proxy=http://127.0.0.1:8080/</span> (地址须改成你配置的 HTTP 传入代理地址)</span></li>
<li><span style="font-size: 12pt; color: #ffcc99;">export https_proxy=$http_proxy</span></li></ul></li></ul></div>



<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="MTProto"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>MTProto</strong></div></span></h2>
<p><span style="font-size: 12pt;">协议描述：</span></p>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">mtproto</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Inbound 入站协议 /</span><span style="color: #ffcc99;">&nbsp;</span><span style="color: #ffcc99;">Outbound 出站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 12pt;">MTProto 是一个 Telegram 专用的代理协议。在 V2Ray 中可使用一组入站出站代理来完成 Telegram 数据的代理任务。</span></p>
<p><span style="font-size: 12pt;">目前只支持转发到 Telegram 的 IPv4 地址。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">InboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">users</span>": [{
    "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>,
    "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
    "<span class="hljs-attr">secret</span>": <span class="hljs-string">"b0cbcef5a486d9636472ac27f8e11a9d"</span>
  }]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">users</span>:&nbsp;[<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#UserObject_MTProto">UserObject</a>]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，其中每一个元素表示一个用户。<strong>目前只有第一个用户会生效</strong>。</span></li>
</ul>
</li>
</ul>
<p><a id="UserObject_MTProto"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">UserObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>,
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">secret</span>": <span class="hljs-string">"b0cbcef5a486d9636472ac27f8e11a9d"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">email</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">用户邮箱，用于统计流量等辅助功能</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">secret</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">用户密钥。必须为 32 个字符，仅可包含0到9和a到f之间的字符。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● 使用此命令生成 MTProto 代理所需要的用户密钥：<span style="color: #ffcc99;">openssl rand -hex 16</span></span></div>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
}</code></pre>
<p>&nbsp;</p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">样例配置</span></div>
<p><span style="font-size: 12pt;">MTProto 仅可用于 Telegram 数据。你可能需要一个路由来绑定对应的入站出站代理。以下是一个不完整的示例：</span></p>
<p><span style="font-size: 12pt;">入站代理：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"tg-in"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">443</span>,
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"mtproto"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">users</span>": [{"<span class="hljs-attr">secret</span>": <span class="hljs-string">"b0cbcef5a486d9636472ac27f8e11a9d"</span>}]
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">出站代理：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"tg-out"</span>,
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"mtproto"</span>,
  "<span class="hljs-attr">settings</span>": {}
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">路由：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
  "<span class="hljs-attr">inboundTag</span>": [<span class="hljs-string">"tg-in"</span>],
  "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"tg-out"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">然后使用 Telegram 连接这台机器的 443 端口即可。</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="Shadowsocks"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>Shadowsocks</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">shadowsocks</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Inbound 入站协议 /&nbsp;</span></strong><strong><span style="color: #ffcc99;">Outbound 出站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 12pt;"><a href="https://zh.wikipedia.org/wiki/Shadowsocks" target="_blank" rel="noopener noreferrer">Shadowsocks</a> 协议，包含<strong>入站</strong>和<strong>出站</strong>两部分，兼容大部分其它版本的实现。</span></p>
<p><span style="font-size: 12pt;">与官方版本的兼容性：</span></p>
<ul>
<li><span style="font-size: 12pt;">支持 TCP 和 UDP 数据包转发，其中 UDP 可选择性关闭；</span></li>
<li><span style="font-size: 12pt;">支持 <a href="https://web.archive.org/web/20161221022225/https://shadowsocks.org/en/spec/one-time-auth.html" target="_blank" rel="noopener noreferrer">OTA</a>；</span>
<ul>
<li><span style="font-size: 12pt;">客户端可选开启或关闭；</span></li>
<li><span style="font-size: 12pt;">服务器端可强制开启、关闭或自适应；</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">加密方式（其中 <a href="https://shadowsocks.org/en/spec/AEAD-Ciphers.html" target="_blank" rel="noopener noreferrer">AEAD</a> 加密方式在 V2Ray 3.0 中加入）：</span>
<ul>
<li><span style="font-size: 12pt;">aes-256-cfb</span></li>
<li><span style="font-size: 12pt;">aes-128-cfb</span></li>
<li><span style="font-size: 12pt;">chacha20</span></li>
<li><span style="font-size: 12pt;">chacha20-ietf</span></li>
<li><span style="font-size: 12pt;">aes-256-gcm</span></li>
<li><span style="font-size: 12pt;">aes-128-gcm</span></li>
<li><span style="font-size: 12pt;">chacha20-poly1305 或称 chacha20-ietf-poly1305</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">插件：</span>
<ul>
<li><span style="font-size: 12pt;">通过 Standalone 模式支持 obfs</span></li>
</ul>
</li>
</ul>
<p><span style="font-size: 12pt;">Shadowsocks 的配置分为两部分，<span style="color: #ffcc99;">InboundConfigurationObject&nbsp;</span>和&nbsp;<span style="color: #ffcc99;">OutboundConfigurationObject</span>，分别对应入站和出站协议配置中的&nbsp;<span style="color: #ffcc99;">settings&nbsp;</span>项。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">InboundConfigurationObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>,
  "<span class="hljs-attr">method</span>": <span class="hljs-string">"aes-128-cfb"</span>,
  "<span class="hljs-attr">password</span>": <span class="hljs-string">"密码"</span>,
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">ota</span>": <span class="hljs-literal">true</span>,
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">email</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">邮件地址，可选，用于标识用户</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">method</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">必填。可选的值见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#encryption-list">加密方式列表</a></span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">password</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">必填，任意字符串。Shadowsocks 协议不限制密码长度，但短密码会更可能被破解，建议使用 16 字符或更长的密码。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，默认值为 0。详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#policy">本地策略</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">ota</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否强制 OTA，如果不指定此项，则自动判断。强制开启 OTA 后，V2Ray 会拒绝未启用 OTA 的连接。反之亦然。</span></li>
<li><span style="font-size: 12pt;">当使用 AEAD 时，ota 设置无效</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>: “tcp” | “udp” | “tcp,udp”</span>
<ul>
<li><span style="font-size: 12pt;">可接收的网络连接类型，默认值为”tcp”。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">servers</span>": [
    {
      "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>,
      "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1234</span>,
      "<span class="hljs-attr">method</span>": <span class="hljs-string">"加密方式"</span>,
      "<span class="hljs-attr">password</span>": <span class="hljs-string">"密码"</span>,
      "<span class="hljs-attr">ota</span>": <span class="hljs-literal">false</span>,
      "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">servers</span></strong>: [<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ServerObject_Shadowsocks">ServerObject</a>]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，其中每一项是一个 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ServerObject_Shadowsocks">ServerObject</a>。</span></li>
</ul>
</li>
</ul>
<p><a id="ServerObject_Shadowsocks"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">ServerObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>,
  "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">1234</span>,
  "<span class="hljs-attr">method</span>": <span class="hljs-string">"加密方式"</span>,
  "<span class="hljs-attr">password</span>": <span class="hljs-string">"密码"</span>,
  "<span class="hljs-attr">ota</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">email</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">邮件地址，可选，用于标识用户</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">address</span></strong>: address</span>
<ul>
<li><span style="font-size: 12pt;">Shadowsocks 服务器地址，支持 IPv4、IPv6 和域名。必填。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">Shadowsocks 服务器端口。必填。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">method</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">必填。可选的值见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#encryption-list">加密方式列表</a></span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">password</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">必填。任意字符串。Shadowsocks 协议不限制密码长度，但短密码会更可能被破解，建议使用 16 字符或更长的密码。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">ota</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否开启 Shadowsocks 的一次验证（One time auth），默认值为<span style="color: #ffcc99;">false</span>。</span></li>
<li><span style="font-size: 12pt;">当使用 AEAD 时，ota 设置无效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级</span></li>
</ul>
</li>
</ul>
<p><a id="encryption-list"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">加密方式列表</span><span style="word-spacing: normal;"></span></div><p></p>
<ul>
<li><span style="font-size: 12pt;">“aes-256-cfb”</span></li>
<li><span style="font-size: 12pt;">“aes-128-cfb”</span></li>
<li><span style="font-size: 12pt;">“chacha20”</span></li>
<li><span style="font-size: 12pt;">“chacha20-ietf”</span></li>
<li><span style="font-size: 12pt;">“aes-256-gcm”</span></li>
<li><span style="font-size: 12pt;">“aes-128-gcm”</span></li>
<li><span style="font-size: 12pt;">“chacha20-poly1305” 或 “chacha20-ietf-poly1305”</span></li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="Socks"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>Socks</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">socks</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Inbound 入站协议 /&nbsp;</span></strong><strong><span style="color: #ffcc99;">Outbound 出站协议</span></strong></span></li>
</ul>
<p><span style="font-size: 16px;">标准 Socks 协议实现，兼容&nbsp;</span><a style="font-size: 16px;" href="http://ftp.icm.edu.pl/packages/socks/socks4/SOCKS4.protocol" target="_blank" rel="noopener noreferrer">Socks 4</a><span style="font-size: 16px;">、Socks 4a 和&nbsp;</span><a style="font-size: 16px;" href="http://ftp.icm.edu.pl/packages/socks/socks4/SOCKS4.protocol" target="_blank" rel="noopener noreferrer">Socks 5</a><span style="font-size: 16px;">。</span></p>
<p><span style="font-size: 12pt;">Socks 的配置分为两部分，<span style="color: #ffcc99;">InboundConfigurationObject&nbsp;</span>和&nbsp;<span style="color: #ffcc99;">OutboundConfigurationObject</span>，分别对应入站和出站协议配置中的 <span style="color: #ffcc99;">settings</span> 项。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">servers</span>": [{
    "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
    "<span class="hljs-attr">port</span>": <span class="hljs-number">1234</span>,
    "<span class="hljs-attr">users</span>": [
      {
        "<span class="hljs-attr">user</span>": <span class="hljs-string">"test user"</span>,
        "<span class="hljs-attr">pass</span>": <span class="hljs-string">"test pass"</span>,
        "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
      }
    ]
  }]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">servers</span></strong>: [ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ServerObject_Socks">ServerObject </a>]</span>
<ul>
<li style="list-style-type: none;"></li>
<li><span style="font-size: 12pt;">Socks 服务器列表，其中每一项是一个服务器配置。</span></li>
</ul>
</li>
</ul>
<p><a id="ServerObject_Socks"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">ServerObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">1234</span>,
  "<span class="hljs-attr">users</span>": [
    {
      "<span class="hljs-attr">user</span>": <span class="hljs-string">"test user"</span>,
      "<span class="hljs-attr">pass</span>": <span class="hljs-string">"test pass"</span>,
      "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">address</span></strong>: address</span>
<ul>
<li><span style="font-size: 12pt;">服务器地址。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● 仅支持连接到 Socks 5 服务器。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">服务器端口</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">users</span></strong>: [ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#UserObject_Socks">UserObject </a>]</span>
<ul>
<li><span style="font-size: 12pt;">用户列表，其中每一项一个用户配置。当列表不为空时，Socks 客户端会使用此用户信息进行认证；如未指定，则不进行认证。</span></li>
</ul>
</li>
</ul>
<p><a id="UserObject_Socks"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">UserObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">user</span>": <span class="hljs-string">"test user"</span>,
  "<span class="hljs-attr">pass</span>": <span class="hljs-string">"test pass"</span>,
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">user</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">用户名</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">pass</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">密码</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">InboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">auth</span>": <span class="hljs-string">"noauth"</span>,
  "<span class="hljs-attr">accounts</span>": [
    {
      "<span class="hljs-attr">user</span>": <span class="hljs-string">"my-username"</span>,
      "<span class="hljs-attr">pass</span>": <span class="hljs-string">"my-password"</span>
    }
  ],
  "<span class="hljs-attr">udp</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">ip</span>": <span class="hljs-string">"127.0.0.1"</span>,
  "<span class="hljs-attr">userLevel</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">auth</span></strong>:&nbsp;“noauth” | “password”</span>
<ul>
<li><span style="font-size: 12pt;">Socks 协议的认证方式，支持”<span style="color: #ffcc99;">noauth</span>“匿名方式和”<span style="color: #ffcc99;">password</span>“用户密码方式。默认值为”<span style="color: #ffcc99;">noauth</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">accounts</span></strong>:&nbsp;[ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#AccountObject_Socks">AccountObject</a> ]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，数组中每个元素为一个用户帐号。默认值为空。此选项仅当 auth 为 password 时有效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">udp</span></strong>:&nbsp;true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否开启 UDP 协议的支持，默认值为 <span style="color: #ffcc99;">false</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">ip</span></strong>:&nbsp;address</span>
<ul>
<li><span style="font-size: 12pt;">当开启 UDP 时，V2Ray 需要知道本机的 IP 地址。默认值为”<span style="color: #ffcc99;">127.0.0.1</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">userLevel</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，所有连接使用这一等级。</span></li>
</ul>
</li>
</ul>
<p><a id="AccountObject_Socks"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">AccountObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">user</span>": <span class="hljs-string">"my-username"</span>,
  "<span class="hljs-attr">pass</span>": <span class="hljs-string">"my-password"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">user</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">用户名</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">pass</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">密码</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<h2><a name="VMess"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>VMess</strong></div></span></h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">vmess</span></span></li>
<li><span style="font-size: 12pt;">类型：<strong><span style="color: #ffcc99;">Inbound 入站协议 /&nbsp;</span></strong><strong><span style="color: #ffcc99;">Outbound 出站协议</span></strong></span></li>
</ul>
<p><a style="font-size: 16px;" href="https://www.v2ray.com/developer/protocols/vmess.html" target="_blank" rel="noopener noreferrer">VMess</a><span style="font-size: 16px;">&nbsp;是一个加密传输协议，它分为</span><strong style="font-size: 16px;">入站</strong><span style="font-size: 16px;">和</span><strong style="font-size: 16px;">出站</strong><span style="font-size: 16px;">两部分，通常作为 V2Ray 客户端和服务器之间的桥梁。</span></p>
<p><span style="font-size: 12pt;">VMess 依赖于系统时间，请确保使用 V2Ray 的系统 UTC 时间误差在 90 秒之内，时区无关。在 Linux 系统中可以安装ntp服务来自动同步系统时间。</span></p>
<p><span style="font-size: 12pt;">VMess 的配置分为两部分，<span style="color: #ffcc99;">InboundConfigurationObject&nbsp;</span>和 <span style="color: #ffcc99;">OutboundConfigurationObject</span>，分别对应入站和出站协议配置中的&nbsp;<span style="color: #ffcc99;">settings&nbsp;</span>项。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">OutboundConfigurationObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">vnext</span>": [
    {
      "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
      "<span class="hljs-attr">port</span>": <span class="hljs-number">37192</span>,
      "<span class="hljs-attr">users</span>": [
        {
          "<span class="hljs-attr">id</span>": <span class="hljs-string">"27848739-7e62-4138-9fd3-098a63964b6b"</span>,
          "<span class="hljs-attr">alterId</span>": <span class="hljs-number">16</span>,
          "<span class="hljs-attr">security</span>": <span class="hljs-string">"auto"</span>,
          "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
        }
      ]
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">vnext</span></strong>:&nbsp;[ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ServerObject_VMess">ServerObject </a>]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，包含一系列的服务器配置。</span></li>
</ul>
</li>
</ul>
<p><a id="ServerObject_VMess"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">ServerObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">37192</span>,
  "<span class="hljs-attr">users</span>": []
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">address</span></strong>: address</span>
<ul>
<li><span style="font-size: 12pt;">服务器地址，支持 IP 地址或者域名。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">服务器端口号。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">users</span></strong>: [ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#UserObject_VMess">UserObject</a> ]</span>
<ul>
<li><span style="font-size: 12pt;">一组服务器认可的用户</span></li>
</ul>
</li>
</ul>
<p><a id="UserObject_VMess"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">UserObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">id</span>": <span class="hljs-string">"27848739-7e62-4138-9fd3-098a63964b6b"</span>,
  "<span class="hljs-attr">alterId</span>": <span class="hljs-number">16</span>,
  "<span class="hljs-attr">security</span>": <span class="hljs-string">"auto"</span>,
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">id</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">VMess 用户的主 ID。必须是一个合法的 UUID。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">alterId</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">为了进一步防止被探测，一个用户可以在主 ID 的基础上，再额外生成多个 ID。这里只需要指定额外的 ID 的数量，推荐值为 <span style="color: #ffcc99;">16</span>。不指定的话，默认值是 <span style="color: #ffcc99;">0</span>。最大值 <span style="color: #ffcc99;">65535</span>。这个值不能超过服务器端所指定的值。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">security</span></strong>: “aes-128-gcm” | “chacha20-poly1305” | “auto” | “none”</span>
<ul>
<li><span style="font-size: 12pt;">加密方式，客户端将使用配置的加密方式发送数据，服务器端自动识别，无需配置。</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">aes-128-gcm</span>“：推荐在 PC 上使用</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">chacha20-poly1305</span>“：推荐在手机端使用</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">auto</span>“：默认值，自动选择（运行框架为 AMD64、ARM64 或 s390x 时为aes-128-gcm加密方式，其他情况则为 Chacha20-Poly1305 加密方式）</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">none</span>“：不加密</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● 推荐使用”<span style="color: #ffcc99;">auto</span>“加密方式，这样可以永久保证安全性和兼容性。</span></div>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">InboundConfigurationObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">clients</span>": [
    {
      "<span class="hljs-attr">id</span>": <span class="hljs-string">"27848739-7e62-4138-9fd3-098a63964b6b"</span>,
      "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
      "<span class="hljs-attr">alterId</span>": <span class="hljs-number">16</span>,
      "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>
    }
  ],
  "<span class="hljs-attr">default</span>": {
    "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
    "<span class="hljs-attr">alterId</span>": <span class="hljs-number">32</span>
  },
  "<span class="hljs-attr">detour</span>": {
    "<span class="hljs-attr">to</span>": <span class="hljs-string">"tag_to_detour"</span>
  },
  "<span class="hljs-attr">disableInsecureEncryption</span>": <span class="hljs-literal">false</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">clients</span></strong>：[ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#ClientObject_VMess">ClientObject</a> ]</span>
<ul>
<li><span style="font-size: 12pt;">一组服务器认可的用户。clients 可以为空。当此配置用作动态端口时，V2Ray 会自动创建用户。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">detour</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#DetourObject_VMess">DetourObject</a></span>
<ul>
<li><span style="font-size: 12pt;">指示对应的出站协议使用另一个服务器。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">default</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#DefaultObject_VMess">DefaultObject</a></span>
<ul>
<li><span style="font-size: 12pt;">可选，clients 的默认配置。仅在配合detour时有效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">disableInsecureEncryption</span></strong>:&nbsp;true | false</span>
<ul>
<li><span style="font-size: 12pt;">禁止客户端使用不安全的加密方式，当下列客户端指定下列加密方式时，服务器会主动断开连接。默认值为<span style="color: #ffcc99;">false</span>。</span>
<ul>
<li><span style="font-size: 12pt; color: #ffcc99;">“none”</span></li>
<li><span style="font-size: 12pt; color: #ffcc99;">“aes-128-cfb”</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="ClientObject_VMess"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">ClientObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">id</span>": <span class="hljs-string">"27848739-7e62-4138-9fd3-098a63964b6b"</span>,
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">alterId</span>": <span class="hljs-number">16</span>,
  "<span class="hljs-attr">email</span>": <span class="hljs-string">"love@v2ray.com"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">id</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">VMess 的用户 ID。必须是一个合法的 UUID。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，详见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#policy">本地策略</a></span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">alterId</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">与上文出站协议中的含义相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">email</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">用户邮箱地址，用于区分不同用户的流量。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">● <span style="color: #ffcc99;">alterId</span> 取值的大小和流量特征没有必然联系。对于日常使用，<span style="color: #ffcc99;">64</span> 以内的值已经够用了。</span></div>
<p><a id="DetourObject_VMess"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">DetourObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">to</span>": <span class="hljs-string">"tag_to_detour"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">to</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">一个入站协议的tag，详见配置文件。指定的入站协议必须是一个 VMess</span></li>
</ul>
</li>
</ul>
<p><a id="DefaultObject_VMess"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">DefaultObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">level</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">alterId</span>": <span class="hljs-number">32</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">level</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">用户等级，意义同上。默认值为0。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">alterId</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">和&nbsp;<span style="color: #ffcc99;">ClientObject&nbsp;</span>中的&nbsp;<span style="color: #ffcc99;">alterId&nbsp;</span>相同，默认值为<span style="color: #ffcc99;">64</span>。推荐值<span style="color: #ffcc99;">16</span>。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">↑返回协议列表</a></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="mux"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">Mux 多路复用</span></strong></div></h1>
<p><span style="font-size: 12pt;">Mux 功能是在一条 TCP 连接上分发多个 TCP 连接的数据。实现细节详见<a href="https://www.v2ray.com/eng/protocols/muxcool.html" target="_blank" rel="noopener noreferrer">Mux.Cool</a>。Mux 是为了减少 TCP 的握手延迟而设计，而非提高连接的吞吐量。使用 Mux 看视频、下载或者测速通常都有反效果。Mux 只需要在客户端启用，服务器端自动适配。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>MuxObject<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">MuxObject对应OutboundObject中的mux项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">enabled</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">concurrency</span>": <span class="hljs-number">8</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">enabled</span></strong>:&nbsp;true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否启用 Mux</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">concurrency</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">最大并发连接数。最小值<span style="color: #ffcc99;">1</span>，最大值<span style="color: #ffcc99;">1024</span>，默认值<span style="color: #ffcc99;">8</span>。这个数值表示了一个 TCP 连接上最多承载的 Mux 连接数量。当客户端发出了 8 个 TCP 请求，而<span style="color: #ffcc99;">concurrency=8</span>时，V2Ray 只会发出一条实际的 TCP 连接，客户端的 8 个请求全部由这个 TCP 连接传输。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="extrin"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">额外的传入连接配置（inbound detour）</span></strong></div></h1>
<p><span style="color: #ffcc99;"><strong><span style="font-size: 12pt;">此项为旧版（3.x）配置，已失效且被折叠，新版（4+）请忽略此部分</span></strong></span></p>
<div class="su-spoiler su-spoiler-style-default su-spoiler-icon-plus su-spoiler-closed" data-scroll-offset="0"><div class="su-spoiler-title" tabindex="0" role="button"><span class="su-spoiler-icon"></span>点击展开</div><div class="su-spoiler-content su-u-clearfix su-u-trim">
<p><span style="font-size: 12pt;">此项是一个<strong>数组</strong>，可包含多个连接配置，每一个配置形如：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"协议名称"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-string">"端口"</span>,
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"标识"</span>,
  "<span class="hljs-attr">listen</span>": <span class="hljs-string">"127.0.0.1"</span>,
  "<span class="hljs-attr">allocate</span>": {
    "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"always"</span>,
    "<span class="hljs-attr">refresh</span>": <span class="hljs-number">5</span>,
    "<span class="hljs-attr">concurrency</span>": <span class="hljs-number">3</span>
  },
  "<span class="hljs-attr">settings</span>": {},
  "<span class="hljs-attr">streamSettings</span>": {},
  "<span class="hljs-attr">domainOverride</span>": [<span class="hljs-string">"http"</span>, <span class="hljs-string">"tls"</span>],
  "<span class="hljs-attr">sniffing</span>": {
    "<span class="hljs-attr">enabled</span>": <span class="hljs-literal">false</span>,
    "<span class="hljs-attr">destOverride</span>": [<span class="hljs-string">"http"</span>, <span class="hljs-string">"tls"</span>]
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">protocol</span></strong>: 连接协议名称，可选的值见<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#protocols">协议列表</a>。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">port</span></strong>: 端口。接受的格式如下:</span>
<ul>
<li><span style="font-size: 12pt;">整型数值: 实际的端口号。</span></li>
<li><span style="font-size: 12pt;">环境变量 (V2Ray 3.23+): 以”<span style="color: #ffcc99;">env:</span>“开头，后面是一个环境变量的名称，如”<span style="color: #ffcc99;">env:PORT</span>“。V2Ray 会以字符串形式解析这个环境变量。</span></li>
<li><span style="font-size: 12pt;">字符串: 可以是一个数值类型的字符串，如”<span style="color: #ffcc99;">1234</span>“；或者一个数值范围，如”<span style="color: #ffcc99;">5-10</span>“表示端口 5 到端口 10 这 6 个端口。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: 此传入连接的标识，用于在其它的配置中定位此连接。属性值必须在所有 tag 中唯一。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">listen</span></strong>: 监听地址，只允许 IP 地址，默认值为”<span style="color: #ffcc99;">0.0.0.0</span>“。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">allocate</span></strong>: 分配设置：</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">strategy</span>: 分配策略，可选的值有”<span style="color: #ffcc99;">always</span>“和”<span style="color: #ffcc99;">random</span>“两个。”<span style="color: #ffcc99;">always</span>“表示总是分配所有已指定的端口，port 是指定了多少个端口，V2Ray 就会监听这些端口。<span style="color: #ffcc99;">random</span> 表示随机开放端口，每隔 refresh 分钟在 port 范围中随机选取 concurrency 个端口来监听。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">refresh</span>: 随机端口刷新间隔，单位为分钟。最小值为<span style="color: #ffcc99;">2</span>，建议值为<span style="color: #ffcc99;">5</span>。这个属性仅当 strategy = random 时有效。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">concurrency</span>: 随机端口数量。最小值为<span style="color: #ffcc99;">1</span>，最大值为 port 范围的一半。建议值为3。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">settings</span></strong>: 具体的配置内容，视协议不同而不同。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>streamSettings</strong></span>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#transport">底层传输配置</a>。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domainOverride</span></strong>: 识别相应协议的流量，并根据流量内容重置所请求的目标。</span>
<ul>
<li><span style="font-size: 12pt;">接受一个字符串数组，默认值为空。</span></li>
<li><span style="font-size: 12pt;">可选值为&nbsp;“<span style="color: #ffcc99;">http</span>”&nbsp;和&nbsp;“<span style="color: #ffcc99;">tls</span>“。</span></li>
<li><span style="font-size: 12pt;">(V2Ray 3.32+) 已弃用。请使用&nbsp;<span style="color: #ffcc99;">sniffing</span>。当指定了&nbsp;<span style="color: #ffcc99;">domainOverride&nbsp;</span>而没有指定&nbsp;<span style="color: #ffcc99;">sniffing</span>&nbsp;时，强制开启&nbsp;<span style="color: #ffcc99;">sniffing</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">sniffing&nbsp;</span></strong>(V2Ray 3.32+): 尝试探测流量类型。</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">enabled</span>: 是否开启流量探测。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">destOverride</span>: 当流量为指定类型时，按其中包括的目标地址重置当前连接的目标。</span>
<ul>
<li><span style="font-size: 12pt;">可选值为&nbsp;“<span style="color: #ffcc99;">http</span>”&nbsp;和&nbsp;“<span style="color: #ffcc99;">tls</span>“。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;"></li>
</ul>
<p><span style="font-size: 12pt;">与inbound的区别：</span></p>
<p><span style="font-size: 12pt;">inbound 和 inboundDetour 基本是一样的，只不过 inboundDetour 是 inbound 的集合。还有一点不同的是 inboundDetour 多了一个 allocate 参数，这是只有在动态端口才会用到的参数，如果不配置动态端口 inboundDetour 和 inbound 无异。</span></p>
<p><span style="font-size: 12pt;">即有两点不同：</span></p>
<ul>
<li><span style="font-size: 12pt;">配置中 inbound 只能并且<strong>必须</strong>设置一个传入的配置，而 inboundDetour 可以设置任意多个传入配置</span></li>
<li><span style="font-size: 12pt;">inboundDetour 的传入配置多了一个给动态端口用的 allocate 参数</span></li>
</ul>
</div></div>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="extrout"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">额外的传出连接配置（outbound detour）</span></strong></div></h1>
<p><span style="color: #ffcc99;"><strong><span style="font-size: 12pt;">此项为旧版（3.x）配置，已失效且被折叠，新版（4+）请忽略此部分</span></strong></span></p>
<div class="su-spoiler su-spoiler-style-default su-spoiler-icon-plus su-spoiler-closed" data-scroll-offset="0"><div class="su-spoiler-title" tabindex="0" role="button"><span class="su-spoiler-icon"></span>点击展开</div><div class="su-spoiler-content su-u-clearfix su-u-trim">
<p><span style="font-size: 12pt;">此项是一个<strong>数组</strong>，可包含多个连接配置，每一个配置形如：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"协议名称"</span>,
  "<span class="hljs-attr">sendThrough</span>": <span class="hljs-string">"0.0.0.0"</span>,
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"标识"</span>,
  "<span class="hljs-attr">settings</span>": {},
  "<span class="hljs-attr">streamSettings</span>": {},
  "<span class="hljs-attr">proxySettings</span>": {
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"another-outbound-tag"</span>
  },
  "<span class="hljs-attr">mux</span>": {}
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">protocol</span></strong>: 连接协议名称，可选的值见协议列表；</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">sendThrough</span></strong>: 用于发送数据的 IP 地址，当主机有多个 IP 地址时有效，默认值为”<span style="color: #ffcc99;">0.0.0.0</span>“。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: 当前的配置标识，当路由选择了此标识后，数据包会由此连接发出；</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">settings</span></strong>: 具体的配置内容，视协议不同而不同。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">streamSettings</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#transport">底层传输配置</a>。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">proxySettings</span></strong>: 传出代理配置。当传出代理生效时，此传出协议的<span style="color: #ffcc99;">streamSettings</span>将不起作用。</span>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: 当指定另一个传出协议的标识时，此传出协议发出的数据，将被转发至所指定的传出协议发出。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">mux</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#mux">Mux 配置</a>。</span></li>
</ul>
<p><span style="font-size: 12pt;">与outbound的区别：</span></p>
<p><span style="font-size: 12pt;">单纯从配置格式来看，outbound 和 outboundDetour 没有任何区别。但是实际上 outbound 和 outboundDetour 也有两点不同：</span></p>
<ul>
<li><span style="font-size: 12pt;">配置中 outbound 只能并且<strong>必须</strong>设置一个传出的配置，而 outboundDetour 可以设置任意多个传出配置</span></li>
<li><span style="font-size: 12pt;">当没有配置路由规则或者路由没有匹配的情况下，默认由 outbound 将数据包发出去。</span></li>
</ul>
</div></div>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="transport"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">底层传输配置（transpo</span><span style="color: #ffffff;">rt）</span></strong></div></h1>
<p><span style="font-size: 12pt;">底层传输方式（transport）是当前 V2Ray 节点和其它节点对接的方式。底层传输方式提供了稳定的数据传输通道。通常来说，一个网络连接的两端需要有对称的传输方式。比如一端用了 WebSocket，那么另一个端也必须使用 WebSocket，否则无法建立连接。</span></p>
<p><span style="font-size: 12pt;">底层传输（transport）配置分为两部分，一是全局设置(<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#TransportObject">TransportObject</a>)，二是分协议配置(<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#StreamSettingsObject">StreamSettingsObject</a>)。分协议配置可以指定每个单独的入站出站协议用怎样的方式传输。通常来说客户端和服务器对应的出站入站协议需要使用同样的传输方式。当分协议传输配置指定了一种传输方式，但没有填写其设置时，此传输方式会使用全局配置中的设置。</span></p>
<h2><a id="TransportObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>TransportObject</div></h2>
<p><span style="font-size: 12pt;">TransportObject对应配置文件的transport项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tcpSettings</span>": {},
  "<span class="hljs-attr">kcpSettings</span>": {},
  "<span class="hljs-attr">wsSettings</span>": {},
  "<span class="hljs-attr">httpSettings</span>": {},
  "<span class="hljs-attr">dsSettings</span>": {},
  "<span class="hljs-attr">quicSettings</span>": {}
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tcpSettings</span></strong>:&nbsp;TcpObject</span>
<ul>
<li><span style="font-size: 12pt;">针对 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#TCP">TCP 连接的配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">kcpSettings</span></strong>:&nbsp;KcpObject</span>
<ul>
<li><span style="font-size: 12pt;">针对 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#mKCP">mKCP 连接的配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">wsSettings</span></strong>:&nbsp;WebSocketObject</span>
<ul>
<li><span style="font-size: 12pt;">针对 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#WebSocket">WebSocket 连接的配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">httpSettings</span></strong>:&nbsp;HttpObject</span>
<ul>
<li><span style="font-size: 12pt;">针对&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HTTP2">HTTP/2 连接的配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">dsSettings</span></strong>:&nbsp;DomainSocketObject</span>
<ul>
<li><span style="font-size: 12pt;">针对<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#domainsocket">Domain Socket 连接的配置</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">quicSettings</span></strong>: QUICObject</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.7+) 针对<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#quic">QUIC 连接的配置</a>。</span></li>
</ul>
</li>
</ul>
<h2><a id="StreamSettingsObject"></a><div class="dw-box dw-box-block"><i class="dwicon-block"></i>StreamSettingsObject</div></h2>
<p><span style="font-size: 12pt;">TransportObject对应出站入站协议中的streamSettings项。每一个入站、出站连接都可以分别配置不同的传输配置，都可以设置streamSettings来进行一些传输的配置。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
  "<span class="hljs-attr">security</span>": <span class="hljs-string">"none"</span>,
  "<span class="hljs-attr">tlsSettings</span>": {},
  "<span class="hljs-attr">tcpSettings</span>": {},
  "<span class="hljs-attr">kcpSettings</span>": {},
  "<span class="hljs-attr">wsSettings</span>": {},
  "<span class="hljs-attr">httpSettings</span>": {},
  "<span class="hljs-attr">dsSettings</span>": {},
  "<span class="hljs-attr">quicSettings</span>": {},
  "<span class="hljs-attr">sockopt</span>": {
    "<span class="hljs-attr">mark</span>": <span class="hljs-number">0</span>,
    "<span class="hljs-attr">tcpFastOpen</span>": <span class="hljs-literal">false</span>,
    "<span class="hljs-attr">tproxy</span>": <span class="hljs-string">"off"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">network</span></strong>: “tcp” | “kcp” | “ws” | “http” | “domainsocket” | “quic” </span>
<ul>
<li><span style="font-size: 12pt;">数据流所使用的网络类型，默认值为 “<span style="color: #ffcc99;">tcp</span>“</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">security</span></strong>:&nbsp;“none” | “tls”</span>
<ul>
<li><span style="font-size: 12pt;">是否启入传输层加密，支持的选项有 “<span style="color: #ffcc99;">none</span>” 表示不加密（默认值），”<span style="color: #ffcc99;">tls</span>” 表示使用 <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener noreferrer">TLS</a>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tlsSettings</span></strong>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#TLSObject_transport">TLSObject</a></span>
<ul>
<li><span style="font-size: 12pt;"><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#TLSObject_transport">TLS 配置</a>。TLS 由 Golang 提供，支持 TLS 1.2，不支持 DTLS。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tcpSettings</span></strong>:&nbsp;TcpObject</span>
<ul>
<li><span style="font-size: 12pt;">当前连接的 TCP 配置，仅当此连接使用 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#TCP">TCP</a> 时有效。配置内容与上面的全局配置相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">kcpSettings</span></strong>:&nbsp;KcpObject</span>
<ul>
<li><span style="font-size: 12pt;">当前连接的 mKCP 配置，仅当此连接使用 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#mKCP">mKCP</a> 时有效。配置内容与上面的全局配置相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">wsSettings</span></strong>:&nbsp;WebSocketObject</span>
<ul>
<li><span style="font-size: 12pt;">当前连接的 WebSocket 配置，仅当此连接使用 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#WebSocket">WebSocket</a> 时有效。配置内容与上面的全局配置相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">httpSettings</span></strong>:&nbsp;HttpObject</span>
<ul>
<li><span style="font-size: 12pt;">当前连接的 HTTP/2 配置，仅当此连接使用 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HTTP2">HTTP/2</a> 时有效。配置内容与上面的全局配置相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">dsSettings</span></strong>:&nbsp;DomainSocketObject</span>
<ul>
<li><span style="font-size: 12pt;">当前连接的 Domain socket 配置，仅当此连接使用 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#domainsocket">Domain socket</a> 时有效。配置内容与上面的全局配置相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">quicSettings</span></strong>: QUICObject</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.7+) 当前连接的 QUIC 配置，仅当此连接使用 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#quic">QUIC</a> 时有效。配置内容与上面的全局配置相同。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">sockopt</span></strong>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#SockoptObject_transport">SockoptObject</a></span>
<ul>
<li><span style="font-size: 12pt;">连接选项。</span></li>
</ul>
</li>
</ul>
<p><a id="TLSObject_transport"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">TLSObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">serverName</span>": <span class="hljs-string">"v2ray.com"</span>,
  "<span class="hljs-attr">allowInsecure</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">allowInsecureCiphers</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">alpn</span>": [<span class="hljs-string">"http/1.1"</span>],
  "<span class="hljs-attr">certificates</span>": [],
  "<span class="hljs-attr">disableSystemRoot</span>": <span class="hljs-literal">false</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">serverName</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">指定服务器端证书的域名，在连接由 IP 建立时有用。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">alpn</span></strong>: [ string ]</span>
<ul>
<li><span style="font-size: 12pt;">一个字符串数组，指定了 TLS 握手时指定的 ALPN 数值。默认值为[“<span style="color: #ffcc99;">http/1.1</span>“]。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">allowInsecure</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否允许不安全连接（用于客户端）。当值为&nbsp;<span style="color: #ffcc99;">true&nbsp;</span>时，V2Ray 不会检查远端主机所提供的 TLS 证书的有效性。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">allowInsecureCiphers</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否允许不安全的加密方式。默认情况下 TLS 只使用 TLS 1.3 推荐的加密算法套件，开启这一选项会增加一些与 TLS 1.2 兼容的加密套件。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">certificates</span></strong>: [ <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#CertificateObject_transport">CertificateObject</a> ]</span>
<ul>
<li><span style="font-size: 12pt;">证书列表，其中每一项表示一个证书</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">disableSystemRoot</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">(V2Ray 4.18+) 是否禁用操作系统自带的 CA 证书。默认值为false。当值为true时，V2Ray 只会使用certificates中指定的证书进行 TLS 握手。</span></li>
</ul>
</li>
</ul>
<p><a id="CertificateObject_transport"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">CertificateObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">usage</span>": <span class="hljs-string">"encipherment"</span>,

  "<span class="hljs-attr">certificateFile</span>": <span class="hljs-string">"/path/to/certificate.crt"</span>,
  "<span class="hljs-attr">keyFile</span>": <span class="hljs-string">"/path/to/key.key"</span>,

  "<span class="hljs-attr">certificate</span>": [
    <span class="hljs-string">"-----BEGIN CERTIFICATE-----"</span>,
    <span class="hljs-string">"MIICwDCCAaigAwIBAgIRAO16JMdESAuHidFYJAR/7kAwDQYJKoZIhvcNAQELBQAw"</span>,
    <span class="hljs-string">"ADAeFw0xODA0MTAxMzU1MTdaFw0xODA0MTAxNTU1MTdaMAAwggEiMA0GCSqGSIb3"</span>,
    <span class="hljs-string">"DQEBAQUAA4IBDwAwggEKAoIBAQCs2PX0fFSCjOemmdm9UbOvcLctF94Ox4BpSfJ+"</span>,
    <span class="hljs-string">"3lJHwZbvnOFuo56WhQJWrclKoImp/c9veL1J4Bbtam3sW3APkZVEK9UxRQ57HQuw"</span>,
    <span class="hljs-string">"OzhV0FD20/0YELou85TwnkTw5l9GVCXT02NG+pGlYsFrxesUHpojdl8tIcn113M5"</span>,
    <span class="hljs-string">"pypgDPVmPeeORRf7nseMC6GhvXYM4txJPyenohwegl8DZ6OE5FkSVR5wFQtAhbON"</span>,
    <span class="hljs-string">"OAkIVVmw002K2J6pitPuJGOka9PxcCVWhko/W+JCGapcC7O74palwBUuXE1iH+Jp"</span>,
    <span class="hljs-string">"noPjGp4qE2ognW3WH/sgQ+rvo20eXb9Um1steaYY8xlxgBsXAgMBAAGjNTAzMA4G"</span>,
    <span class="hljs-string">"A1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNVHRMBAf8EAjAA"</span>,
    <span class="hljs-string">"MA0GCSqGSIb3DQEBCwUAA4IBAQBUd9sGKYemzwPnxtw/vzkV8Q32NILEMlPVqeJU"</span>,
    <span class="hljs-string">"7UxVgIODBV6A1b3tOUoktuhmgSSaQxjhYbFAVTD+LUglMUCxNbj56luBRlLLQWo+"</span>,
    <span class="hljs-string">"9BUhC/ow393tLmqKcB59qNcwbZER6XT5POYwcaKM75QVqhCJVHJNb1zSEE7Co7iO"</span>,
    <span class="hljs-string">"6wIan3lFyjBfYlBEz5vyRWQNIwKfdh5cK1yAu13xGENwmtlSTHiwbjBLXfk+0A/8"</span>,
    <span class="hljs-string">"r/2s+sCYUkGZHhj8xY7bJ1zg0FRalP5LrqY+r6BckT1QPDIQKYy615j1LpOtwZe/"</span>,
    <span class="hljs-string">"d4q7MD/dkzRDsch7t2cIjM/PYeMuzh87admSyL6hdtK0Nm/Q"</span>,
    <span class="hljs-string">"-----END CERTIFICATE-----"</span>
  ],
  "<span class="hljs-attr">key</span>": [
    <span class="hljs-string">"-----BEGIN RSA PRIVATE KEY-----"</span>,
    <span class="hljs-string">"MIIEowIBAAKCAQEArNj19HxUgoznppnZvVGzr3C3LRfeDseAaUnyft5SR8GW75zh"</span>,
    <span class="hljs-string">"bqOeloUCVq3JSqCJqf3Pb3i9SeAW7Wpt7FtwD5GVRCvVMUUOex0LsDs4VdBQ9tP9"</span>,
    <span class="hljs-string">"GBC6LvOU8J5E8OZfRlQl09NjRvqRpWLBa8XrFB6aI3ZfLSHJ9ddzOacqYAz1Zj3n"</span>,
    <span class="hljs-string">"jkUX+57HjAuhob12DOLcST8np6IcHoJfA2ejhORZElUecBULQIWzjTgJCFVZsNNN"</span>,
    <span class="hljs-string">"itieqYrT7iRjpGvT8XAlVoZKP1viQhmqXAuzu+KWpcAVLlxNYh/iaZ6D4xqeKhNq"</span>,
    <span class="hljs-string">"IJ1t1h/7IEPq76NtHl2/VJtbLXmmGPMZcYAbFwIDAQABAoIBAFCgG4phfGIxK9Uw"</span>,
    <span class="hljs-string">"qrp+o9xQLYGhQnmOYb27OpwnRCYojSlT+mvLcqwvevnHsr9WxyA+PkZ3AYS2PLue"</span>,
    <span class="hljs-string">"C4xW0pzQgdn8wENtPOX8lHkuBocw1rNsCwDwvIguIuliSjI8o3CAy+xVDFgNhWap"</span>,
    <span class="hljs-string">"/CMzfQYziB7GlnrM6hH838iiy0dlv4I/HKk+3/YlSYQEvnFokTf7HxbDDmznkJTM"</span>,
    <span class="hljs-string">"aPKZ5qbnV+4AcQfcLYJ8QE0ViJ8dVZ7RLwIf7+SG0b0bqloti4+oQXqGtiESUwEW"</span>,
    <span class="hljs-string">"/Wzi7oyCbFJoPsFWp1P5+wD7jAGpAd9lPIwPahdr1wl6VwIx9W0XYjoZn71AEaw4"</span>,
    <span class="hljs-string">"bK4xUXECgYEA3g2o9WqyrhYSax3pGEdvV2qN0VQhw7Xe+jyy98CELOO2DNbB9QNJ"</span>,
    <span class="hljs-string">"8cSSU/PjkxQlgbOJc8DEprdMldN5xI/srlsbQWCj72wXxXnVnh991bI2clwt7oYi"</span>,
    <span class="hljs-string">"pcGZwzCrJyFL+QaZmYzLxkxYl1tCiiuqLm+EkjxCWKTX/kKEFb6rtnMCgYEAx0WR"</span>,
    <span class="hljs-string">"L8Uue3lXxhXRdBS5QRTBNklkSxtU+2yyXRpvFa7Qam+GghJs5RKfJ9lTvjfM/PxG"</span>,
    <span class="hljs-string">"3vhuBliWQOKQbm1ZGLbgGBM505EOP7DikUmH/kzKxIeRo4l64mioKdDwK/4CZtS7"</span>,
    <span class="hljs-string">"az0Lq3eS6bq11qL4mEdE6Gn/Y+sqB83GHZYju80CgYABFm4KbbBcW+1RKv9WSBtK"</span>,
    <span class="hljs-string">"gVIagV/89moWLa/uuLmtApyEqZSfn5mAHqdc0+f8c2/Pl9KHh50u99zfKv8AsHfH"</span>,
    <span class="hljs-string">"TtjuVAvZg10GcZdTQ/I41ruficYL0gpfZ3haVWWxNl+J47di4iapXPxeGWtVA+u8"</span>,
    <span class="hljs-string">"eH1cvgDRMFWCgE7nUFzE8wKBgGndUomfZtdgGrp4ouLZk6W4ogD2MpsYNSixkXyW"</span>,
    <span class="hljs-string">"64cIbV7uSvZVVZbJMtaXxb6bpIKOgBQ6xTEH5SMpenPAEgJoPVts816rhHdfwK5Q"</span>,
    <span class="hljs-string">"8zetklegckYAZtFbqmM0xjOI6bu5rqwFLWr1xo33jF0wDYPQ8RHMJkruB1FIB8V2"</span>,
    <span class="hljs-string">"GxvNAoGBAM4g2z8NTPMqX+8IBGkGgqmcYuRQxd3cs7LOSEjF9hPy1it2ZFe/yUKq"</span>,
    <span class="hljs-string">"ePa2E8osffK5LBkFzhyQb0WrGC9ijM9E6rv10gyuNjlwXdFJcdqVamxwPUBtxRJR"</span>,
    <span class="hljs-string">"cYTY2HRkJXDdtT0Bkc3josE6UUDvwMpO0CfAETQPto1tjNEDhQhT"</span>,
    <span class="hljs-string">"-----END RSA PRIVATE KEY-----"</span>
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">usage</span></strong>: “encipherment” | “verify” | “issue”</span>
<ul>
<li><span style="font-size: 12pt;">证书用途，默认值为”<span style="color: #ffcc99;">encipherment</span>“</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">encipherment</span>“: 证书用于 TLS 认证和加密。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">verify</span>“: 证书用于验证远端 TLS 的证书。当使用此项时，当前证书必须为 CA 证书。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">issue</span>“: 证书用于签发其它证书。当使用此项时，当前证书必须为 CA 证书。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff; font-size: 12pt;">● 在 Windows 平台上可以将自签名的 CA 证书安装到系统中，即可验证远端 TLS 的证书。</span></div>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">●</span> <span style="color: #ffffff; font-size: 12pt;">当有新的客户端请求时，假设所指定的<span style="color: #ffcc99;">serverName</span>为”<span style="color: #ffcc99;">v2ray.com</span>“，V2Ray 会先从证书列表中寻找可用于”<span style="color: #ffcc99;">v2ray.com</span>“的证书，如果没有找到，则使用任一<span style="color: #ffcc99;">usage</span>为”<span style="color: #ffcc99;">issue</span>“的证书签发一个适用于”<span style="color: #ffcc99;">v2ray.com</span>“的证书，有效期为一小时。并将新的证书加入证书列表，以供后续使用。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">certificateFile</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">证书文件路径，如使用 OpenSSL 生成，后缀名为 .crt。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff; font-size: 12pt;">● 使用<span style="color: #ffcc99;">v2ctl cert -ca</span>可以生成自签名的 CA 证书。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">certificate</span></strong>: [ string ]</span>
<ul>
<li><span style="font-size: 12pt;">一个字符串数组，表示证书内容，格式如样例所示。<span style="color: #ffcc99;">certificate</span>和<span style="color: #ffcc99;">certificateFile</span>二者选一。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">keyFile</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">密钥文件路径，如使用 OpenSSL 生成，后缀名为 .key。目前暂不支持需要密码的 key 文件。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">key</span></strong>: [ string ]</span>
<ul>
<li><span style="font-size: 12pt;">一个字符串数组，表示密钥内容，格式如样例如示。key和keyFile二者选一。</span></li>
<li><span style="font-size: 12pt;">当<span style="color: #ffcc99;">certificateFile</span>和<span style="color: #ffcc99;">certificate</span>同时指定时，V2Ray 优先使用<span style="color: #ffcc99;">certificateFile</span>。<span style="color: #ffcc99;">keyFile</span>和<span style="color: #ffcc99;">key</span>也一样。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff; font-size: 12pt;">● 当<span style="color: #ffcc99;">usage</span>为”<span style="color: #ffcc99;">verify</span>“时，<span style="color: #ffcc99;">keyFile</span>和<span style="color: #ffcc99;">key</span>可均为空。</span></div>
<p><a id="SockoptObject_transport"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">SockoptObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">mark</span>": <span class="hljs-number">0</span>,
  "<span class="hljs-attr">tcpFastOpen</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">tproxy</span>": <span class="hljs-string">"off"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">mark</span></strong>: number</span>
<ul>
<li><span style="font-size: 12pt;">一个整数。当其值非零时，在出站连接上标记 SO_MARK。</span>
<ul>
<li><span style="font-size: 12pt;">仅适用于 Linux 系统。</span></li>
<li><span style="font-size: 12pt;">需要 CAP_NET_ADMIN 权限。</span></li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tcpFastOpen</span></strong>: true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否启用 <a href="https://zh.wikipedia.org/wiki/TCP%E5%BF%AB%E9%80%9F%E6%89%93%E5%BC%80" target="_blank" rel="noopener noreferrer">TCP Fast Open</a>。当其值为<span style="color: #ffcc99;">true</span>时，强制开启TFO；当其它为<span style="color: #ffcc99;">false</span>时，强制关闭TFO；当此项不存在时，使用系统默认设置。可用于入站出站连接。</span>
<ul>
<li><span style="font-size: 12pt;">仅在以下版本（或更新版本）的操作系统中可用:</span>
<ul>
<li><span style="font-size: 12pt;">Windows 10 (1604)</span></li>
<li><span style="font-size: 12pt;">Mac OS 10.11 / iOS 9</span></li>
<li><span style="font-size: 12pt;">Linux 3.16: 系统已默认开启，无需要配置。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tproxy</span></strong>: “redirect” | “tproxy” | “off”</span>
<ul>
<li><span style="font-size: 12pt;">是否开启透明代理 (仅适用于 Linux)。</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">redirect</span>“: 使用 Redirect 模式的透明代理。仅支持 TCP/IPv4 和 UDP 连接。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">tproxy</span>“: 使用 TProxy 模式的透明代理。支持 TCP 和 UDP 连接。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">off</span>“: 关闭透明代理。</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><span style="font-size: 12pt;">透明代理需要 Root 或 CAP_NET_ADMIN 权限。</span></p>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">● 当 </span><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#Dokodemo-door">Dokodemo-door</a><span style="color: #ffffff;"> 中指定了<span style="color: #ffcc99;">followRedirect</span>，且<span style="color: #ffcc99;">sockopt.tproxy</span>为空时，<span style="color: #ffcc99;">sockopt.tproxy</span>的值会被设为”<span style="color: #ffcc99;">redirect</span>“。</span></div>
<h2><a name="TCP"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>TCP 传输方式</strong></div></span></h2>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">TcpObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">header</span>": {
    "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">header</span></strong>:&nbsp;NoneHeaderObject | HttpHeaderobject</span>
<ul>
<li><span style="font-size: 12pt;">数据包头部伪装设置，默认值为<span style="color: #ffcc99;">NoneHeaderObject</span>。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">NoneHeaderObject</span></div>
<p><span style="font-size: 12pt;">不进行伪装</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;">type: “none”</span>
<ul>
<li><span style="font-size: 12pt;">指定不进行伪装</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">HttpHeaderObject</span></div>
<p><span style="font-size: 12pt;">HTTP 伪装配置必须在对应的入站出站连接上同时配置，且内容必须一致。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"http"</span>,
  "<span class="hljs-attr">request</span>": {},
  "<span class="hljs-attr">response</span>": {}
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">type</span></strong>: “http”</span>
<ul>
<li><span style="font-size: 12pt;">指定进行 HTTP 伪装</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">request</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HTTPRequestObject">HTTPRequestObject</a></span>
<ul>
<li><span style="font-size: 12pt;">HTTP 请求</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">response</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HTTPResponseObject">HTTPResponseObject</a></span>
<ul>
<li><span style="font-size: 12pt;">HTTP 响应</span></li>
</ul>
</li>
</ul>
<p><a id="HTTPRequestObject"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">HTTPRequestObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">version</span>": <span class="hljs-string">"1.1"</span>,
  "<span class="hljs-attr">method</span>": <span class="hljs-string">"GET"</span>,
  "<span class="hljs-attr">path</span>": [<span class="hljs-string">"/"</span>],
  "<span class="hljs-attr">headers</span>": {
    "<span class="hljs-attr">Host</span>": [<span class="hljs-string">"www.baidu.com"</span>, <span class="hljs-string">"www.bing.com"</span>],
    "<span class="hljs-attr">User-Agent</span>": [
      <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36"</span>,
      <span class="hljs-string">"Mozilla/5.0 (iPhone; CPU iPhone OS 10_0_2 like Mac OS X) AppleWebKit/601.1 (KHTML, like Gecko) CriOS/53.0.2785.109 Mobile/14A456 Safari/601.1.46"</span>
    ],
    "<span class="hljs-attr">Accept-Encoding</span>": [<span class="hljs-string">"gzip, deflate"</span>],
    "<span class="hljs-attr">Connection</span>": [<span class="hljs-string">"keep-alive"</span>],
    "<span class="hljs-attr">Pragma</span>": <span class="hljs-string">"no-cache"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">version</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 版本，默认值为”<span style="color: #ffcc99;">1.1</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">method</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 方法，默认值为”<span style="color: #ffcc99;">GET</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">path</span></strong>: [ string ]</span>
<ul>
<li><span style="font-size: 12pt;">路径，一个字符串数组。默认值为[“<span style="color: #ffcc99;">/</span>“]。当有多个值时，每次请求随机选择一个值。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">headers</span></strong>: map{ string, [ string ]}</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 头，一个键值对，每个键表示一个 HTTP 头的名称，对应的值是一个数组。每次请求会附上所有的键，并随机选择一个对应的值。默认值见上方示例。</span></li>
</ul>
</li>
</ul>
<p><a id="HTTPResponseObject"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">HTTPResponseObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">version</span>": <span class="hljs-string">"1.1"</span>,
  "<span class="hljs-attr">status</span>": <span class="hljs-string">"200"</span>,
  "<span class="hljs-attr">reason</span>": <span class="hljs-string">"OK"</span>,
  "<span class="hljs-attr">headers</span>": {
    "<span class="hljs-attr">Content-Type</span>": [<span class="hljs-string">"application/octet-stream"</span>, <span class="hljs-string">"video/mpeg"</span>],
    "<span class="hljs-attr">Transfer-Encoding</span>": [<span class="hljs-string">"chunked"</span>],
    "<span class="hljs-attr">Connection</span>": [<span class="hljs-string">"keep-alive"</span>],
    "<span class="hljs-attr">Pragma</span>": <span class="hljs-string">"no-cache"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">version</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 版本，默认值为”<span style="color: #ffcc99;">1.1</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">status</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 状态，默认值为”<span style="color: #ffcc99;">200</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">reason</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 状态说明，默认值为”<span style="color: #ffcc99;">OK</span>“。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">headers</span></strong>: map{string, [ string ]}</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 头，一个键值对，每个键表示一个 HTTP 头的名称，对应的值是一个数组。每次请求会附上所有的键，并随机选择一个对应的值。默认值见上方示例。</span></li>
</ul>
</li>
</ul>
<h2><a name="mKCP"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>mKCP 传输方式</strong></div></span></h2>
<p><span style="font-size: 12pt;"><a href="https://www.v2ray.com/eng/protocols/mkcp.html" target="_blank" rel="noopener noreferrer">mKCP</a> 是流式传输协议，由 <a href="https://github.com/skywind3000/kcp" target="_blank" rel="noopener noreferrer">KCP 协议</a>修改而来，可以按顺序传输任意的数据流。</span></p>
<p><span style="font-size: 12pt;">mKCP 使用 UDP 来模拟 TCP 连接，请确定主机上的防火墙配置正确。mKCP 牺牲带宽来降低延迟。传输同样的内容，mKCP 一般比 TCP 消耗更多的流量。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">KcpObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">mtu</span>": <span class="hljs-number">1350</span>,
  "<span class="hljs-attr">tti</span>": <span class="hljs-number">20</span>,
  "<span class="hljs-attr">uplinkCapacity</span>": <span class="hljs-number">5</span>,
  "<span class="hljs-attr">downlinkCapacity</span>": <span class="hljs-number">20</span>,
  "<span class="hljs-attr">congestion</span>": <span class="hljs-literal">false</span>,
  "<span class="hljs-attr">readBufferSize</span>": <span class="hljs-number">1</span>,
  "<span class="hljs-attr">writeBufferSize</span>": <span class="hljs-number">1</span>,
  "<span class="hljs-attr">header</span>": {
    "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">mtu</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">最大传输单元（maximum transmission unit），请选择一个介于 <span style="color: #ffcc99;">576</span> – <span style="color: #ffcc99;">1460</span> 之间的值。默认值为 <span style="color: #ffcc99;">1350</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tti</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">传输时间间隔（transmission time interval），单位毫秒（ms），mKCP 将以这个时间频率发送数据。请选译一个介于 <span style="color: #ffcc99;">10</span> – <span style="color: #ffcc99;">100</span> 之间的值。默认值为 <span style="color: #ffcc99;">50</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">uplinkCapacity</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">上行链路容量，即主机发出数据所用的最大带宽，单位 MB/s，默认值 <span style="color: #ffcc99;">5</span>。注意是 Byte 而非 bit。可以设置为 <span style="color: #ffcc99;">0</span>，表示一个非常小的带宽。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">downlinkCapacity</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">下行链路容量，即主机接收数据所用的最大带宽，单位 MB/s，默认值 <span style="color: #ffcc99;">20</span>。注意是 Byte 而非 bit。可以设置为 <span style="color: #ffcc99;">0</span>，表示一个非常小的带宽。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● <span style="color: #ffcc99;">uplinkCapacity</span> 和 <span style="color: #ffcc99;">downlinkCapacity</span> 决定了 mKCP 的传输速度。以客户端发送数据为例，客户端的 <span style="color: #ffcc99;">uplinkCapacity</span> 指定了发送数据的速度，而服务器端的 <span style="color: #ffcc99;">downlinkCapacity</span> 指定了接收数据的速度。两者的值以较小的一个为准。推荐把 <span style="color: #ffcc99;">downlinkCapacity</span> 设置为一个较大的值，比如 100，而 <span style="color: #ffcc99;">uplinkCapacity</span> 设为实际的网络速度。当速度不够时，可以逐渐增加 <span style="color: #ffcc99;">uplinkCapacity</span> 的值，直到带宽的两倍左右。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">congestion</span></strong>:&nbsp;true | false</span>
<ul>
<li><span style="font-size: 12pt;">是否启用拥塞控制，默认值为 <span style="color: #ffcc99;">false</span>。开启拥塞控制之后，V2Ray 会自动监测网络质量，当丢包严重时，会自动降低吞吐量；当网络畅通时，也会适当增加吞吐量。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">readBufferSize</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">单个连接的读取缓冲区大小，单位是 MB。默认值为 <span style="color: #ffcc99;">2</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">writeBufferSize</span></strong>:&nbsp;number</span>
<ul>
<li><span style="font-size: 12pt;">单个连接的写入缓冲区大小，单位是 MB。默认值为 <span style="color: #ffcc99;">2</span>。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff;">● <span style="color: #ffcc99;">readBufferSize </span>和 <span style="color: #ffcc99;">writeBufferSize </span>指定了单个连接所使用的内存大小。在需要高速传输时，指定较大的 <span style="color: #ffcc99;">readBufferSize</span> 和 <span style="color: #ffcc99;">writeBufferSize</span> 会在一定程度上提高速度，但也会使用更多的内存。在网速不超过 20MB/s 时，默认值 1MB 可以满足需求；超过之后，可以适当增加 <span style="color: #ffcc99;">readBufferSize</span> 和 <span style="color: #ffcc99;">writeBufferSize</span> 的值，然后手动平衡速度和内存的关系。</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">header</span></strong>:&nbsp;<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HeaderObject_mKCP">HeaderObject</a></span>
<ul>
<li><span style="font-size: 12pt;">数据包头部伪装设置。</span></li>
</ul>
</li>
</ul>
<p><a id="HeaderObject_mKCP"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">HeaderObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">type</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">伪装类型，可选的值有：</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">none</span>“: 默认值，不进行伪装，发送的数据是没有特征的数据包。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">srtp</span>“: 伪装成 SRTP 数据包，会被识别为视频通话数据（如 FaceTime）。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">utp</span>“: 伪装成 uTP 数据包，会被识别为 BT 下载数据。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">wechat-video</span>“: 伪装成微信视频通话的数据包。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">dtls</span>“: 伪装成 DTLS 1.2 数据包。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">wireguard</span>“: 伪装成 WireGuard 数据包。(并不是真正的 WireGuard 协议)</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">鸣谢</span></div>
<ul>
<li>@skywind3000 发明并实现了 KCP 协议；</li>
<li>@xtaci 将 KCP 由 C 语言实现翻译成 Go；</li>
<li>@xiaokangwang 测试 KCP 与 V2Ray 的整合并提交了最初的 PR。</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">对 KCP 协议的改进</span></div>
<p><strong><span style="font-size: 12pt;">更小的协议头</span></strong></p>
<p><span style="font-size: 12pt;">原生 KCP 协议使用了 24 字节的固定头部，而 mKCP 修改为数据包 18 字节，确认（ACK）包 16 字节。更小的头部有助于躲避特征检查，并加快传输速度。</span></p>
<p><span style="font-size: 12pt;">另外，原生 KCP 的单个确认包只能确认一个数据包已收到，也就是说当 KCP 需要确认 100 个数据已收到时，它会发出 24 * 100 = 2400 字节的数据。其中包含了大量重复的头部数据，造成带宽的浪费。mKCP 会对多个确认包进行压缩，100 个确认包只需要 16 + 2 + 100 * 4 = 418 字节，相当于原生的六分之一。</span></p>
<p><strong><span style="font-size: 12pt;">确认包重传</span></strong></p>
<p><span style="font-size: 12pt;">原生 KCP 协议的确认（ACK）包只发送一次，如果确认包丢失，则一定会导致数据重传，造成不必要的带宽浪费。而 mKCP 会以一定的频率重发确认包，直到发送方确认为止。单个确认包的大小为 22 字节，相比起数据包的 1000 字节以上，重传确认包的代价要小得多。</span></p>
<p><strong><span style="font-size: 12pt;">连接状态控制</span></strong></p>
<p><span style="font-size: 12pt;">mKCP 可以有效地开启和关闭连接。当远程主机主动关闭连接时，连接会在两秒钟之内释放；当远程主机断线时，连接会在最多 30 秒内释放。</span></p>
<p><span style="font-size: 12pt;">原生 KCP 不支持这个场景。</span></p>
<h2><a name="WebSocket"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>WebSocket 传输方式</strong></div></span></h2>
<p><span style="font-size: 12pt;">使用标准的 WebSocket 来传输数据。WebSocket 连接可以被其它 HTTP 服务器（如 NGINX）分流。</span></p>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● Websocket 会识别 HTTP 请求的 X-Forwarded-For 头来用做流量的源地址。</span></div>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">WebSocketObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">path</span>": <span class="hljs-string">"/"</span>,
  "<span class="hljs-attr">headers</span>": {
    "<span class="hljs-attr">Host</span>": <span class="hljs-string">"v2ray.com"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">path</span></strong>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">WebSocket 所使用的 HTTP 协议路径，默认值为 “/”。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">headers</span></strong>:&nbsp;map{string: string}</span>
<ul>
<li><span style="font-size: 12pt;">自定义 HTTP 头，一个键值对，每个键表示一个 HTTP 头的名称，对应的值是字符串。默认值为空。</span></li>
</ul>
</li>
</ul>
<h2><span style="color: #ffcc00;"><a id="HTTP2"></a><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>HTTP/2&nbsp;传输方式</strong></div></span></h2>
<p><span style="font-size: 12pt;">V2Ray 3.17 中加入了基于 HTTP/2 的传输方式。它完整按照 HTTP/2 标准实现，可以通过其它的 HTTP 服务器（如 Nginx）进行中转。</span></p>
<p><span style="font-size: 12pt;">由 HTTP/2 的建议，客户端和服务器必须同时开启 TLS 才可以正常使用这个传输方式。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">HttpObject</span></div>
<p><span style="font-size: 12pt;">HttpObject对应传输配置中的httpSettings项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">host</span>": [<span class="hljs-string">"v2ray.com"</span>],
  "<span class="hljs-attr">path</span>": <span class="hljs-string">"/random/path"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">host</span></strong>:&nbsp;[string]</span>
<ul>
<li><span style="font-size: 12pt;">一个字符串数组，每一个元素是一个域名。客户端会随机从列表中选出一个域名进行通信，服务器会验证域名是否在列表中。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">path</span></strong>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">HTTP 路径，由/开头。客户端和服务器必须一致。可选参数，默认值为”<span style="color: #ffcc99;">/</span>“。</span></li>
</ul>
</li>
</ul>
<h2><span style="color: #ffcc00;"><a id="domainsocket"></a><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>DomainSocket 传输方式</strong></div></span></h2>
<p><span style="font-size: 12pt;">Domain Socket 使用标准的 Unix domain socket 来传输数据。它的优势是使用了操作系统内建的传输通道，而不会占用网络缓存。相比起本地环回网络（local loopback）来说，Domain socket 速度略快一些。</span></p>
<p><span style="font-size: 12pt;">目前仅可用于支持 Unix domain socket 的平台，如 macOS 和 Linux。在 Windows 上不可用。</span></p>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● 如果指定了 domain socket 作为传输方式，在入站出站代理中配置的端口和 IP 地址将会失效，所有的传输由 domain socket 取代。</span></div>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">DomainSocketObject</span></div>
<p><span style="font-size: 12pt;">DomainSocketObject对应传输配置中的dsSettings项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">path</span>": <span class="hljs-string">"/path/to/ds/file"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">path</span></strong>:&nbsp;string</span>
<ul>
<li><span style="font-size: 12pt;">一个合法的文件路径。在运行 V2Ray 之前，这个文件必须不存在。</span></li>
</ul>
</li>
</ul>
<h2><span style="color: #ffcc00;"><a id="quic"></a><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>QUIC 传输方式</strong></div></span></h2>
<p><span style="font-size: 12pt;">QUIC 全称 Quick UDP Internet Connection，是由 Google 提出的使用 UDP 进行多路并发传输的协议。其主要优势是:</span></p>
<ol>
<li><span style="font-size: 12pt;">减少了握手的延迟（1-RTT 或 0-RTT）</span></li>
<li><span style="font-size: 12pt;">多路复用，并且没有 TCP 的阻塞问题</span></li>
<li><span style="font-size: 12pt;">连接迁移，（主要是在客户端）当由 Wifi 转移到 4G 时，连接不会被断开。</span></li>
</ol>
<p><span style="font-size: 12pt;">QUIC 目前处于实验期，使用了正在标准化过程中的 IETF 实现，不能保证与最终版本的兼容性。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">版本历史</span></div>
<p><span style="font-size: 12pt;">V2Ray 4.7:</span></p>
<ul>
<li><span style="font-size: 12pt;">开始支持 QUIC。</span></li>
<li><span style="font-size: 12pt;">默认设定:</span>
<ul>
<li><span style="font-size: 12pt;">12 字节的 Connection ID</span></li>
<li><span style="font-size: 12pt;">30 秒没有数据通过时自动断开连接 (可能会影响一些长连接的使用)</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">QuicObject</span></div>
<p><span style="font-size: 12pt;">QUIC 的配置对应传输配置中的 <span style="color: #ffcc99;">quicSettings</span> 项。对接的两端的配置必须完全一致，否则连接失败。QUIC 强制要求开启 TLS，在传输配置中没有开启 TLS 时，V2Ray 会自行签发一个证书进行 TLS 通讯。在使用 QUIC 传输时，可以关闭 VMess 的加密。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">security</span>": <span class="hljs-string">"none"</span>,
  "<span class="hljs-attr">key</span>": <span class="hljs-string">""</span>,
  "<span class="hljs-attr">header</span>": {
    "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">security</span></strong>: “none” | “aes-128-gcm” | “chacha20-poly1305”</span>
<ul>
<li><span style="font-size: 12pt;">加密方式。默认值为不加密。</span></li>
<li><span style="font-size: 12pt;">此加密是对 QUIC 数据包的加密，加密后数据包无法被探测。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">key</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">加密时所用的密钥。可以是任意字符串。当security不为”none”时有效。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">header</span></strong>: <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#HeaderObject_quic">HeaderObject</a></span>
<ul>
<li><span style="font-size: 12pt;">数据包头部伪装设置</span></li>
</ul>
</li>
</ul>
<p><a id="HeaderObject_quic"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">HeaderObject</span></div>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">type</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">伪装类型，可选的值有：</span>
<ul>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">none</span>“: 默认值，不进行伪装，发送的数据是没有特征的数据包。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">srtp</span>“: 伪装成 SRTP 数据包，会被识别为视频通话数据（如 FaceTime）。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">utp</span>“: 伪装成 uTP 数据包，会被识别为 BT 下载数据。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">wechat-video</span>“: 伪装成微信视频通话的数据包。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">dtls</span>“: 伪装成 DTLS 1.2 数据包。</span></li>
<li><span style="font-size: 12pt;">“<span style="color: #ffcc99;">wireguard</span>“: 伪装成 WireGuard 数据包。(并不是真正的 WireGuard 协议)</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="font-size: 12pt; color: #ffffff;">● 当加密和伪装都不启用时，数据包即为原始的 QUIC 数据包，可以与其它的 QUIC 工具对接。为了避免被探测，建议加密或伪装至少开启一项。</span></div>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="stats"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><span style="color: #ffffff;"><strong>统计信息</strong></span></div></h1>
<p><span style="font-size: 12pt;">V2Ray 提供了一些关于其运行状况的统计信息。</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>StatsObject</div></h2>
<p><span style="font-size: 12pt;">StatsObject 对应配置文件中的stats项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">目前统计信息没有任何参数，只要StatsObject项存在，内部的统计即会开启。同时你还需要在<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#policy">本地策略</a>中开启对应的项，才可以统计对应的数据。</span></p>
<p><span style="font-size: 12pt;">目前已有的统计信息如下：</span></p>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>用户数据<span style="word-spacing: normal;"></span></div></h2>
<ul>
<li><span style="font-size: 12pt;">user&gt;&gt;&gt;[email]&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink</span>
<ul>
<li><span style="font-size: 12pt;">特定用户的上行流量，单位字节。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">user&gt;&gt;&gt;[email]&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink</span>
<ul>
<li><span style="font-size: 12pt;">特定用户的下行流量，单位字节。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-blue"><i class="dwicon-blue"></i><span style="color: #ffffff; font-size: 12pt;">● 如果对应用户没有指定 Email，则不会开启统计。</span></div>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>全局数据<span style="word-spacing: normal;"></span></div></h2>
<ul>
<li><span style="font-size: 12pt;">inbound&gt;&gt;&gt;[tag]&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink</span>
<ul>
<li><span style="font-size: 12pt;">特定入站代理的上行流量，单位字节。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;">inbound&gt;&gt;&gt;[tag]&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink</span>
<ul>
<li><span style="font-size: 12pt;">特定入站代理的下行流量，单位字节。</span></li>
</ul>
</li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<h1><a id="reverse"></a><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><span style="color: #ffffff;"><strong>反向代理</strong></span></div></h1>
<p><span style="font-size: 12pt;">反向代理是一个 V2Ray 的附加功能，可以把服务器端的流量向客户端转发，即逆向流量转发。</span></p>
<div class="dw-box dw-box-warning"><i class="dwicon-warning"></i><span style="font-size: 12pt;">反向代理功能在 V2Ray 4.0+ 可用。目前处于测试阶段，可能会有一些问题。</span></div>
<p><span style="font-size: 12pt;">反向代理的大致工作原理如下:</span></p>
<ul>
<li><span style="font-size: 12pt;">假设在主机 A 中有一个网页服务器，这台主机没有公网 IP，无法在公网上直接访问。另有一台主机 B，它可以由公网访问。现在我们需要把 B 作为入口，把流量从 B 转发到 A。</span></li>
<li><span style="font-size: 12pt;">在主机 A 中配置一个 V2Ray，称为<span style="color: #ffcc99;">bridge</span>，在 B 中也配置一个 V2Ray，称为<span style="color: #ffcc99;">portal</span>。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">bridge</span>会向<span style="color: #ffcc99;">portal</span>主动建立连接，此连接的目标地址可以自行设定。<span style="color: #ffcc99;">portal</span>会收到两种连接，一是由<span style="color: #ffcc99;">bridge</span>发来的连接，二是公网用户发来的连接。<span style="color: #ffcc99;">portal</span>会自动将两类连接合并。于是<span style="color: #ffcc99;">bridge</span>就可以收到公网流量了。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">bridge</span>在收到公网流量之后，会将其原封不动地发给主机 A 中的网页服务器。当然，这一步需要路由的协作。</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">bridge</span>会根据流量的大小进行动态的负载均衡。</span></li>
</ul>
<div class="dw-box dw-box-alert"><i class="dwicon-alert"></i><span style="font-size: 12pt;">反向代理默认已开启 <a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#mux">Mux</a>，请不要在其用到的出站代理上再次开启 Mux。</span></div>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>ReverseObject<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">ReverseObject对应配置文件中的reverse项。</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">bridges</span>": [{
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"bridge"</span>,
    "<span class="hljs-attr">domain</span>": <span class="hljs-string">"test.v2ray.com"</span>
  }],
  "<span class="hljs-attr">portals</span>": [{
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"portal"</span>,
    "<span class="hljs-attr">domain</span>": <span class="hljs-string">"test.v2ray.com"</span>
  }]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">bridges</span></strong>: [<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#BridgeObject_reverse">BridgeObject</a>]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，每一项表示一个bridge。每个bridge的配置是一个 BridgeObject。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">portals</span></strong>: [<a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#PortalObject_reverse">PortalObject</a>]</span>
<ul>
<li><span style="font-size: 12pt;">一个数组，每一项表示一个portal。每个portal的配置是一个 PortalObject。</span></li>
</ul>
</li>
</ul>
<p><a id="BridgeObject_reverse"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">BridgeObject</span><span style="word-spacing: normal;"></span></div><p></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"bridge"</span>,
  "<span class="hljs-attr">domain</span>": <span class="hljs-string">"test.v2ray.com"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">其中：</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">一个标识，所有由&nbsp;<span style="color: #ffcc99;">bridge&nbsp;</span>发出的连接，都会带有这个标识。可以在路由中使用inboundTag进行识别。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domain</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">一个域名。<span style="color: #ffcc99;">bridge</span> 向 <span style="color: #ffcc99;">portal&nbsp;</span>建立的连接，都会使用这个域名进行发送。这个域名只作为&nbsp;<span style="color: #ffcc99;">bridge&nbsp;</span>和 <span style="color: #ffcc99;">portal&nbsp;</span>的通信用途，不必真实存在。</span></li>
</ul>
</li>
</ul>
<p><a id="PortalObject_reverse"></a></p><div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">PortalObject</span></div>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">tag</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;">portal&nbsp;</span>的标识。在路由中使用&nbsp;<span style="color: #ffcc99;">outboundTag&nbsp;</span>将流量转发到这个&nbsp;<span style="color: #ffcc99;">portal</span>。</span></li>
</ul>
</li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">domain</span></strong>: string</span>
<ul>
<li><span style="font-size: 12pt;">一个域名。当&nbsp;<span style="color: #ffcc99;">portal&nbsp;</span>接收到流量时，如果流量的目标域名是此域名，则&nbsp;<span style="color: #ffcc99;">portal&nbsp;</span>认为当前连接上 <span style="color: #ffcc99;">bridge</span> 发来的通信连接。而其它流量则会被当成需要转发的流量。<span style="color: #ffcc99;">portal</span> 所做的工作就是把这两类连接进行识别并拼接。</span></li>
</ul>
</li>
</ul>
<div class="dw-box dw-box-green"><i class="dwicon-green"></i><span style="color: #ffffff; font-size: 12pt;">● 和其它配置一样，一个 V2Ray 既可以作为<span style="color: #ffcc99;">bridge</span>，也可以作为<span style="color: #ffcc99;">portal</span>，也可以同时两者，以适用于不同的场景需要。</span></div>
<h2><div class="dw-box dw-box-block"><i class="dwicon-block"></i>完整配置<span style="word-spacing: normal;"></span></div></h2>
<p><span style="font-size: 12pt;">bridge通常需要两个出站代理，一个用于连接portal，另一个用于发送实际的流量。也就是说，你需要用路由区分两种流量。</span></p>
<p><span style="font-size: 12pt;">反向代理配置:</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">bridges</span>": [{
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"bridge"</span>,
    "<span class="hljs-attr">domain</span>": <span class="hljs-string">"test.v2ray.com"</span>
  }]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">出站代理:</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"out"</span>,
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">redirect</span>": <span class="hljs-string">"127.0.0.1:80"</span> // 将所有流量转发到网页服务器
  }
},
{
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">vnext</span>": [{
      "<span class="hljs-attr">address</span>": <span class="hljs-string">"portal的IP地址"</span>,
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1024</span>,
      "<span class="hljs-attr">users</span>": [{"<span class="hljs-attr">id</span>": <span class="hljs-string">"27848739-7e62-4138-9fd3-098a63964b6b"</span>}]
    }]
  },
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"interconn"</span>
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">路由配置:</span></p>
<pre class="pure-highlightjs"><code class="json hljs"><span class="hljs-string">"routing"</span>: {
  "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"rules"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">rules</span>": [{
      "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
      "<span class="hljs-attr">inboundTag</span>": [<span class="hljs-string">"bridge"</span>],
      "<span class="hljs-attr">domain</span>": [<span class="hljs-string">"full:test.v2ray.com"</span>],
      "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"interconn"</span>
    },{
      "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
      "<span class="hljs-attr">inboundTag</span>": [<span class="hljs-string">"bridge"</span>],
      "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"out"</span>
    }]
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">portal通常需要两个入站代理，一个用于接收bridge的连接，另一个用于接收实际的流量。同时你也需要用路由区分两种流量。</span></p>
<p><span style="font-size: 12pt;">反向代理配置:</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">portals</span>": [{
    "<span class="hljs-attr">tag</span>": <span class="hljs-string">"portal"</span>,
    "<span class="hljs-attr">domain</span>": <span class="hljs-string">"test.v2ray.com"</span>  // 必须和 bridge 的配置一样
  }]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">入站代理:</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"external"</span>,
  "<span class="hljs-attr">port</span>": <span class="hljs-number">80</span>,  // 开放 80 端口，用于接收外部的 HTTP 访问
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"dokodemo-door"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">address</span>": <span class="hljs-string">"127.0.0.1"</span>,
    "<span class="hljs-attr">port</span>": <span class="hljs-number">80</span>,
    "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>
  }
},
{
  "<span class="hljs-attr">port</span>": <span class="hljs-number">1024</span>, // 用于接收 bridge 的连接
  "<span class="hljs-attr">tag</span>": <span class="hljs-string">"interconn"</span>,
  "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">clients</span>": [{"<span class="hljs-attr">id</span>": <span class="hljs-string">"27848739-7e62-4138-9fd3-098a63964b6b"</span>}]
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">路由配置:</span></p>
<pre class="pure-highlightjs"><code class="json hljs"><span class="hljs-string">"routing"</span>: {
  "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"rules"</span>,
  "<span class="hljs-attr">settings</span>": {
    "<span class="hljs-attr">rules</span>": [{
      "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
      "<span class="hljs-attr">inboundTag</span>": [<span class="hljs-string">"external"</span>],
      "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"portal"</span>
    },{
      "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
      "<span class="hljs-attr">inboundTag</span>": [<span class="hljs-string">"interconn"</span>],
      "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"portal"</span>
    }]
  }
}</code></pre>
<div class="dw-box dw-box-tip"><i class="dwicon-tip"></i><span style="font-size: 12pt;">在运行过程中，建议先启用bridge，再启用portal。</span></div>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="env"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><span style="color: #ffffff;"><strong>环境变量</strong></span></div></h1>
<p><span style="font-size: 12pt;">V2Ray 提供以下环境变量以供修改 V2Ray 的一些底层配置。</span></p>
<h2><a id="env_buffer-size"></a>每个连接的缓存大小</h2>
<ul>
<li><span style="font-size: 12pt;">名称:&nbsp;<span style="color: #ffcc99;">v2ray.ray.buffer.size</span>&nbsp;或&nbsp;<span style="color: #ffcc99;">V2RAY_RAY_BUFFER_SIZE</span></span></li>
<li><span style="font-size: 12pt;">单位: MBytes</span></li>
<li><span style="font-size: 12pt;">默认值: 在 x86、amd64、arm64、s390x 上为 <span style="color: #ffcc99;">2</span>，其它平台上禁用该缓存。</span></li>
<li><span style="font-size: 12pt;">特殊值: 0 表示缓存无上限</span></li>
</ul>
<p><span style="font-size: 12pt;"><strong>已过时，请使用本地策略中的 bufferSize</strong></span></p>
<p><span style="font-size: 12pt;">对于一个代理连接，当上下游网络速度有差距时，V2Ray 会缓存一部分数据，以减小对网络传输的影响。这个配置设置了缓存的大小，越大的缓存会占用更多的内存，也会使网络性能越好。</span></p>
<h2><a id="env_asset-location"></a>资源文件路径</h2>
<ul>
<li><span style="font-size: 12pt;">名称:&nbsp;<span style="color: #ffcc99;">v2ray.location.asset</span>&nbsp;或&nbsp;<span style="color: #ffcc99;">V2RAY_LOCATION_ASSET</span></span></li>
<li><span style="font-size: 12pt;">默认值: 和 v2ray 文件同路径</span></li>
</ul>
<p><span style="font-size: 12pt;">这个环境变量指定了一个文件夹位置，这个文件夹应当包含 geoip.dat 和 geosite.dat 文件。</span></p>
<h2><a id="env_config-location"></a>配置文件位置</h2>
<ul>
<li><span style="font-size: 12pt;">名称:&nbsp;<span style="color: #ffcc99;">v2ray.location.config</span>&nbsp;或&nbsp;<span style="color: #ffcc99;">V2RAY_LOCATION_CONFIG</span></span></li>
<li><span style="font-size: 12pt;">默认值: 和 v2ray 文件同路径</span></li>
</ul>
<p><span style="font-size: 12pt;">这个环境变量指定了一个文件夹位置，这个文件夹应当包含 config.json 文件。</span></p>
<h2><a id="env_scatter-io"></a>分散读取</h2>
<ul>
<li><span style="font-size: 12pt;">名称：<span style="color: #ffcc99;">v2ray.buf.readv</span>&nbsp;或&nbsp;<span style="color: #ffcc99;">V2RAY_BUF_READV</span></span></li>
<li><span style="font-size: 12pt;">默认值：<span style="color: #ffcc99;">auto</span></span></li>
</ul>
<p><span style="font-size: 12pt;">V2Ray 3.37 开始使用 Scatter/Gather IO，这一特性可以在大流量（超过 100 MByte/s）的时候依然使用较低的内存。可选的值有<span style="color: #ffcc99;">auto</span>、<span style="color: #ffcc99;">enable</span>和<span style="color: #ffcc99;">disable</span>。</span></p>
<ul>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">enable</span></strong>: 强制开启分散读取特性。</span></li>
<li><span style="font-size: 12pt;"><strong><span style="color: #ffcc99;">disable</span></strong>: 强制关闭分散读取特性</span></li>
<li><span style="font-size: 12pt;"><span style="color: #ffcc99;"><strong>auto</strong></span>: 仅在 Windows、MacOS、Linux 并且 CPU 平台为 x86、AMD64、s390x 时，开启此特性。</span></li>
</ul>
<p><span style="font-size: 12pt;">在流量没有达到 100 MByte/s 时，开启与否在内存使用上没有明显的差异。</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="eg"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">配置实例</span></strong></div></h1>
<p><span style="font-size: 12pt;">这里有一些例子以供参考</span></p>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i>V2Ray使用Shadowsocks协议</div></span></h2>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1080</span>, // 监听端口
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"socks"</span>, // 入口协议为 SOCKS 5
      "<span class="hljs-attr">domainOverride</span>": [<span class="hljs-string">"tls"</span>,<span class="hljs-string">"http"</span>],
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">auth</span>": <span class="hljs-string">"noauth"</span>  // 不认证
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"shadowsocks"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">servers</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"serveraddr.com"</span>, // Shadowsocks 的服务器地址
            "<span class="hljs-attr">method</span>": <span class="hljs-string">"aes-128-gcm"</span>, // Shadowsocks 的加密方式
            "<span class="hljs-attr">ota</span>": <span class="hljs-literal">true</span>, // 是否开启 OTA，true 为开启
            "<span class="hljs-attr">password</span>": <span class="hljs-string">"sspasswd"</span>, // Shadowsocks 的密码
            "<span class="hljs-attr">port</span>": <span class="hljs-number">1024</span>  
          }
        ]
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1024</span>, // 监听端口
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"shadowsocks"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">method</span>": <span class="hljs-string">"aes-128-gcm"</span>,
        "<span class="hljs-attr">ota</span>": <span class="hljs-literal">true</span>, // 是否开启 OTA
        "<span class="hljs-attr">password</span>": <span class="hljs-string">"sspasswd"</span>
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,  
      "<span class="hljs-attr">settings</span>": {}
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>mKCP</strong></div></span></h2>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1080</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"socks"</span>,
      "<span class="hljs-attr">domainOverride</span>": [<span class="hljs-string">"tls"</span>,<span class="hljs-string">"http"</span>],
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">auth</span>": <span class="hljs-string">"noauth"</span>
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"serveraddr.com"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">16823</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
              }
            ]
          }
        ]
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"mkcp"</span>,
        "<span class="hljs-attr">kcpSettings</span>": {
          "<span class="hljs-attr">uplinkCapacity</span>": <span class="hljs-number">5</span>,
          "<span class="hljs-attr">downlinkCapacity</span>": <span class="hljs-number">100</span>,
          "<span class="hljs-attr">congestion</span>": <span class="hljs-literal">true</span>,
          "<span class="hljs-attr">header</span>": {
            "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
          }
        }
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">16823</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">clients</span>": [
          {
            "<span class="hljs-attr">id</span>": <span class="hljs-string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,
            "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
          }
        ]
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"mkcp"</span>, //此处的 mkcp 也可写成 kcp，两种写法是起同样的效果
        "<span class="hljs-attr">kcpSettings</span>": {
          "<span class="hljs-attr">uplinkCapacity</span>": <span class="hljs-number">5</span>,
          "<span class="hljs-attr">downlinkCapacity</span>": <span class="hljs-number">100</span>,
          "<span class="hljs-attr">congestion</span>": <span class="hljs-literal">true</span>,
          "<span class="hljs-attr">header</span>": {
            "<span class="hljs-attr">type</span>": <span class="hljs-string">"none"</span>
          }
        }
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
      "<span class="hljs-attr">settings</span>": {}
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>国内直连</strong></div></span></h2>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">log</span>": {
    "<span class="hljs-attr">loglevel</span>": <span class="hljs-string">"warning"</span>,
    "<span class="hljs-attr">access</span>": <span class="hljs-string">"D:\\v2ray\\access.log"</span>,
    "<span class="hljs-attr">error</span>": <span class="hljs-string">"D:\\v2ray\\error.log"</span>
  },
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1080</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"socks"</span>,
      "<span class="hljs-attr">domainOverride</span>": [<span class="hljs-string">"tls"</span>,<span class="hljs-string">"http"</span>],
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">auth</span>": <span class="hljs-string">"noauth"</span>,
        "<span class="hljs-attr">udp</span>": <span class="hljs-literal">true</span>
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"serveraddr.com"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">16823</span>,  
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
              }
            ]
          }
        ]
      }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
      "<span class="hljs-attr">settings</span>": {},
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"direct"</span> //如果要使用路由，这个 tag 是一定要有的，在这里 direct 就是 freedom 的一个标号，在路由中说 direct V2Ray 就知道是这里的 freedom 了
    }    
  ],
  "<span class="hljs-attr">routing</span>": {
    "<span class="hljs-attr">domainStrategy</span>": <span class="hljs-string">"IPOnDemand"</span>,
    "<span class="hljs-attr">rules</span>": [
      {
        "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
        "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>,
        "<span class="hljs-attr">domain</span>": [<span class="hljs-string">"geosite:cn"</span>] // 中国大陆主流网站的域名
      },
      {
        "<span class="hljs-attr">type</span>": <span class="hljs-string">"chinaip"</span>,
        "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>,
        "<span class="hljs-attr">ip</span>": [
          <span class="hljs-string">"geoip:cn"</span>，// 中国大陆的 IP
          <span class="hljs-string">"geoip:private"</span> // 私有地址 IP，如路由器等
        ]
      }
    ]
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">log</span>": {
    "<span class="hljs-attr">loglevel</span>": <span class="hljs-string">"warning"</span>,
    "<span class="hljs-attr">access</span>": <span class="hljs-string">"/var/log/v2ray/access.log"</span>,
    "<span class="hljs-attr">error</span>": <span class="hljs-string">"/var/log/v2ray/error.log"</span>
  },
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">16823</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,    
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">clients</span>": [
          {
            "<span class="hljs-attr">id</span>": <span class="hljs-string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>
          }
        ]
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
      "<span class="hljs-attr">settings</span>": {}
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>广告过滤</strong></div></span></h2>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">log</span>": {
    "<span class="hljs-attr">loglevel</span>": <span class="hljs-string">"warning"</span>,
    "<span class="hljs-attr">access</span>": <span class="hljs-string">"D:\\v2ray\\access.log"</span>,
    "<span class="hljs-attr">error</span>": <span class="hljs-string">"D:\\v2ray\\error.log"</span>
  },
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1080</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"socks"</span>,
      "<span class="hljs-attr">domainOverride</span>": [<span class="hljs-string">"tls"</span>,<span class="hljs-string">"http"</span>],
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">auth</span>": <span class="hljs-string">"noauth"</span>,
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"serveraddr.com"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">16823</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"2b831381d-6324-4d53-ad4f-8cda48b30811"</span>,  
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
              }
            ]
          }
        ]
      }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
      "<span class="hljs-attr">settings</span>": {},
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"direct"</span>//如果要使用路由，这个 tag 是一定要有的，在这里 direct 就是 freedom 的一个标号，在路由中说 direct V2Ray 就知道是这里的 freedom 了
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"blackhole"</span>,
      "<span class="hljs-attr">settings</span>": {},
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"adblock"</span>//同样的，这个 tag 也是要有的，在路由中说 adblock 就知道是这里的 blackhole（黑洞） 了
    }
  ],
  "<span class="hljs-attr">routing</span>": {
    "<span class="hljs-attr">domainStrategy</span>": <span class="hljs-string">"IPOnDemand"</span>,
    "<span class="hljs-attr">rules</span>": [
      {
        "<span class="hljs-attr">domain</span>": [
          <span class="hljs-string">"tanx.com"</span>,
          <span class="hljs-string">"googeadsserving.cn"</span>,
          <span class="hljs-string">"baidu.com"</span>
        ],
        "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
        "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"adblock"</span>       
      },
      {
        "<span class="hljs-attr">domain</span>": [
          <span class="hljs-string">"amazon.com"</span>,
          <span class="hljs-string">"microsoft.com"</span>,
          <span class="hljs-string">"jd.com"</span>,
          <span class="hljs-string">"youku.com"</span>,
          <span class="hljs-string">"baidu.com"</span>
        ],
        "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
        "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>
      },
      {
        "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
        "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>，
        <span class="hljs-string">"domain"</span>: [<span class="hljs-string">"geosite:cn"</span>]
      },
      {
        "<span class="hljs-attr">type</span>": <span class="hljs-string">"field"</span>,
        "<span class="hljs-attr">outboundTag</span>": <span class="hljs-string">"direct"</span>,
        "<span class="hljs-attr">ip</span>": [
          <span class="hljs-string">"geoip:cn"</span>,
          <span class="hljs-string">"geoip:private"</span>
        ]
      }
    ]
  }
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">log</span>": {
    "<span class="hljs-attr">loglevel</span>": <span class="hljs-string">"warning"</span>,
    "<span class="hljs-attr">access</span>": <span class="hljs-string">"/var/log/v2ray/access.log"</span>,
    "<span class="hljs-attr">error</span>": <span class="hljs-string">"/var/log/v2ray/error.log"</span>
  },
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">16823</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,    
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">clients</span>": [
          {
            "<span class="hljs-attr">id</span>": <span class="hljs-string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,
            "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
          }
        ]
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
      "<span class="hljs-attr">settings</span>": {}
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p><a name="advanced"></a></p>
<h1><div class="dw-box dw-box-yellow"><i class="dwicon-yellow"></i><strong><span style="color: #ffffff;">高级功能</span></strong></div></h1>
<p><span style="font-size: 12pt;">本章节介绍了 V2Ray 的高级功能。</span></p>
<h2><a name="balance"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>均衡负载</strong></div></span></h2>
<p><span style="font-size: 12pt;">相较于 Shadowsocks 等其它的代理，V2Ray 可以配置多服务器实现负载均衡。此处的负载均衡并非是自动选择一个延迟或网速最好的服务器进行连接，而是指多个服务器共同承担网络流量，从而减小单个服务器的资源占用及提高每个服务器的利用率。</span></p>
<p><span style="font-size: 12pt;"><span style="word-spacing: normal;">服务器配置：</span></span></p>
<p><span style="font-size: 12pt;">实现负载均衡很简单，在客户端配置同一个 outbound 的 vnext 写入各个服务器的配置即可(前提是服务器已经部署好并能正常使用)。形如：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbound</span>": {
  ...
  },
  "<span class="hljs-attr">outbound</span>": {
    "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
    "<span class="hljs-attr">settings</span>": {
      "<span class="hljs-attr">vnext</span>": [
        {
          "<span class="hljs-attr">address</span>": <span class="hljs-string">"address_of_vps1"</span>,
          "<span class="hljs-attr">port</span>": <span class="hljs-number">8232</span>,
          "<span class="hljs-attr">users</span>": [
            {
              "<span class="hljs-attr">id</span>": <span class="hljs-string">"1ce383ea-13e9-4939-9b1d-20d67135969a"</span>,
              "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
            }
          ]
        },
        {
          "<span class="hljs-attr">address</span>": <span class="hljs-string">"address_of_vps2"</span>,
          "<span class="hljs-attr">port</span>": <span class="hljs-number">4822</span>,
          "<span class="hljs-attr">users</span>": [
            {
              "<span class="hljs-attr">id</span>": <span class="hljs-string">"bc172445-4b5e-49b2-a712-12c5295fd26b"</span>,
              "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
            }
          ]
        }
        // 如果还有更多服务器可继续添加
      ]
    },
    "<span class="hljs-attr">streamSettings</span>": {
    ...
    }
  },
  ...
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">原理：V2Ray 是以轮询的方式均衡负载，也就是说当有流量需要通过代理时，首先走第一个 vnext 配置的服务器，有第二个连接就走第二个服务器，接着第三个，以此类推。轮询完一遍又头开始轮询。这样的方式虽然简单粗暴，特别是对于拥有多个性能差的 VPS 的人来说比较有用。另外<strong>也许</strong>能减小长时间大流量连接单个 IP 的特征，给自己一个心理安慰。</span></p>
<p><span style="font-size: 12pt;">注意事项：如端口、id 这些在 vnext 数组内的配置项可以各不相同，但是它们的传输层配置（streamSettings）必须一致。</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><a name="dynport"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>动态端口</strong></div></span></h2>
<p><span style="font-size: 12pt;">通常情况下，V2Ray 的服务器端使用一个固定的端口来接收客户端的数据。这个端口由配置文件中的 port 属性指定。如果同一端口通信时间过长，或流量过大，则有可能被服务商限速。于是 V2Ray 提供了一个功能来动态调整通信端口。</span></p>
<p><span style="font-size: 12pt;">在新的配置中，V2Ray 服务器端依然使用一个主端口（即上文的 port）接收请求，但可以配置一个绕路（detour）的特性。配置之后，服务器会主动告诉客户端，使用一个新的端口 X 来通信，X 是一个范围（可配置）内随机选取的值。此端口的有效期为 Y 分钟，客户端和服务器都会遵守这个时间，到期之后，客户端会继续向服务器请求新的端口来通信。以此循环。</span></p>
<p><span style="font-size: 12pt;">要启用动态端口，需要在现有的服务器配置文件中进行一些修改，主要有以下两项。客户端配置不用更改，客户端会自动接收服务器的配置。</span></p>
<p><span style="font-size: 12pt;">到目前为止没有证据可以动态端口对于科学上网是加分项还是减分项。</span></p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">基本动态端</span>口<span style="word-spacing: normal;"></span></div><p></p>
<p><span style="font-size: 12pt;">服务器 inbound 的端口作为主端口，在 inboundDetour 开动态监听的端口，客户端不用额外设定，客户端会先与服务器的主端口通信协商下一个使用的端口号。</span></p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>":[
  { //主端口配置
      "<span class="hljs-attr">port</span>": <span class="hljs-number">37192</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">clients</span>": [
          {
            "<span class="hljs-attr">id</span>": <span class="hljs-string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,
            "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
          }
        ],
        "<span class="hljs-attr">detour</span>": { //绕行配置，即指示客户端使用 dynamicPort 的配置通信
          "<span class="hljs-attr">to</span>": <span class="hljs-string">"dynamicPort"</span>   
        }
      }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">port</span>": <span class="hljs-string">"10000-20000"</span>, // 端口范围
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"dynamicPort"</span>,  // 与上面的 detour to 相同
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">default</span>": {
          "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
        }
      },
      "<span class="hljs-attr">allocate</span>": {            // 分配模式
        "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"random"</span>,  // 随机开启
        "<span class="hljs-attr">concurrency</span>": <span class="hljs-number">2</span>,      // 同时开放两个端口,这个值最大不能超过端口范围的 1/3
        "<span class="hljs-attr">refresh</span>": <span class="hljs-number">3</span>           // 每三分钟刷新一次
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.2.3.4"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">37192</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
              }
            ]
          }
        ]
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<div class="dw-box dw-box-block"><i class="dwicon-block"></i><span style="font-size: 12pt;">动态端口使用 mKCP</span><span style="word-spacing: normal;"></span></div><p></p>
<p><span style="font-size: 12pt;">在对应的 inbounds 和 outbounds 加入 streamSettings 并将 network 设置为 kcp 即可。</span></p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">37192</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">clients</span>": [
          {
            "<span class="hljs-attr">id</span>": <span class="hljs-string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,
            "<span class="hljs-attr">level</span>": <span class="hljs-number">1</span>,
            "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
          }
        ],
        "<span class="hljs-attr">detour</span>": {        
          "<span class="hljs-attr">to</span>": <span class="hljs-string">"dynamicPort"</span>   
        }
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"kcp"</span>
      }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">port</span>": <span class="hljs-string">"10000-20000"</span>, // 端口范围
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"dynamicPort"</span>,       
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">default</span>": {
          "<span class="hljs-attr">level</span>": <span class="hljs-number">1</span>,
          "<span class="hljs-attr">alterId</span>": <span class="hljs-number">32</span>
        }
      },
      "<span class="hljs-attr">allocate</span>": {            // 分配模式
        "<span class="hljs-attr">strategy</span>": <span class="hljs-string">"random"</span>,  // 随机开启
        "<span class="hljs-attr">concurrency</span>": <span class="hljs-number">2</span>,      // 同时开放两个端口
        "<span class="hljs-attr">refresh</span>": <span class="hljs-number">3</span>           // 每三分钟刷新一次
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"kcp"</span>
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.2.3.4"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">37192</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
              }
            ]
          }
        ]
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"kcp"</span>
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><a name="outboundproxy"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i>代理转发</div></span></h2>
<p><span style="font-size: 12pt;">通常，如果用了一台 VPS 进行流量中转，我们都要有这台 VPS 操作权限对 VPS 进行一定设置才能将客户端发来的数据包中转到目的 VPS。但是，很多情况下，我们只有别人提供的 Shadowsocks 账户而不具有 VPS 操作权限，除非是这台 VPS 的所有者进行相关设置，一般我们是无法利用该 VPS 作为中转服务器。</span></p>
<p><span style="font-size: 12pt;">V2Ray 自 v2.6 起新增了一个传出代理功能，使用代理转发可以实现由一个 Shadowsocks 服务器或者 V2Ray(VMess) 服务器来中转你的网络流量。传出代理解决了两个问题：一是可以别人使用提供的 Shadowsocks 帐户所属的 VPS 作为中转服务器（也就是说不需要对服务器进行额外的配置或设定）；二是基于一的情况下该 VPS 中转的数据包是经过 V2Ray 加密后的数据包，无法获知你访问了什么网站的数据，只能得到目的 VPS 的 IP 以及客户端 IP，有效地保证隐私安全。</span></p>
<p><strong><span style="font-size: 12pt;">原理</span></strong></p>
<p><span style="font-size: 12pt;">参考这个 <a href="https://github.com/v2ray/v2ray-core/issues/306" target="_blank" rel="noopener noreferrer">issue</a></span></p>
<p><strong><span style="font-size: 12pt;">使用方法</span></strong></p>
<p><strong><span style="font-size: 12pt;">所有服务器都不需要额外的设定，只需修改客户端的配置文件</span></strong></p>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": { // settings 的根据实际情况修改
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.1.1.1"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">8888</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>,
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"b12614c5-5ca4-4eba-a215-c61d642116ce"</span>
              }
            ]
          }
        ]
      },
      "<span class="hljs-attr">proxySettings</span>": {
          "<span class="hljs-attr">tag</span>": <span class="hljs-string">"transit"</span>  // 这里的 tag 必须跟作为代理 VPS 的 tag 一致，这里设定的是 <span class="hljs-string">"transit"</span>
        }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"shadowsocks"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">servers</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"2.2.2.2"</span>,
            "<span class="hljs-attr">method</span>": <span class="hljs-string">"aes-256-cfb"</span>,
            "<span class="hljs-attr">ota</span>": <span class="hljs-literal">false</span>,
            "<span class="hljs-attr">password</span>": <span class="hljs-string">"password"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">1024</span>
          }
        ]
      },
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"transit"</span>
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><strong><span style="font-size: 12pt;">链式代理转发</span></strong></p>
<p><span style="font-size: 12pt;">如果你有多个 Shadowsocks 或 VMess 账户，那么你可以这样:</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": { // settings 的根据实际情况修改
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"1.1.1.1"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">8888</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>,
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"b12614c5-5ca4-4eba-a215-c61d642116ce"</span>
              }
            ]
          }
        ]
      },
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"DOUS"</span>,
      "<span class="hljs-attr">proxySettings</span>": {
          "<span class="hljs-attr">tag</span>": <span class="hljs-string">"DOSG"</span>  
        }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"shadowsocks"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">servers</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"2.2.2.2"</span>,
            "<span class="hljs-attr">method</span>": <span class="hljs-string">"aes-256-cfb"</span>,
            "<span class="hljs-attr">ota</span>": <span class="hljs-literal">false</span>,
            "<span class="hljs-attr">password</span>": <span class="hljs-string">"password"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">1024</span>
          }
        ]
      },
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"AliHK"</span>
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"shadowsocks"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">servers</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"3.3.3.3"</span>,
            "<span class="hljs-attr">method</span>": <span class="hljs-string">"aes-256-cfb"</span>,
            "<span class="hljs-attr">ota</span>": <span class="hljs-literal">false</span>,
            "<span class="hljs-attr">password</span>": <span class="hljs-string">"password"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">3442</span>
          }
        ]
      },
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"AliSG"</span>,
      "<span class="hljs-attr">proxySettings</span>": {
          "<span class="hljs-attr">tag</span>": <span class="hljs-string">"AliHK"</span>  
      }
    },
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"4.4.4.4"</span>,
            "<span class="hljs-attr">port</span>": <span class="hljs-number">8462</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>,
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"b27c24ab-2b5a-433e-902c-33f1168a7902"</span>
              }
            ]
          }
        ]
      },
      "<span class="hljs-attr">tag</span>": <span class="hljs-string">"DOSG"</span>,
      "<span class="hljs-attr">proxySettings</span>": {
          "<span class="hljs-attr">tag</span>": <span class="hljs-string">"AliSG"</span>  
      }
    },
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">那么数据包经过的节点依次为： PC -&gt; AliHK -&gt; AliSG -&gt; DOSG -&gt; DOUS -&gt; 目标网站</span></p>
<p><span style="font-size: 12pt;">这样的代理转发形成了一条链条，被称之为链式代理转发。</span></p>
<p><strong><span style="font-size: 12pt;">注意：如果你打算配置(动态)链式传出代理，应当明确几点：</span></strong></p>
<ul>
<li><span style="font-size: 12pt;"><strong>性能</strong>。链式代理使用了多个节点，可能会造成延时、带宽等网络性能问题，并且客户端对每一个加解密的次数取决于代理链的长度，理论上也会有一定的影响。</span></li>
<li><span style="font-size: 12pt;"><strong>安全</strong>。前文提到，传出代理会一定程度上提高安全性，但安全取决于最弱一环，并不意味着代理链越长就会越安全。如果你需要匿名，请考虑成熟的匿名方案。 另外，使用了传出代理 streamSettings 会失效，即只能是非 TLS、无 HTTP 伪装的 TCP 传输协议。</span></li>
</ul>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><a name="tls"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>TLS</strong></div></span></h2>
<p><span style="font-size: 12pt;">申请SSL证书：</span></p>
<p><span style="font-size: 12pt;">参考<a href="https://ailitonia.com/archives/%e7%94%b3%e8%af%b7lets-encrypt%e5%85%8d%e8%b4%b9ssl%e8%af%81%e4%b9%a6/" target="_blank" rel="noopener noreferrer">申请Let‘s Encrypt免费SSL证书</a>，或者<a href="https://ailitonia.com/archives/v2ray%e5%88%a9%e7%94%a8websockettlsnginx%e5%ae%9e%e7%8e%b0%e6%b5%81%e9%87%8f%e4%bc%aa%e8%a3%85/" target="_blank" rel="noopener noreferrer">这篇文章</a>中的申请证书部分。</span></p>
<p><span style="font-size: 12pt;">服务器配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">443</span>, // 建议使用 443 端口
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,    
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">clients</span>": [
          {
            "<span class="hljs-attr">id</span>": <span class="hljs-string">"23ad6b10-8d1a-40f7-8ad0-e3e35cd38297"</span>,  
            "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
          }
        ]
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
        "<span class="hljs-attr">security</span>": <span class="hljs-string">"tls"</span>, // security 要设置为 tls 才会启用 TLS
        "<span class="hljs-attr">tlsSettings</span>": {
          "<span class="hljs-attr">certificates</span>": [
            {
              "<span class="hljs-attr">certificateFile</span>": <span class="hljs-string">"/etc/v2ray/v2ray.crt"</span>, // 证书文件
              "<span class="hljs-attr">keyFile</span>": <span class="hljs-string">"/etc/v2ray/v2ray.key"</span> // 密钥文件
            }
          ]
        }
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"freedom"</span>,
      "<span class="hljs-attr">settings</span>": {}
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p><span style="font-size: 12pt;">客户端配置：</span></p>
<pre class="pure-highlightjs"><code class="json hljs">{
  "<span class="hljs-attr">inbounds</span>": [
    {
      "<span class="hljs-attr">port</span>": <span class="hljs-number">1080</span>,
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"socks"</span>,
      "<span class="hljs-attr">domainOverride</span>": [<span class="hljs-string">"tls"</span>,<span class="hljs-string">"http"</span>],
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">auth</span>": <span class="hljs-string">"noauth"</span>
      }
    }
  ],
  "<span class="hljs-attr">outbounds</span>": [
    {
      "<span class="hljs-attr">protocol</span>": <span class="hljs-string">"vmess"</span>,
      "<span class="hljs-attr">settings</span>": {
        "<span class="hljs-attr">vnext</span>": [
          {
            "<span class="hljs-attr">address</span>": <span class="hljs-string">"mydomain.me"</span>, // tls 需要域名，所以这里应该填自己的域名
            "<span class="hljs-attr">port</span>": <span class="hljs-number">443</span>,
            "<span class="hljs-attr">users</span>": [
              {
                "<span class="hljs-attr">id</span>": <span class="hljs-string">"23ad6b10-8d1a-40f7-8ad0-e3e35cd38297"</span>,
                "<span class="hljs-attr">alterId</span>": <span class="hljs-number">64</span>
              }
            ]
          }
        ]
      },
      "<span class="hljs-attr">streamSettings</span>": {
        "<span class="hljs-attr">network</span>": <span class="hljs-string">"tcp"</span>,
        "<span class="hljs-attr">security</span>": <span class="hljs-string">"tls"</span> // 客户端的 security 也要设置为 tls
      }
    }
  ]
}</code></pre>
<p>&nbsp;</p>
<p>温馨提醒：<span style="font-size: 12pt;">不要想当然地把在 SS 和 SSR 的观念带过来，V2Ray 的 TLS 不是伪装，也不是混淆，这是<strong>完整、真正的 TLS</strong>。因此才需要域名和证书。下面用的的 WS(WebSocket) 也不是伪装。</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><a name="WTW"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>WebSocket+TLS+Web</strong></div></span></h2>
<p><span style="font-size: 12pt;">请参见：<a href="https://ailitonia.com/archives/v2ray%e5%88%a9%e7%94%a8websockettlsnginx%e5%ae%9e%e7%8e%b0%e6%b5%81%e9%87%8f%e4%bc%aa%e8%a3%85/" target="_blank" rel="noopener noreferrer">V2Ray利用WebSocket+TLS+nginx+CDN实现流量伪装</a>，密码V2</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><a name="cdn"></a><span style="color: #ffcc00;"><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>CDN</strong></div></span></h2>
<p><span style="font-size: 12pt;">请参见：<a href="https://ailitonia.com/archives/v2ray%e5%88%a9%e7%94%a8websockettlsnginx%e5%ae%9e%e7%8e%b0%e6%b5%81%e9%87%8f%e4%bc%aa%e8%a3%85/" target="_blank" rel="noopener noreferrer">V2Ray利用WebSocket+TLS+nginx+CDN实现流量伪装</a>，密码同上</span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<h2><span style="color: #ffcc00;"><a id="reverse_eg1"></a><div class="dw-box dw-box-tan"><i class="dwicon-tan"></i><strong>反向代理</strong></div></span></h2>
<p><span style="font-size: 12pt;">请参见：<a href="https://ailitonia.com/archives/%E4%BD%BF%E7%94%A8v2ray%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" target="_blank" rel="noopener noreferrer">使用v2ray进行反向代理/内网穿透</a></span></p>
<p><a href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#index">↑返回目录</a></p>
<hr>
<p style="text-align: right;">2018.10.17&nbsp; v2ray官网已无法直接访问</p>
<p style="text-align: right;">2018.12.6&nbsp; 更新以适配4.0+版本配置文件</p>
<p style="text-align: right;">2019.1.3&nbsp; 更新了反向代理的相关说明</p>
<div class="clear"></div>
<div class="clear"></div>
<div class="post-contents entry-content"><br>本文被阅读了：30,428次</div><br>

<div class="autorbox">
<div class="autorhead"><img src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849.jpeg" alt="作者头像"></div>
<div class="autorinfo"><strong><span style="font-size: 12.5pt;">关于 &nbsp;Ailitonia</span></strong><br><br>正因站在了巨人的肩膀上，才越发觉得自己渺小。不求成为巨人，但求与其同行。
把自己所见所闻，记录下来。<br><br><a href="https://ailitonia.com/archives/author/ailitonia/" target="_blank" rel="noopener">→查看所有由Ailitonia发布的文章</a></div>
</div>
</div>
<br class="clear">
</div>
<div class="article_nav"><div class="next navbutton"><a href="https://ailitonia.com/archives/centos-7-nginx%e5%ae%89%e8%a3%85%e4%b8%8e%e9%85%8d%e7%bd%ae/" rel="next">Next Post<i class="fa fa-angle-double-right"></i></a></div><div class="previous navbutton"><a href="https://ailitonia.com/archives/caddy%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/" rel="prev"><i class="fa fa-angle-double-left"></i>Previous Post</a></div><br class="clear"></div> <hr>
<div class="comments">
<h3 id="comments">
32 Responses to V2Ray完全配置指南	</h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-285">
<div id="div-comment-285" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/779419d2672d58153214ed21b835172f.jpeg" srcset="https://secure.gravatar.com/avatar/779419d2672d58153214ed21b835172f?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">小草莓</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-285">
2020年4月23日 10:52 </a>
</div>
<p>发现了个宝藏博主。很厉害，谢谢分享！</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=285#respond" data-commentid="285" data-postid="1211" data-belowelement="div-comment-285" data-respondelement="respond" aria-label="回复给小草莓">回复</a></div>
</div>
</li>
<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-203">
<div id="div-comment-203" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/c3222ee520d41f8e1e780dff505f0c6c" srcset="https://secure.gravatar.com/avatar/c3222ee520d41f8e1e780dff505f0c6c?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">hp</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-203">
2019年10月17日 17:49 </a>
</div>
<p>文中 提到的 http 和 websocket， 分流 和 中转 有什么区别？</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=203#respond" data-commentid="203" data-postid="1211" data-belowelement="div-comment-203" data-respondelement="respond" aria-label="回复给hp">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-2" id="comment-204">
<div id="div-comment-204" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-204">
2019年10月18日 03:54 </a>
</div>
<p>http和websocket是两种传输协议<br>
字面意思，分流，筛选不同流量分发到不同地方；中转，转发全部流量到指定地方<br>
另，请善用搜索引擎，提高知识水平，谷歌告诉你的答案，比我说的还更靠谱（</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=204#respond" data-commentid="204" data-postid="1211" data-belowelement="div-comment-204" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
<li class="comment odd alt thread-even depth-1 parent" id="comment-198">
<div id="div-comment-198" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/b2270560bdfbcf1b914243f3e513a0bc" srcset="https://secure.gravatar.com/avatar/b2270560bdfbcf1b914243f3e513a0bc?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">kktt</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-198">
2019年10月9日 21:23 </a>
</div>
<p>谢谢如此详细的配置解说,非常经典.<br>
另外请教下,linux下如何共享给局域网的手机等设备,因为windows下有开启http这个选项,然后手机就能使用socks+1的端口来上,那么linux如何开启呢,感谢</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=198#respond" data-commentid="198" data-postid="1211" data-belowelement="div-comment-198" data-respondelement="respond" aria-label="回复给kktt">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-2" id="comment-199">
<div id="div-comment-199" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-199">
2019年10月9日 23:03 </a>
</div>
<p>建议参考社区指南的透明代理一章（https://guide.v2fly.org/app/transparent_proxy.html）通过dokodemo door入站以及iptables的转发功能实现<br>
若使用树莓派、虚拟机、家庭服务器等非路由器网关可在手机上自定义设置网关ip</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=199#respond" data-commentid="199" data-postid="1211" data-belowelement="div-comment-199" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-121">
<div id="div-comment-121" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/1c8f584c5e8ba9d0fdbc813fc4a3c60f" srcset="https://secure.gravatar.com/avatar/1c8f584c5e8ba9d0fdbc813fc4a3c60f?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">纳兰炽羽</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-121">
2019年9月28日 01:15 </a>
</div>
<p>请教一下，既然可以有SS实现中转代理，那么改用纯socks5中转也能实现吧。<br>
以下的配置不知道哪里写的不对，还请帮忙援助，谢谢！<br>
IP、ID等等都手动删除了。</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=121#respond" data-commentid="121" data-postid="1211" data-belowelement="div-comment-121" data-respondelement="respond" aria-label="回复给纳兰炽羽">回复</a></div>
</div>
<ul class="children">
<li class="comment even depth-2 parent" id="comment-122">
<div id="div-comment-122" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/1c8f584c5e8ba9d0fdbc813fc4a3c60f" srcset="https://secure.gravatar.com/avatar/1c8f584c5e8ba9d0fdbc813fc4a3c60f?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">纳兰炽羽</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-122">
2019年9月28日 01:17 </a>
</div>
<p>晕死，好多空格符号。不知道怎么能正确上传啊。</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=122#respond" data-commentid="122" data-postid="1211" data-belowelement="div-comment-122" data-respondelement="respond" aria-label="回复给纳兰炽羽">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor odd alt depth-3 parent" id="comment-124">
<div id="div-comment-124" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-124">
2019年9月29日 11:28 </a>
</div>
<p>我把评论转义关了所以看起来全是乱的(*/ω＼*)<br>
你贴的配置太长啦啦啦，我就先给删啦<br>
看了一下，思路是没有问题的，配置看起来也是没有问题的，那么为什么不行呢？<br>
答案是：没有仔细看官方文档！~(￣▽￣)~*<br>
你在配置里用的最后一级代理明显使用的是ws+tls+web的配置<br>
燃鹅！<br>
官方文档在出站协议里面明确写明了：<br>
“proxySettings: ProxySettingsObject<br>
出站代理配置。当出站代理生效时，此出站协议的streamSettings将不起作用。”<br>
也就是说，除了非TLS、无HTTP伪装的TCP协议外，其他都是不行的哦(o゜▽゜)o☆</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=124#respond" data-commentid="124" data-postid="1211" data-belowelement="div-comment-124" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
<ul class="children">
<li class="comment even depth-4 parent" id="comment-125">
<div id="div-comment-125" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/1c8f584c5e8ba9d0fdbc813fc4a3c60f" srcset="https://secure.gravatar.com/avatar/1c8f584c5e8ba9d0fdbc813fc4a3c60f?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">纳兰炽羽</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-125">
2019年9月30日 11:30 </a>
</div>
<p>谢谢你的回复！<br>
我收集了好几个订阅，都是好心人提供的公益节点。基本都是ws+tls+web这种，所以请问有没有办法实现纯socks中转，并且streamSettings能有效的？</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=125#respond" data-commentid="125" data-postid="1211" data-belowelement="div-comment-125" data-respondelement="respond" aria-label="回复给纳兰炽羽">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor odd alt depth-5 parent" id="comment-179">
<div id="div-comment-179" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-179">
2019年10月5日 15:18 </a>
</div>
<p>这个现在好像只有通过路由来实现吧……大概就是在本机新建一个dokodemo-door监听端口，将原来inbound收到的信息通过代理outbound发送到这个任意门监听端口，由任意门再发往下一级中转服务器，两个inbound之间的转发通过路由匹配完成，实际中转流量通过中转outbound配置。这玩意配置起来脑壳痛，看我什么时候有时间研究研究(ノへ￣、)</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=179#respond" data-commentid="179" data-postid="1211" data-belowelement="div-comment-179" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
<ul class="children">
<li class="comment even depth-6" id="comment-195">
<div id="div-comment-195" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/1c8f584c5e8ba9d0fdbc813fc4a3c60f" srcset="https://secure.gravatar.com/avatar/1c8f584c5e8ba9d0fdbc813fc4a3c60f?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">纳兰炽羽</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-195">
2019年10月6日 19:20 </a>
</div>
<p>那就麻烦你帮忙看看这篇ISSUES：https://github.com/v2ray/v2ray-core/issues/1736<br>
反正我按照他的写法还是无法实现。已经确认过相同节点在联通线路下很优秀，家里电信的都很慢，所以想通过联通网络中的纯socks来中转一下。<br>
此socks在SSR中可以正常使用的。<br>
先谢谢了！！</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=195#respond" data-commentid="195" data-postid="1211" data-belowelement="div-comment-195" data-respondelement="respond" aria-label="回复给纳兰炽羽">回复</a></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="comment odd alt depth-3" id="comment-297">
<div id="div-comment-297" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/ca3f759ddeb99087c3e58d63a8e6a2d7" srcset="https://secure.gravatar.com/avatar/ca3f759ddeb99087c3e58d63a8e6a2d7?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">哇还要姓名太过分了8</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-297">
2020年6月11日 07:06 </a>
</div>
<p>我也遇上了，现在觉得很不科学233</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=297#respond" data-commentid="297" data-postid="1211" data-belowelement="div-comment-297" data-respondelement="respond" aria-label="回复给哇还要姓名太过分了8">回复</a></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li class="comment even thread-even depth-1 parent" id="comment-99">
<div id="div-comment-99" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/320e07f833ee0338f1de3ed03a0b5045" srcset="https://secure.gravatar.com/avatar/320e07f833ee0338f1de3ed03a0b5045?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">anxian</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-99">
2019年8月11日 10:55 </a>
</div>
<p>你好，我的网络环境是ipv4计费、IPv6免费，所以想与vps之间通过ipv6链接来实现免流，现在的疑问是在iptables方面是否需要单独的配置？（因为我查到的资料说是iptables不支持IPv6的转发，需要用到ip6tables)<br>
目前我用的是刷好梅林固件的路由器，自带v2ray插件，不需要配置就可以实现ipv6上网，问题是路由器的性能不足，下载最高速度只有4.5M/S，正好我还有一个n1盒子（安装了Armbian的Debian系统），现在想用n1做代理网关（旁路由），而网上的教程都没有考虑到ipv6，比如说在docker下的openwrt就无法获取ipv6地址。所以想直接在盒子里直接安装v2ray来实现局域网共享，由于本人是一个小白，不懂原理，只会按照教程一步步操作，不知当涉及到ipv6时，是否需要额外注意到地方？<br>
PS.教程很详细，感谢分享！祝愉快</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=99#respond" data-commentid="99" data-postid="1211" data-belowelement="div-comment-99" data-respondelement="respond" aria-label="回复给anxian">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor odd alt depth-2" id="comment-100">
<div id="div-comment-100" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-100">
2019年8月12日 10:28 </a>
</div>
<p>抱歉，我平时用不到ipv6所以也没有专门研究过ipv6的配置<img draggable="false" role="img" class="emoji" alt="😂" src="./V2Ray完全配置指南 – Ai_files/1f602.svg"><br>
iptables不支持ipv6是因为有专门ipv6版本的ip6tables，配置方法和iptables一样……<br>
其他的我真没怎么搞过<img draggable="false" role="img" class="emoji" alt="😂" src="./V2Ray完全配置指南 – Ai_files/1f602.svg"></p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=100#respond" data-commentid="100" data-postid="1211" data-belowelement="div-comment-100" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
<li class="comment even thread-odd thread-alt depth-1 parent" id="comment-67">
<div id="div-comment-67" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/e2757aee011ff4f195cd9a5c0b9f44dd" srcset="https://secure.gravatar.com/avatar/e2757aee011ff4f195cd9a5c0b9f44dd?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">cold field</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-67">
2019年7月4日 09:41 </a>
</div>
<p>当初完善自己配置的时候也是参考大大的这篇，如今想用nginx+quic+tls+cdn 的形式，但是目前quic的相关配置资料很少，不知大大是否有完整的相对成熟的quic配置可以参考？</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=67#respond" data-commentid="67" data-postid="1211" data-belowelement="div-comment-67" data-respondelement="respond" aria-label="回复给cold field">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor odd alt depth-2" id="comment-68">
<div id="div-comment-68" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-68">
2019年7月4日 14:42 </a>
</div>
<p>目前没有用quic是因为quic本身就处于实验阶段，而且目前cdn对于quic的支持也并不是很好（起码目前cloudflare仍然在beta中），不过quic的说不定今后就很好用了呢？</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=68#respond" data-commentid="68" data-postid="1211" data-belowelement="div-comment-68" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-2 parent" id="comment-69">
<div id="div-comment-69" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-69">
2019年7月4日 15:55 </a>
</div>
<p>对了，使用quic的本意就是为了降低延迟，那为何还要再加一层cdn呢？如果是为了追求低延迟，直接使用quic协议就可以了；如果想要隐蔽，还不如使用ws+tls+cdn。刚刚我想了想，同时使用quic和cdn似乎并不是一个合理的搭配啊OwO</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=69#respond" data-commentid="69" data-postid="1211" data-belowelement="div-comment-69" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
<ul class="children">
<li class="comment odd alt depth-3 parent" id="comment-74">
<div id="div-comment-74" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/e2757aee011ff4f195cd9a5c0b9f44dd" srcset="https://secure.gravatar.com/avatar/e2757aee011ff4f195cd9a5c0b9f44dd?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">cold field</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-74">
2019年7月5日 10:11 </a>
</div>
<p>主要是还是觉得理论上这个模式在相同安全性的情况下，可以得到更低的延迟，再加上TLS1.3，应该是对链接的建立过程更为简短，对我来说最最主要是udp，ws+tls+cdn这个模式对UDP好像并不是十分友好。所以理论上来说，这套应该是在原有的性能和安全的基础上得到更多的性能效果?</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=74#respond" data-commentid="74" data-postid="1211" data-belowelement="div-comment-74" data-respondelement="respond" aria-label="回复给cold field">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-4" id="comment-80">
<div id="div-comment-80" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-80">
2019年7月8日 15:15 </a>
</div>
<p>emmmmm……依我个人的理解，安全性和低延迟是鱼与熊掌不可兼得的_(:з)∠)_<br>
就实际来看，quic仍然是个实验性质的项目，目前nginx和Apache都是暂不支持quic的，只有Caddy提供了quic支持（依然是实验性质的）。<br>
所以目前网站启用quic的主流方法，是利用Caddy单独反代quic协议的流量，所以如果您执意想使用这种配置的话，应该使用Caddy而不是nginx。<br>
另外，正如我前面提到的，主流CDN对quic的支持仍然是实验性质的，所以并不能保证这个方法实现的稳定性。<br>
有时间的话也许我会试一下利用Caddy反代quic对比nginx反代ws+tls，看看实际体验（咕咕咕</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=80#respond" data-commentid="80" data-postid="1211" data-belowelement="div-comment-80" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="comment odd alt thread-even depth-1 parent" id="comment-61">
<div id="div-comment-61" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/fe15152775eba110403e72d4792c7295.jpeg" srcset="https://secure.gravatar.com/avatar/fe15152775eba110403e72d4792c7295?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="http://blog.veskyirt.xyz/" rel="external nofollow ugc" class="url">以沫</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-61">
2019年6月19日 20:11 </a>
</div>
<p>谢谢大佬分享，有几个小问题qwq<br>
相比起来，SSR-SS稳一点还是V2ray稳一点，成熟度呢?qwq<br>
ipv4被大陆封禁得只有一点点可用的了，如果服务器仅仅只有可以访问的ipv6地址，通过ssh可以连接ipv6的服务器，能用这个ipv6搭建v2ray吗?因为不想使用ipv4</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=61#respond" data-commentid="61" data-postid="1211" data-belowelement="div-comment-61" data-respondelement="respond" aria-label="回复给以沫">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-2 parent" id="comment-62">
<div id="div-comment-62" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-62">
2019年6月20日 15:00 </a>
</div>
<p>相对来说v2ray更稳，并且可以使用ws+tls+cdn这样的技巧来进行伪装，相应的，v2ray有所需的机器配置要求要高那么一点点，配置更加复杂等缺点，v2ray目前成熟度已经很高了，可以放心食用。<br>
在代理软件来看来，你使用ipv4或使用ipv6没太大区别，只要你监听相应端口就行；如果你对于ip被封感到可惜的话，可以试试上面提到的ws+tls+cdn，利用cdn可以拯救部分被封的ip。</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=62#respond" data-commentid="62" data-postid="1211" data-belowelement="div-comment-62" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
<ul class="children">
<li class="comment odd alt depth-3 parent" id="comment-81">
<div id="div-comment-81" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/fe15152775eba110403e72d4792c7295.jpeg" srcset="https://secure.gravatar.com/avatar/fe15152775eba110403e72d4792c7295?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">以沫</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-81">
2019年7月8日 16:24 </a>
</div>
<p>如果服务器只有ipv6，能不能搭建v2ray并访问ipv4的网站?</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=81#respond" data-commentid="81" data-postid="1211" data-belowelement="div-comment-81" data-respondelement="respond" aria-label="回复给以沫">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-4" id="comment-82">
<div id="div-comment-82" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-82">
2019年7月8日 17:14 </a>
</div>
<p>理论上没问题，服务器的ip只关系到你与你服务器之间的连接，而不会影响服务器与其他网站的连接。</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=82#respond" data-commentid="82" data-postid="1211" data-belowelement="div-comment-82" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-52">
<div id="div-comment-52" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/a182e8ded75718424a2c9989357b6692" srcset="https://secure.gravatar.com/avatar/a182e8ded75718424a2c9989357b6692?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="http://www.1/" rel="external nofollow ugc" class="url">mask</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-52">
2019年5月6日 00:20 </a>
</div>
<p>您好，非常高兴能找到您。遇到个问题请教您 请问下 不同协议不同用户的入站 怎么对应不同协议的出站。比如 客户端vmess（ws）-中转服务器vmess- 末端服务器vmess 已经实现了，现在想在中转服务器上 增加 客户端MTproto-中转服务器MTproto ； 现在无论中转服务器的入站怎么配置 都能生效 但出站永远是连接到了末端服务器vmess</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=52#respond" data-commentid="52" data-postid="1211" data-belowelement="div-comment-52" data-respondelement="respond" aria-label="回复给mask">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor even depth-2" id="comment-53">
<div id="div-comment-53" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-53">
2019年5月7日 02:13 </a>
</div>
<p>如果您使用的是多inbound且各入站协议不同，请为每个inbound都设置tag，并在路由配置中根据tag配置相应的outbound<br>
可以参考一下我后面那篇使用《v2ray进行反向代理-内网穿透》文章第六节反向代理的底层传输配置中portal配置的相关部分（https://ailitonia.com/archives/使用v2ray进行反向代理-内网穿透/#r4），虽然是反向代理的配置，但其路由配置和你提到的问题有共同之处，可以参考一下<br>
如果您仅仅只是需要在中转服务器上增加一对MTProto，那么直接将官方文档关于MTProto的样例配置（https://www.v2ray.com/chapter_02/protocols/mtproto.html）插入到您原有配置文件中也是可行的，那也是一个很简单也很直接的例子，同样可以参考</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=53#respond" data-commentid="53" data-postid="1211" data-belowelement="div-comment-53" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
<li class="comment odd alt thread-even depth-1" id="comment-47">
<div id="div-comment-47" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/f1a32431f895a83e7fe8dd59299fb342.png" srcset="https://secure.gravatar.com/avatar/f1a32431f895a83e7fe8dd59299fb342?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://spiritx.xyz/" rel="external nofollow ugc" class="url">Spirit</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-47">
2019年4月19日 08:35 </a>
</div>
<p>哇，好详细！(≧∇≦)b</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=47#respond" data-commentid="47" data-postid="1211" data-belowelement="div-comment-47" data-respondelement="respond" aria-label="回复给Spirit">回复</a></div>
</div>
</li>
<li class="comment even thread-odd thread-alt depth-1" id="comment-46">
<div id="div-comment-46" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/ae7727f8f75bedeee4166ef6977a65f1" srcset="https://secure.gravatar.com/avatar/ae7727f8f75bedeee4166ef6977a65f1?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">Sam</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-46">
2019年4月7日 20:34 </a>
</div>
<p>好详细的文章，作者辛苦了！</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=46#respond" data-commentid="46" data-postid="1211" data-belowelement="div-comment-46" data-respondelement="respond" aria-label="回复给Sam">回复</a></div>
</div>
</li>
<li class="comment odd alt thread-even depth-1" id="comment-36">
<div id="div-comment-36" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/b62a2c635a175011adcea16ea40330f6" srcset="https://secure.gravatar.com/avatar/b62a2c635a175011adcea16ea40330f6?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">你猜</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-36">
2019年3月5日 22:32 </a>
</div>
<p>马克，谢谢分享，省去了2h的折腾时间</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=36#respond" data-commentid="36" data-postid="1211" data-belowelement="div-comment-36" data-respondelement="respond" aria-label="回复给你猜">回复</a></div>
</div>
</li>
<li class="comment even thread-odd thread-alt depth-1 parent" id="comment-23">
<div id="div-comment-23" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/c9f21b7f22321e4b52f41d5f671bf94d" srcset="https://secure.gravatar.com/avatar/c9f21b7f22321e4b52f41d5f671bf94d?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn">hwatu du</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-23">
2018年12月24日 15:39 </a>
</div>
<p>访问请求日志监控可以配置吗？</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=23#respond" data-commentid="23" data-postid="1211" data-belowelement="div-comment-23" data-respondelement="respond" aria-label="回复给hwatu du">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor odd alt depth-2" id="comment-24">
<div id="div-comment-24" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-24">
2018年12月25日 00:39 </a>
</div>
<p>目前v2ray的统计和日志主要用于调试，如果你想要类似酸酸乳那样的流量审计，目前是没有的（或者去问问有没有大佬自己开发了</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=24#respond" data-commentid="24" data-postid="1211" data-belowelement="div-comment-24" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
<li class="comment even thread-even depth-1 parent" id="comment-9">
<div id="div-comment-9" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/7a003f77b6202a76853a1bf24656c340.jpeg" srcset="https://secure.gravatar.com/avatar/7a003f77b6202a76853a1bf24656c340?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="http://www.zlovezl.cn/" rel="external nofollow ugc" class="url">朱雷</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-9">
2018年11月3日 07:19 </a>
</div>
<p>非常有用的配置指南，谢谢整理分享。</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=9#respond" data-commentid="9" data-postid="1211" data-belowelement="div-comment-9" data-respondelement="respond" aria-label="回复给朱雷">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-ailitonia bypostauthor odd alt depth-2" id="comment-10">
<div id="div-comment-10" class="comment-body">
<div class="comment-author vcard">
<img alt="" src="./V2Ray完全配置指南 – Ai_files/da26988302b074fffcdf43de51dfe849(1).jpeg" srcset="https://secure.gravatar.com/avatar/da26988302b074fffcdf43de51dfe849?s=128&amp;d=retro&amp;r=pg 2x" class="avatar avatar-64 photo" height="64" width="64"> <cite class="fn"><a href="https://ailitonia.com/" rel="external nofollow ugc" class="url">Ailitonia</a></cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/#comment-10">
2018年11月4日 02:39 </a>
</div>
<p>过奖了，我也只是一个搬运工而已(*/ω＼*)</p>
<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://ailitonia.com/archives/v2ray%e5%ae%8c%e5%85%a8%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/?replytocom=10#respond" data-commentid="10" data-postid="1211" data-belowelement="div-comment-10" data-respondelement="respond" aria-label="回复给Ailitonia">回复</a></div>
</div>
</li>
</ul>
</li>
</ol>
<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://ailitonia.com/archives/v2ray%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/#respond" style="display:none;">取消回复</a></small></h3><form action="https://ailitonia.com/wp-comments-post.php" method="post" id="commentform" class="comment-form"><p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><p class="comment-form-comment"><label for="comment">评论</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required="required"></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required="required"></p>
<p class="comment-form-url"><label for="url">站点</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200"></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="发表评论"> <input type="hidden" name="comment_post_ID" value="1211" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="c15b7ee9ba"></p><p style="display: none;"></p><input type="hidden" id="ak_js" name="ak_js" value="1592024760910"></form> </div>
</div>
<div class="article_nav"><div class="next navbutton"><a href="https://ailitonia.com/archives/centos-7-nginx%e5%ae%89%e8%a3%85%e4%b8%8e%e9%85%8d%e7%bd%ae/" rel="next">Next Post<i class="fa fa-angle-double-right"></i></a></div><div class="previous navbutton"><a href="https://ailitonia.com/archives/caddy%e9%85%8d%e7%bd%ae%e6%8c%87%e5%8d%97/" rel="prev"><i class="fa fa-angle-double-left"></i>Previous Post</a></div><br class="clear"></div> </div>
</div>
<div id="sub-footer">
<div class="container">
<div class="sub-footer-left">
<p>
Copyright © 2020, Ai.
</p>
</div>
<div class="sub-footer-right">
<div class="menu-%e5%ba%95%e9%83%a8%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%ba%95%e9%83%a8%e5%af%bc%e8%88%aa" class="menu"><li id="menu-item-1501" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-1501"><a href="https://ailitonia.com/">Home</a></li>
<li id="menu-item-772" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-772"><a href="https://ailitonia.com/news/">News</a></li>
<li id="menu-item-773" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-773"><a href="https://ailitonia.com/about/">About</a></li>
<li id="menu-item-1775" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-1775"><a href="https://ailitonia.com/about/privacy-policy/">Privacy</a></li>
<li id="menu-item-1776" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1776"><a href="https://ailitonia.com/about/copyright/">Copyright</a></li>
</ul></div> </div>
</div>
</div>
<script type="text/javascript">
    /* 鼠标点击特效 */
    var a_idx = 0;
    jQuery(document).ready(function ($) {
        $("body").click(function (e) {
            var a = new Array("喵 ~  ฅ( ̳• ◡ • ̳)ฅ", "喵 ~  ฅ●ω●ฅ", "喵 ~  (ฅ>ω<*ฅ)", "喵 ~  ฅ'ω'ฅ", "喵 ~  (´ฅωฅ‘) ");
            var $i = $("<span/>").text(a[a_idx]);
            a_idx = (a_idx + 1) % a.length;
            var x = e.pageX,
                y = e.pageY;
            $i.css({
                "z-index": 9999999999999999999,
                "top": y - 20,
                "left": x,
                "position": "absolute",
                "font-weight": "bold",
                "color": "#b8902b"
            });
            $("body").append($i);
            $i.animate({
                    "top": y - 180,
                    "opacity": 0
                },
                1500,
                function () {
                    $i.remove();
                });
        });
    });

</script>
</div>
<link rel="stylesheet" id="su-icons-css" href="./V2Ray完全配置指南 – Ai_files/icons.css" type="text/css" media="all">
<link rel="stylesheet" id="su-shortcodes-css" href="./V2Ray完全配置指南 – Ai_files/shortcodes(1).css" type="text/css" media="all">
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/highlight.pack.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/wp-embed.min.js"></script>
<script async="async" type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/form.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var SUShortcodesL10n = {"noPreview":"\u7b80\u7801\u4e0d\u80fd\u5728\u5b9e\u65f6\u9884\u89c8\u3002\u8bf7\u628a\u5b83\u63d2\u5165\u5230\u7f16\u8f91\u5668\u7136\u540e\u518d\u7f51\u7ad9\u4e0a\u9884\u89c8\u3002","magnificPopup":{"close":"\u5173\u95ed\uff08Esc\uff09","loading":"\u6b63\u5728\u52a0\u8f7d\u2026\u2026","prev":"\u4e0a\u4e00\u4e2a\uff08\u2190\u952e\uff09","next":"\u4e0b\u4e00\u6b65\uff08\u2192\u7bad\u5934\u952e\uff09","counter":"\u7b2c%curr% \u5f20\uff0c\u5171 %total%\u5f20","error":"\u65e0\u6cd5\u52a0\u8f7d\u5185\u5bb9. <a href=\"0rl target=\"_blank\"><u>\/u><\/a>"}};
/* ]]> */
</script>
<script type="text/javascript" src="./V2Ray完全配置指南 – Ai_files/index.js"></script>

<style type="text/css">
.df_font{
	font-size:12pt;
}
.df_back{
	background:#444;
}
</style>





</body></html>